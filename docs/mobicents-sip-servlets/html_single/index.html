<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">SIP Servlets Server User Guide</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="description" content="Mobicents is the first and only open source VoIP platform certified for JAIN SLEE 1.0 and SIP Servlets 1.1 compliance. Mobicents serves as a high-performance core for Service Delivery Platforms (SDPs) and IP Multimedia Subsystems (IMSs) by leveraging J2EE to enable the convergence of data and video in Next-Generation Intelligent Network (NGIN) applications. The Mobicents enables the composition of predefined Service Building Blocks (SBBs) such as Call-Control, Billing, User-Provisioning, Administration and Presence-Sensing. Out-of-the-box monitoring and management of Mobicents components is achieved through JMX Consoles. JSLEE allows popular protocol stacks such as SIP to be plugged in as Resource Adapters (RAs), and Service Building Blocks—which share many similarities with EJBs—allow the easy accommodation and integration of enterprise applications with end points such as the Web, Customer Relationship Management (CRM) systems and Service-Oriented Architectures (SOAs). The Mobicents is the natural choice for telecommunication Operations Support Systems (OSSs) and Network Management Systems (NMSs). In addition to the telecommunication industry, the Mobicents is suitable for a variety of problem domains demanding an Event-Driven Architecture (EDA) for high-volume, low-latency signaling, such as financial trading, online gaming, (RFID) sensor network integration, and distributed control."/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>SIP Servlets Server User Guide</h1></div><div><h2 class="subtitle">The Guide to the SIP Servlets v1.1-Certified Server</h2></div><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><object type="image/svg+xml" data="Common_Content/images/title_logo.svg"/></span>
	</h3></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Douglas</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Silas</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Jean</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Deruelle</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Vladimir</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ralev</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Ivelin</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ivanov</span>, and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Jared</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Morgan</span></div><div class="editors"/><div class="others"/></div></div><div><p class="copyright">Copyright © 2009 </p></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>Mobicents is the first and only open source <acronym class="acronym">VoIP</acronym> platform certified for <acronym class="acronym">JAIN SLEE</acronym> 1.0 and <acronym class="acronym">SIP</acronym> Servlets 1.1 compliance.  Mobicents serves as a high-performance core for Service Delivery Platforms (<acronym class="acronym">SDP</acronym>s) and <acronym class="acronym">IP</acronym> Multimedia Subsystems (<acronym class="acronym">IMS</acronym>s) by leveraging <acronym class="acronym">J2EE</acronym> to enable the convergence of data and video in Next-Generation Intelligent Network (<acronym class="acronym">NGIN</acronym>) applications.</p><p>The Mobicents enables the composition of predefined Service Building Blocks (<acronym class="acronym">SBB</acronym>s) such as Call-Control, Billing, User-Provisioning, Administration and Presence-Sensing.  Out-of-the-box monitoring and management of Mobicents components is achieved through <acronym class="acronym">JMX</acronym> Consoles. <acronym class="acronym">JSLEE</acronym> allows popular protocol stacks such as <acronym class="acronym">SIP</acronym> to be plugged in as Resource Adapters (<acronym class="acronym">RA</acronym>s), and Service Building Blocks—which share many similarities with <acronym class="acronym">EJB</acronym>s—allow the easy accommodation and integration of enterprise applications with end points such as the Web, Customer Relationship Management (<acronym class="acronym">CRM</acronym>) systems and Service-Oriented Architectures (<acronym class="acronym">SOA</acronym>s). The Mobicents is the natural choice for telecommunication Operations Support Systems (OSSs) and Network Management Systems (NMSs).</p><p>In addition to the telecommunication industry, the Mobicents is suitable for a variety of problem domains demanding an Event-Driven Architecture (<acronym class="acronym">EDA</acronym>) for high-volume, low-latency signaling, such as financial trading, online gaming, (<acronym class="acronym">RFID</acronym>) sensor network integration, and distributed control.</p></div></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#d0e135">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e139">1. Document Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e149">1.1. Typographic Conventions</a></span></dt><dt><span class="section"><a href="#d0e365">1.2. Pull-quote Conventions</a></span></dt><dt><span class="section"><a href="#d0e384">1.3. Notes and Warnings</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ittsss-Introduction_to_the_SIP_Servlets_Server">1. Introduction to the SIP Servlets Server</a></span></dt><dd><dl><dt><span class="section"><a href="#ittsss-High-Availability-SIP_Servlets_Server_Load_Balancing_Clustering_and_Failover">1.1. High-Availability: SIP Servlets Server Load Balancing, Clustering and Failover</a></span></dt><dt><span class="section"><a href="#wwtssmc-Working_with_the_SIP_Servlets_Management_Console">1.2. Working with the SIP Servlets Management Console</a></span></dt></dl></dd><dt><span class="chapter"><a href="#sssicar-SIP_Servlets_Server-Installing_Configuring_and_Running">2. SIP Servlets Server-Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running">2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e700">2.1.1. Java Development Kit (JDK): Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-PreInstall_Requirements_and_Prerequisites">2.1.2. Pre-install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Downloading">2.1.3. Downloading</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing">2.1.4. Installing</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Setting_the_JBOSS_HOME_Environment_Variable">2.1.5. Setting the JBOSS_HOME Environment Variable</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Configuring">2.1.6. Configuring</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running">2.1.7. Running</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Using">2.1.8. Using</a></span></dt><dt><span class="section"><a href="#d0e1678">2.1.9. Testing</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping">2.1.10. Stopping</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Uninstalling">2.1.11. Uninstalling</a></span></dt></dl></dd><dt><span class="section"><a href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running">2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1880">2.2.1. Java Development Kit (JDK): Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-PreInstall_Requirements_and_Prerequisites">2.2.2. Pre-Install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Downloading">2.2.3. Downloading</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Installing">2.2.4. Installing</a></span></dt><dt><span class="section"><a href="#section-SIP_Servlets_Server_with_Tomcat-Setting_the_CATALINA_HOME_Environment_Variable">2.2.5. Setting the CATALINA_HOME Environment Variable</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Configuring">2.2.6. Configuring</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running">2.2.7. Running</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping">2.2.8. Stopping</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server-Using">2.2.9. Using</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Testing">2.2.10. Testing</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Uninstalling">2.2.11. Uninstalling</a></span></dt></dl></dd><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring">2.3. Configuring</a></span></dt><dd><dl><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors">2.3.1. Configuring SIP Connectors</a></span></dt><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring_Application_Routing">2.3.2. Application Routing and Service Configuration</a></span></dt><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring_Logging">2.3.3. SIP Servlets Server Logging</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#sssicar-SIP_Servlets_Server-Application-Router">3. Application Router</a></span></dt><dd><dl><dt><span class="section"><a href="#tsdar-Default-Application-Router">3.1. Default Application Router</a></span></dt><dd><dl><dt><span class="section"><a href="#tsdar-Application-Router-Role">3.1.1. Role of the Application Router</a></span></dt><dt><span class="section"><a href="#tsdar-Mobicents-Default-Application-Router">3.1.2. Mobicents Default Application Router</a></span></dt><dt><span class="section"><a href="#tsdar-Limitations">3.1.3. Limitations of the Default Application Router</a></span></dt></dl></dd><dt><span class="section"><a href="#tsear-echarts-Application-Router">3.2. DFC Application Router</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3602">3.2.1. Description of DFC Application Router</a></span></dt><dt><span class="section"><a href="#d0e3609">3.2.2. Installing the DFC Application Router</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ssea-SIP_Servlet_Example_Applications">4. SIP Servlet Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#sfss-Services_for_SIP_Servlets">4.1. Operating the Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#sfss-The_Location_Service">4.1.1. The Location Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Diameter_Event-Changing_Service">4.1.2. The Diameter Event-Changing Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Blocking_Service">4.1.3. The Call-Blocking Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Forwarding_Service">4.1.4. The Call-Forwarding Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Controller_Service">4.1.5. The Call-Controller Service</a></span></dt><dt><span class="section"><a href="#mipbx-Media_IPBX">4.1.6. Media IPBX</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e5521">5. Clustering and High Availability</a></span></dt><dd><dl><dt><span class="section"><a href="#ssfjcs-SS_for_JBoss-Clustering_Support">5.1. Mobicents SIP Servlets for JBoss: Clustering Support</a></span></dt><dd><dl><dt><span class="section"><a href="#ssfjcs-binary-SIP_Servlets_Server_Cluster-Installing_Configuring_and_Running">5.1.1. SIP Servlets Server Cluster: Installing, Configuring and Running</a></span></dt></dl></dd><dt><span class="section"><a href="#ssfjfs-SS_for_JBoss-Failover_Support">5.2. Mobicents SIP Servlets for JBoss: Transparent Failover</a></span></dt><dd><dl><dt><span class="section"><a href="#ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover--Installing_Configuring_and_Running">5.2.1. MSS for JBoss Cluster: Installing, Configuring and Running</a></span></dt></dl></dd><dt><span class="section"><a href="#sslb-MSS_Load_Balancer">5.3. Load Balancer</a></span></dt><dd><dl><dt><span class="section"><a href="#sslb-SIP_Load_Balancing_Basics">5.3.1. SIP Load Balancing Basics</a></span></dt><dt><span class="section"><a href="#d0e5812">5.3.2. HTTP Load Balancing Basics</a></span></dt><dt><span class="section"><a href="#d0e5851">5.3.3. Pluggable balancer algorithms</a></span></dt><dt><span class="section"><a href="#d0e5888">5.3.4. Distributed load balancing</a></span></dt><dt><span class="section"><a href="#sslb-SIP_Servlets_Load_Balancer-Implementation">5.3.5. Implementation of the Mobicents Load Balancer</a></span></dt><dt><span class="section"><a href="#d0e5918">5.3.6. SIP Message Flow</a></span></dt><dt><span class="section"><a href="#sslb-binary-SIP_Load_Balancer-Installing_Configuring_and_Running">5.3.7. SIP Load Balancer: Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#d0e6508">5.3.8. IP Load Balancing</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#emom-Enterprise-Monitoring-Operations-Management">6. Enterprise Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6585">6.1. Mobicents SIP Servlets Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6592">6.1.1. Installation of the Enterprise Monitoring and Management Console</a></span></dt><dt><span class="section"><a href="#d0e6636">6.1.2. Usage Instructions</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6848">6.2. SIP Load Balancer Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6856">6.2.1. Installation of the Enterprise Monitoring and Management Console</a></span></dt><dt><span class="section"><a href="#d0e6888">6.2.2. Usage Instructions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#afotsss-Advanced_Features_of_the_SIP_Servlets_Server">7. Advanced Features of the SIP Servlets Server</a></span></dt><dd><dl><dt><span class="section"><a href="#mipbx-Media_Support">7.1. Media Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6967">7.1.1. JSR 309 : Media Server Control API</a></span></dt></dl></dd><dt><span class="section"><a href="#sscacc-MSS_Concurrency_and_Congestion_Control">7.2. Concurrency and Congestion Control</a></span></dt><dt><span class="section"><a href="#sss-SIP_Servlet_Security">7.3. SIP Servlets Application Security</a></span></dt><dt><span class="section"><a href="#mssstun-MSS_STUN">7.4. STUN Support</a></span></dt><dt><span class="section"><a href="#stf-Seam_Telco_Framework">7.5. Seam Telco Framework</a></span></dt><dt><span class="section"><a href="#ssds-Diameter_Support">7.6. Diameter Support</a></span></dt><dt><span class="section"><a href="#saimse-SIP_and_IMS_Extensions">7.7. SIP and IMS Extensions</a></span></dt><dt><span class="section"><a href="#jruby-telco-integration">7.8. JRuby/Rails Integration with Torquebox Telco Framework</a></span></dt><dt><span class="section"><a href="#ss_jslee_interop">7.9. SIP Servlets - JAIN SLEE Interoperability</a></span></dt><dt><span class="section"><a href="#d0e8266">7.10. Eclipse IDE Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8276">7.10.1. Pre-Install requirements</a></span></dt><dt><span class="section"><a href="#d0e8281">7.10.2. Installation</a></span></dt><dt><span class="section"><a href="#d0e8292">7.10.3. SIP Servlets Core Plug-in</a></span></dt><dt><span class="section"><a href="#d0e8300">7.10.4. SIP Phone Plug-in</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#bp-Best_Practices">8. Best Practices</a></span></dt><dd><dl><dt><span class="section"><a href="#bp-Best_Practices_Perf_Tips">8.1. Mobicents SIP Servlets Performance Tips</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8316">8.1.1. Tuning JBoss</a></span></dt><dt><span class="section"><a href="#d0e8331">8.1.2. Tuning Mobicents SIP Servlets</a></span></dt><dt><span class="section"><a href="#d0e8359">8.1.3. Tuning The JAIN SIP Stack</a></span></dt><dt><span class="section"><a href="#d0e8471">8.1.4. Tuning The JVM</a></span></dt><dt><span class="section"><a href="#d0e8522">8.1.5. Tuning The Operating System</a></span></dt></dl></dd><dt><span class="section"><a href="#bp-Best_Practices_NAT">8.2. NAT Traversal</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8601">8.2.1. STUN</a></span></dt><dt><span class="section"><a href="#d0e8610">8.2.2. TURN</a></span></dt><dt><span class="section"><a href="#d0e8621">8.2.3. ICE</a></span></dt><dt><span class="section"><a href="#d0e8636">8.2.4. Other Approaches</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#d0e8643">A. Revision History</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e135"/>Preface</h2></div></div></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e139"/>1. Document Conventions</h2></div></div></div><p>
		This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
	</p><p>
		In PDF and paper editions, this manual uses typefaces drawn from the <a class="ulink" href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
	</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e149"/>1.1. Typographic Conventions</h3></div></div></div><p>
			Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
		</p><p>
			<code class="literal">Mono-spaced Bold</code>
		</p><p>
			Used to highlight system input, including shell commands, file names and paths. Also used to highlight key caps and key-combinations. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</p></blockquote></div><p>
			The above includes a file name, a shell command and a key cap, all presented in Mono-spaced Bold and all distinguishable thanks to context.
		</p><p>
			Key-combinations can be distinguished from key caps by the hyphen connecting each part of a key-combination. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</p><p>
				Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to switch to the first virtual terminal. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F7</strong></span> to return to your X-Windows session.
			</p></blockquote></div><p>
			The first sentence highlights the particular key cap to press. The second highlights two sets of three key caps, each set pressed simultaneously.
		</p><p>
			If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">Mono-spaced Bold</code>. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
			</p></blockquote></div><p>
			<span class="application"><strong>Proportional Bold</strong></span>
		</p><p>
			This denotes words or phrases encountered on a system, including application names; dialogue box text; labelled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				Choose <span class="guimenu"><strong>System &gt; Preferences &gt; Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
			</p><p>
				To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications &gt; Accessories &gt; Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search &gt; Find</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit &gt; Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
			</p></blockquote></div><p>
			The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in Proportional Bold and all distinguishable by context.
		</p><p>
			Note the <span class="guimenu"><strong>&gt;</strong></span> shorthand used to indicate traversal through a menu and its sub-menus. This is to avoid the difficult-to-follow 'Select <span class="guimenuitem"><strong>Mouse</strong></span> from the <span class="guimenu"><strong>Preferences</strong></span> sub-menu in the <span class="guimenu"><strong>System</strong></span> menu of the main menu bar' approach.
		</p><p>
			<code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
		</p><p>
			Whether Mono-spaced Bold or Proportional Bold, the addition of Italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
			</p><p>
				The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
			</p><p>
				To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
			</p></blockquote></div><p>
			Note the words in bold italics above  username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
		</p><p>
			Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				When the Apache HTTP Server accepts requests, it dispatches child processes or threads to handle them. This group of child processes or threads is known as a <em class="firstterm">server-pool</em>. Under Apache HTTP Server 2.0, the responsibility for creating and maintaining these server-pools has been abstracted to a group of modules called <em class="firstterm">Multi-Processing Modules</em> (<em class="firstterm">MPMs</em>). Unlike other modules, only one module from the MPM group can be loaded by the Apache HTTP Server.
			</p></blockquote></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e365"/>1.2. Pull-quote Conventions</h3></div></div></div><p>
			Two, commonly multi-line, data types are set off visually from the surrounding text.
		</p><p>
			Output sent to a terminal is set in <code class="computeroutput">Mono-spaced Roman</code> and presented thus:
		</p><pre class="screen">
books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs
</pre><p>
			Source-code listings are also set in <code class="computeroutput">Mono-spaced Roman</code> but are presented and highlighted as follows:
		</p><pre class="programlisting">
package org.jboss.book.jca.ex1;

import javax.naming.InitialContext;

public class ExClient
{
   public static void main(String args[]) 
       throws Exception
   {
      InitialContext iniCtx = new InitialContext();
      Object         ref    = iniCtx.lookup("EchoBean");
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.create();

      System.out.println("Created Echo");

      System.out.println("Echo.echo('Hello') = " + echo.echo("Hello"));
   }
   
}
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e384"/>1.3. Notes and Warnings</h3></div></div></div><p>
			Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
		</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				A note is a tip or shortcut or alternative approach to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
			</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
				Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring Important boxes won't cause data loss but may cause irritation and frustration.
			</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>
				A Warning should not be ignored. Ignoring warnings will most likely cause data loss.
			</p></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ittsss-Introduction_to_the_SIP_Servlets_Server"/>Chapter 1. Introduction to the SIP Servlets Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ittsss-High-Availability-SIP_Servlets_Server_Load_Balancing_Clustering_and_Failover">1.1. High-Availability: SIP Servlets Server Load Balancing, Clustering and Failover</a></span></dt><dt><span class="section"><a href="#wwtssmc-Working_with_the_SIP_Servlets_Management_Console">1.2. Working with the SIP Servlets Management Console</a></span></dt></dl></div><p>
  Mobicents
   SIP (Session Initiation Protocol) Servlets deliver a consistent, open platform on which to develop and deploy portable and distributed SIP and Java Enterprise Edition services. The Mobicents
   SIP Servlets Server is a <span class="emphasis"><em>certified</em></span> implementation of the SIP Servlet v1.1 (JSR 289) specification that can run on top of either the JBoss Application Server or the Tomcat Servlet Container.</p><p>
  Mobicents
   SIP Servlets for JBoss (MSS for JBoss) strives to develop interoperability standards between SIP Servlets and the Java Service Logic Execution Environment (JSLEE) so that applications can exploit the strengths of both. The JAIN-SIP Reference Implementation is leveraged as the SIP stack, and the Mobicents
   JAIN SLEE Server is used as the SLEE implementation.</p><div class="itemizedlist"><a id="ittsss-Principal_and_new_features_of_SIP_Servlets"/><p class="title"><b>Features of the Mobicents SIP Servlets Server</b></p><ul><li><p>the first <span class="emphasis"><em>certified</em></span> SIP Servlet v1.1 (JSR 289) implementation</p></li><li><p>a current call rate of 100 calls per second over a 24-hour duration: 8,640,000 total calls</p></li><li><p>load balancing, cluster and failover support</p></li><li><p>merged SIP and HTTP session management</p></li><li><p>a browser-based Management Console</p></li><li><p>a bundled JSLEE/SIP interoperability demonstration application for MSS for JBoss</p></li><li><p>Mobicents Media Server</p></li><li><p>extensions such as SUBSCRIBE/NOTIFY, among others</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ittsss-High-Availability-SIP_Servlets_Server_Load_Balancing_Clustering_and_Failover"/>1.1. High-Availability: SIP Servlets Server Load Balancing, Clustering and Failover</h2></div></div></div><p>Telecommunications applications demand High-Availability (HA), fault tolerance, scalability and performance. Providing highly-available end-user applications that are  tolerant of faults is commonly achieved through the use of clustering technologies.  </p><p>Clustering is a complex subject that is often used to collectively address a variety of techniques aimed at improving the high-availability and scalability of services and applications. Such techniques include distributed state replication, load balancing, and failover capabilities. The usage of any one of these techniques improves either reliability or performance, but for the sake of the other. It requires careful analysis of real-world scenarios to arrive at an architecture which represents the optimal balance of performance and reliability.</p><p>Based on experience with production deployments and extensive feedback from the Open Source community, Mobicents HA has undergone several iterations of refinement. In its current incarnation, the architecture can be described as a "star topology" with symmetric application servers and a smart, lightweight load-balancing element with built-in failover logic. The amount of state replication is kept to a minimum for maximum scalability with sufficiently-high reliability.</p><div class="mediaobject" align="center"><a id="ittsss-sas-MSSSIPLoadBalancer-dia-StarNetworkTopology"/><img src="images/mss-MSSSIPLoadBalancer-dia-StarNetworkTopology.jpg" align="middle" longdesc="/qa/services/hudson/hudson_workspace/workspace/MobicentsSipServletsRelease/release-1.4.0.FINAL/docs/jdocbook-mobicents/target/docbook/publish/en-US/html_single/ittsss-sas-MSSSIPLoadBalancer-dia-StarNetworkTopology.html"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="longdesc-link"><br/><span class="longdesc-link">[<a href="ittsss-sas-MSSSIPLoadBalancer-dia-StarNetworkTopology.html">D</a>]</span></div></div><p class="formalpara"><a id="ittsss-Clustering_Terms_and_Definitions_for_SIP_Servlets"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Clustering Terms and Definitions for Mobicents SIP Servlets</h5><p class="formalpara">For purposes of clarity, the SIP Servlets High-Availability sections use terms—such as <span class="emphasis"><em>cluster</em></span>—with meanings specific to the context of Mobicents SIP Servlets. Therefore, the following definitions are provided to clarify more precisely what is meant by the terms <span class="emphasis"><em>cluster</em></span>, <span class="emphasis"><em>node</em></span>, <span class="emphasis"><em>SIP Servlets Server</em></span> and so on, in the subsequent sections, and in the context of Mobicents High-Availability.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><a id="ittsss-Distinguishing_Between_a_Cluster_and_Clustering_Capabilities"/><h2>Distinguishing Between a Cluster and Clustering Capabilities</h2><p>The crux of possible confusion is this: any heterogeneous group of SIP Servlets Servers behind a SIP load balancer is, by definition, a <span class="emphasis"><em>cluster</em></span>. Those SIP Servlets Servers can be either MSS for JBoss servers or MSS for Tomcat servers. However, a homogeneous group of MSS for JBoss servers served by a SIP load balancer, in addition to being a cluster, also possesses JBoss-specific <span class="emphasis"><em>clustering capabilities</em></span>. Those clustering capabilities include, principally, state replication and the ability to fail over. Therefore, when specific <span class="emphasis"><em>clustering capabilities</em></span> are spoken of, they are always referring to the context of a homogeneous cluster of MSS for JBoss server nodes served by a load balancer.</p></div><div class="variablelist"><a id="ittsss-Glossary_of_Cluster-Related_Terms"/><p class="title"><b>Glossary of Cluster-Related Terms</b></p><dl><dt><span class="term">SIP Servlets Server</span></dt><dd><p>A Mobicents <span class="emphasis"><em>SIP Servlets Server</em></span> refers to either a SIP Servlets-enabled JBoss Application Server (MSS for JBoss) or a SIP Servlets-enabled Tomcat Servlet Container (MSS for Tomcat). Anywhere the term SIP Servlets Server is used, you are free to substitute the JBoss or the Tomcat variety depending on the one you are interested in.</p></dd><dt><span class="term">node</span></dt><dd><p>A <span class="emphasis"><em>node</em></span> is simply a SIP Servlets Server in a <span class="emphasis"><em>cluster</em></span>. In this document, a node can be either an MSS for JBoss server or an MSS for Tomcat server.</p></dd><dt><span class="term">cluster</span></dt><dd><p>A <span class="emphasis"><em>cluster</em></span>, as used in this document, refers simply to a group of one or more <span class="emphasis"><em>nodes</em></span>, i.e. <span class="emphasis"><em>SIP Servlets Servers</em></span>, behind a SIP load balancer. The minimum number of nodes in a cluster is one. The case of a <span class="emphasis"><em>cluster</em></span> with one node almost always occurs in a <span class="emphasis"><em>degraded cluster</em></span>: one in which other nodes, for some reason, have become unavailable.</p></dd><dt><span class="term">SIP load balancer</span></dt><dd><p>The <span class="application"><strong>Mobicents SIP load balancer</strong></span> is not a full-fledged SIP Servlets Server itself. Rather, it is a simple <span class="emphasis"><em>proxy server</em></span> whose primary purpose is to intelligently route SIP requests and replies between healthy and available SIP Servlets Servers residing in a <span class="emphasis"><em>cluster</em></span> on a Local Area Network (LAN), and User Agents (UAs) accessing a SIP service or application from a Wide Area Network (WAN). The SIP load balancer therefore acts as a kind of gateway between a Wide Area Network with User Agents, and a Local Area Network wherein the SIP Servlets Server <span class="emphasis"><em>cluster nodes</em></span> reside.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="wwtssmc-Working_with_the_SIP_Servlets_Management_Console"/>1.2. Working with the SIP Servlets Management Console</h2></div></div></div><p>Once installed, the MSS for JBoss or MSS for Tomcat instance can be accessed and configured using the SIP Servlets Management Console.  The management console is available at <a class="ulink" href="http://localhost:8080/sip-servlets-management/">http://localhost:8080/sip-servlets-management/</a>.</p><div class="mediaobject" align="center"><a id="wwtssmc-mss-MSSSManagementConsole-ss-ManagementConsole"/><img src="images/mss-MSSSManagementConsole-ss-ManagementConsole.png" align="middle"/><div class="caption"><p>The SIP Servlets Management Console</p></div></div><p>Information on how to use the SIP Servlets Management Console is available from the <span class="guilabel"><strong>Help</strong></span> link on the top main menu bar.  Clicking <span class="guilabel"><strong>Help</strong></span> displays a <span class="guilabel"><strong>Default Application Router Help</strong></span> pop-up which can be repositioned and resized by dragging.</p><div class="mediaobject" align="center"><a id="wwtssmc-mss-MSSSManagementConsole-ss-Help"/><img src="images/mss-MSSSManagementConsole-ss-Help.png" align="middle"/><div class="caption"><p>SIP Servlets Management Console: Default Application Router Help</p></div></div><p>Recent versions of the SIP Servlets Management Console feature a <span class="guilabel"><strong>Server Settings</strong></span> tab, in which concurrency and congestion control settings can be tuned.</p><div class="mediaobject" align="center"><a id="wwtssmc-mss-MSSSManagementConsole-ss-ServerSettings-2"/><img src="images/mss-MSSSManagementConsole-ss-ServerSettings.png" align="middle"/><div class="caption"><p>Tunable SIP Servlets Server Settings</p></div></div><p>For more information on concurrency and congestion control tuning, refer to <a class="xref" href="#sscacc-Configuring_the_Concurrency_and_Congestion_Control_Settings" title="Configuring the Concurrency and Congestion Control Settings">Configuring the Concurrency and Congestion Control Settings</a>.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sssicar-SIP_Servlets_Server-Installing_Configuring_and_Running"/>Chapter 2. SIP Servlets Server-Installing, Configuring and Running</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running">2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e700">2.1.1. Java Development Kit (JDK): Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-PreInstall_Requirements_and_Prerequisites">2.1.2. Pre-install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Downloading">2.1.3. Downloading</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing">2.1.4. Installing</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Setting_the_JBOSS_HOME_Environment_Variable">2.1.5. Setting the JBOSS_HOME Environment Variable</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Configuring">2.1.6. Configuring</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running">2.1.7. Running</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Using">2.1.8. Using</a></span></dt><dt><span class="section"><a href="#d0e1678">2.1.9. Testing</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping">2.1.10. Stopping</a></span></dt><dt><span class="section"><a href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Uninstalling">2.1.11. Uninstalling</a></span></dt></dl></dd><dt><span class="section"><a href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running">2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1880">2.2.1. Java Development Kit (JDK): Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-PreInstall_Requirements_and_Prerequisites">2.2.2. Pre-Install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Downloading">2.2.3. Downloading</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Installing">2.2.4. Installing</a></span></dt><dt><span class="section"><a href="#section-SIP_Servlets_Server_with_Tomcat-Setting_the_CATALINA_HOME_Environment_Variable">2.2.5. Setting the CATALINA_HOME Environment Variable</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Configuring">2.2.6. Configuring</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running">2.2.7. Running</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping">2.2.8. Stopping</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server-Using">2.2.9. Using</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Testing">2.2.10. Testing</a></span></dt><dt><span class="section"><a href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Uninstalling">2.2.11. Uninstalling</a></span></dt></dl></dd><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring">2.3. Configuring</a></span></dt><dd><dl><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors">2.3.1. Configuring SIP Connectors</a></span></dt><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring_Application_Routing">2.3.2. Application Routing and Service Configuration</a></span></dt><dt><span class="section"><a href="#bsssc-binary-SIP_Servlets_Server-Configuring_Logging">2.3.3. SIP Servlets Server Logging</a></span></dt></dl></dd></dl></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running"/>2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running</h2></div></div></div><p>The Mobicents SIP Servlets Server can run on either the JBoss Application Server or the Tomcat Servlet Container. This section details how to install the SIP Servlets Server on top of the JBoss Application Server. For installation instructions for the Tomcat Servlet Container, refer to <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>
 </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>It is recommended that the SIP Servlets Server is run on the JBoss platform.  Some functionality, including the ability to execute some SIP Extension examples, is not available in the Tomcat version.</p></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Differences Between a Standard JBoss Installation and the Mobicents SIP Servlets Version</h5><p class="formalpara">Provided here is a list of differences between a standard JBoss Application Server installation one customized for SIP Servlets. The differences include:</p><div class="itemizedlist"><ul><li><p>The <code class="filename">server/default/deploy</code> directory contains both HTTP and SIP Servlet applications.</p></li><li><p>The <code class="filename">server/default/deploy/jbossweb.sar</code> units have been modified to provide extended classes to the standard JBoss container classes, in order to allow SIP applications to be loaded and the SIP stack to be started.</p></li><li><p>The <code class="filename">server/default/deploy/jbossweb.sar</code> <code class="filename">context.xml</code> files have been modified to allow the extended manager to manage SIP sessions and SIP application sessions in addition to HTTP sessions.</p></li><li><p>The <code class="filename">server/default/deploy/jbossweb.sar/</code> <code class="filename">server.xml</code> file has been modified to provide extended classes to common JBoss Web containers.  The classes allow SIP applications to be loaded, and the SIP stack to be started.</p></li><li><p>The <code class="filename">server/default/deploy/jbossweb.sar/</code> <code class="filename">jboss-beans.xml</code> file has been modified to allow the JBoss container to process SIP messages.</p></li><li><p>The <code class="filename">server/default/deployers/</code> <code class="filename">metadata-deployer-jboss-beans.xml</code> file has been modified to allow JBoss to parse sip.xml deployment descriptors and SIP metadata annotations.</p></li><li><p>The <code class="filename">server/default/deployers/jbossweb.deployer/META-INF/war-deployers-jboss-beans.xml</code> file have been modified so that it is now possible for JBoss containers to correctly deploy SIP servlets and converged applications.</p></li><li><p>A <code class="filename">dars</code> directory containing all of the Default Application Router (DAR) properties files for using the various SIP Servlets applications (which come bundled with the release) has been added to the <code class="filename">server/default/conf</code> directory.</p></li><li><p>Additional JAR files have been added to enable SIP Servlet functionality; these are located in the <code class="filename">server/default/deploy/jbossweb.sar/</code>, <code class="filename">server/default/deployers/jbossweb.deployer/</code> and <code class="filename">common/lib</code>directories.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e700"/>2.1.1. Java Development Kit (<acronym class="acronym">JDK</acronym>): Installing, Configuring and Running</h3></div></div></div><p>
		The <span class="application"><strong>Mobicents Platform</strong></span> is written in Java; therefore, before running any <span class="application"><strong>Mobicents</strong></span> server, you must have a working Java Runtime Environment (<acronym class="acronym">JRE</acronym>) or Java Development Kit (<acronym class="acronym">JDK</acronym>) installed on your system. In addition, the JRE or JDK you are using to run <span class="application"><strong>Mobicents</strong></span> must be version 5 or higher<sup>[<a id="d0e723" href="#ftn.d0e723" class="footnote">1</a>]</sup>.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Should I Install the JRE or JDK?</h5><p class="formalpara">
			Although you can run <span class="application"><strong>Mobicents</strong></span> servers using the Java Runtime Environment, we assume that most users are developers interested in developing Java-based, <span class="application"><strong>Mobicents</strong></span>-driven solutions. Therefore, in this guide we take the tact of showing how to install the full Java Development Kit.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Should I Install the 32-Bit or the 64-Bit JDK, and Does It Matter?</h5><p class="formalpara">
			Briefly stated: if you are running on a 64-Bit Linux or Windows platform, you should consider installing and running the 64-bit JDK over the 32-bit one. Here are some heuristics for determining whether you would rather run the 64-bit Java Virtual Machine (JVM) over its 32-bit cousin for your application:
		</p><div class="itemizedlist"><ul><li><p>
				Wider datapath: the pipe between RAM and CPU is doubled, which improves the performance of memory-bound applications when using a 64-bit JVM.
			</p></li><li><p>
				64-bit memory addressing gives virtually unlimited (1 exabyte) heap allocation. However large heaps affect garbage collection.
			</p></li><li><p>
				Applications that run with more than 1.5 GB of RAM (including free space for garbage collection optimization) should utilize the 64-bit JVM.
			</p></li><li><p>
				Applications that run on a 32-bit JVM and do not require more than minimal heap sizes will gain nothing from a 64-bit JVM. Barring memory issues, 64-bit hardware with the same relative clock speed and architecture is not likely to run Java applications faster than their 32-bit cousin.
			</p></li></ul></div><p>
		Note that the following instructions detail how to download and install the 32-bit JDK, although the steps are nearly identical for installing the 64-bit version.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">
			You can download the Sun JDK 5.0 (Java 2 Development Kit) from Sun's website: <a class="ulink" href="http://java.sun.com/javase/downloads/index_jdk5.jsp">http://java.sun.com/javase/downloads/index_jdk5.jsp</a>. Click on the <span class="guilabel"><strong>Download</strong></span> link next to "JDK 5.0 Update <em class="replaceable"><code>&lt;x&gt;</code></em>" (where <em class="replaceable"><code>&lt;x&gt;</code></em> is the latest minor version release number). On the next page, select your language and platform (both architecture—whether 32- or 64-bit—and operating system), read and agree to the <code class="literal">Java Development Kit 5.0 License Agreement</code>, and proceed to the download page.
		</p><p>
		The Sun website will present two download alternatives to you: one is an RPM inside a self-extracting file (for example, <code class="filename">jdk-1_5_0_16-linux-i586-rpm.bin</code>), and the other is merely a self-extracting file (e.g. <code class="filename">jdk-1_5_0_16-linux-i586.bin</code>). If you are installing the JDK on Red Hat Enterprise Linux, Fedora, or another RPM-based Linux system, we suggest that you download the self-extracting file containing the RPM package, which will set up and use the SysV service scripts in addition to installing the JDK. We also suggest installing the self-extracting RPM file if you will be running <span class="application"><strong>Mobicents</strong></span> in a production environment.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">
			The following procedures detail how to install the Java Development Kit on both Linux and Windows.
		</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e801"/><p class="title"><b>Procedure 2.1. Installing the JDK on Linux</b></p><ul><li><p>
				Regardless of which file you downloaded, you can install it on Linux by simply making sure the file is executable and then running it:
			</p><pre class="screen">~]$ chmod +x "jdk-1_5_0_&lt;minor_version&gt;-linux-&lt;architecture&gt;-rpm.bin"
~]$ ./"jdk-1_5_0_&lt;minor_version&gt;-linux-&lt;architecture&gt;-rpm.bin"</pre></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>You Installed Using the Non-RPM Installer, but Want the SysV Service Scripts</h2><p>
			If you download the non-RPM self-extracting file (and installed it), and you are running on an RPM-based system, you can still set up the SysV service scripts by downloading and installing one of the <code class="literal">-compat</code> packages from the JPackage project. Remember to download the <code class="literal">-compat</code> package which corresponds correctly to the minor release number of the JDK you installed. The compat packages are available from <a class="ulink" href="ftp://jpackage.hmdc.harvard.edu/JPackage/1.7/generic/RPMS.non-free/">ftp://jpackage.hmdc.harvard.edu/JPackage/1.7/generic/RPMS.non-free/</a>.
		</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
			You do not need to install a <code class="literal">-compat</code> package in addition to the JDK if you installed the self-extracting RPM file! The <code class="literal">-compat</code> package merely performs the same SysV service script set up that the RPM version of the JDK installer does.
		</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e832"/><p class="title"><b>Procedure 2.2. Installing the JDK on Windows</b></p><ul><li><p>
				Using Explorer, simply double-click the downloaded self-extracting installer and follow the instructions to install the JDK.
			</p></li></ul></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">
			Configuring your system for the JDK consists in two tasks: setting the <code class="envar">JAVA_HOME</code> environment variable, and ensuring that the system is using the proper JDK (or JRE) using the <code class="command">alternatives</code> command. Setting <code class="envar">JAVA_HOME</code> usually overrides the values for <code class="command">java</code>, <code class="command">javac</code> and <code class="command">java_sdk_1.5.0</code> in <code class="command">alternatives</code>, but we will set them all just to be safe and consistent.
		</p><div class="variablelist"><dl><dt><span class="term">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Generic Linux</span></dt><dd><p>
					After installing the JDK, you must ensure that the <code class="envar">JAVA_HOME</code> environment variable exists and points to the location of your JDK installation.
				</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Linux</h5><p class="formalpara">
						You can determine whether <code class="envar">JAVA_HOME</code> is set on your system by <code class="command">echo</code>ing it on the command line:
					</p><pre class="screen">~]$ echo $JAVA_HOME</pre><p>
					If <code class="envar">JAVA_HOME</code> is not set already, then you must set its value to the location of the JDK installation on your system. You can do this by adding two lines to your personal <code class="filename">~/.bashrc</code> configuration file. Open <code class="filename">~/.bashrc</code> (or create it if it doesn't exist) and add a line similar to the following one anywhere inside the file:
				</p><pre class="programlisting">export JAVA_HOME="/usr/lib/jvm/jdk1.5.0_&lt;version&gt;"
</pre><p>
					You should also set this environment variable for any other users who will be running <span class="application"><strong>Mobicents</strong></span> (any environment variables <code class="command">export</code>ed from <code class="filename">~/.bashrc</code> files are local to that user).
				</p></dd><dt><span class="term">Setting <code class="envar">java</code>, <code class="envar">javac</code> and <code class="envar">java_sdk_1.5.0</code> Using the <code class="command">alternatives</code> command </span></dt><dd><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Selecting the Correct System JVM on Linux using <code class="command">alternatives</code>
					</h5><p class="formalpara">
						On systems with the <code class="command">alternatives</code> command, including Red Hat Enterprise Linux and Fedora, you can easily choose which JDK (or JRE) installation you wish to use, as well as which <code class="command">java</code> and <code class="command">javac</code> executables should be run when called.
					</p><p>
					<span class="emphasis"><em>As the root user</em></span>, call <code class="command">/usr/sbin/alternatives</code> with the <code class="option">--config java</code> option to select between JDKs and JREs installed on your system:
				</p><pre class="programlisting">root@localhost ~]$ /usr/sbin/alternatives --config java

There are 3 programs which provide 'java'.

  Selection    Command
-----------------------------------------------
   1           /usr/lib/jvm/jre-1.5.0-gcj/bin/java
   2           /usr/lib/jvm/jre-1.6.0-sun/bin/java
*+ 3         /usr/lib/jvm/jre-1.5.0-sun/bin/java


Enter to keep the current selection[+], or type selection number:
</pre><p>
					In our case, we want to use the Sun JDK, version 5, that we downloaded and installed, to run the <code class="command">java</code> executable. In the <code class="command">alternatives</code> information printout above, a plus (<code class="literal">+</code>) next to a number indicates the one currently being used. As per <code class="command">alternatives</code>' instructions, pressing <span class="keycap"><strong>Enter</strong></span> will simply keep the current JVM, or you can enter the number corresponding to the JVM you would prefer to use.
				</p><p>
					Repeat the procedure above for the <code class="command">javac</code> command and the <code class="literal">java_sdk_1.5.0</code> environment variable, <span class="emphasis"><em>as the root user</em></span>:
				</p><pre class="screen">~]$ /usr/sbin/alternatives --config javac</pre><pre class="screen">~]$ /usr/sbin/alternatives --config java_sdk_1.5.0</pre></dd><dt><span class="term">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Windows</span></dt><dd><p>
					For information on how to set environment variables in Windows, refer to <a class="ulink" href="http://support.microsoft.com/kb/931715">http://support.microsoft.com/kb/931715</a>.
				</p></dd></dl></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">
			Finally, to make sure that you are using the correct JDK or Java version (5 or higher), and that the java executable is in your <code class="envar">PATH</code>, run the <code class="command">java <code class="option">-version</code>
			</code> command in the terminal from your home directory:
		</p><pre class="screen">~]$ java -version
java version "1.5.0_16"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b03)
Java HotSpot(TM) Client VM (build 1.5.0_16-b03, mixed mode, sharing)</pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">
			There is usually no reason (other than space concerns) to remove a particular JDK from your system, given that you can switch between JDKs and JREs easily using <code class="command">alternatives</code>, and/or by setting <code class="envar">JAVA_HOME</code>.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling the JDK on Linux</h5><p class="formalpara">
			On RPM-based systems, you can uninstall the JDK using the <code class="command">yum <code class="option">remove &lt;jdk_rpm_name&gt;</code>
			</code> command.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling the JDK on Windows</h5><p class="formalpara">
			On Windows systems, check the JDK entry in the <code class="literal">Start</code> menu for an uninstall command, or use <code class="literal">Add/Remove Programs</code>.
		</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-PreInstall_Requirements_and_Prerequisites"/>2.1.2. Pre-install Requirements and Prerequisites</h3></div></div></div><p/><div class="variablelist"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Hardware_Requirements"/><p class="title"><b>Hardware Requirements</b></p><dl><dt><span class="term">Sufficient Disk Space</span></dt><dd><p>Once unzipped, version 1.4.0.FINAL of the MSS for JBoss binary release requires a minimum of 20MB free disk space.</p></dd><dt><span class="term">Anything Java Itself Will Run On</span></dt><dd><p>MSS for JBoss is 100% Java and will run on the same hardware that the JBoss Application Server runs on.</p></dd></dl></div><div class="variablelist"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">JDK 5 or Higher</span></dt><dd><p>A working installation of the Java Development Kit (&lt;acronym&gt;JDK&lt;/acronym&gt;) version 5 or higher is currently required in order to run MSS for JBoss binary distribution. For instructions on how to install the JDK, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing" title="2.1.4. Installing">Section 2.1.4, “Installing”</a></p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Downloading"/>2.1.3. Downloading</h3></div></div></div><p>The latest version of Mobicents SIP Servlets for JBoss is available from <a class="ulink" href="http://www.mobicents.org/mss-downloads.html">http://www.mobicents.org/mss-downloads.html</a>.  The top row of the table contains the latest version.</p><p>Each version of the SIP Servlets Server is comprised of two separate binary distribution files: one which is MSS for JBoss, and the other which is MSS for Tomcat.  Download SIP Servlets Server for JBoss and continue with the following instructions.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing"/>2.1.4. Installing</h3></div></div></div><p>Once the requirements and prerequisites have been met and you have downloaded the binary distribution zip file, you are ready to install the MSS for JBoss binary distribution.  Follow the instructions below for the selected platform, whether Linux or Windows.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="bssswjicar--binary-SIP_Servlets_Server_with_JBoss-Use_Version_Numbers_Relevant_to_Your_Installation"/><h2>Version Numbers</h2><p>For clarity, the command line instructions presented in this chapter use specific version numbers and directory names.  Ensure this information is substituted with the binary distribution's version numbers and file names.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1109"/><p class="title"><b>Procedure 2.3. Installing the MSS for JBoss Binary Distribution on Linux</b></p><p>It is assumed that the downloaded archive is saved in the home directory, and that a terminal window is open displaying the home directory</p><ol class="1"><li><p>Create a subdirectory to extract the MSS for JBoss files into.  For ease of identification, it is recommended that the version number of the binary is included in this directory name.</p><pre class="screen">~]$ mkdir "mss-jboss-&lt;version&gt;"</pre></li><li><p>Move the downloaded zip file into the directory.</p><pre class="screen">~]$ mv "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip" "mss-jboss-&lt;version&gt;"</pre></li><li><p>Move into the directory.</p><pre class="screen">~]$ cd "mss-jboss-&lt;version&gt;"</pre></li><li><p>Extract the files into the current directory by executing one of the following commands.</p><div class="itemizedlist"><ul><li><p>Java: </p><pre class="screen">mss-jboss-&lt;version&gt;]$ jar -xvf "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li><li><p>Linux: </p><pre class="screen">mss-jboss-&lt;version&gt;]$ unzip "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ul></div><div class="note"><h2>Note</h2><p>You can also use <code class="command">unzip</code>'-d &lt;unzip_to_location&gt; to extract the zip file's contents to a location other than the current directory.</p></div></li><li><p>To free disk space, you may want to delete the zip file once you've extracted its contents:</p><pre class="screen">mss-jboss-&lt;version&gt;]$ rm "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1154"/><p class="title"><b>Procedure 2.4. Installing the MSS for JBoss Binary Distribution on <span class="productname">Windows</span></b></p><p>For this procedure, it is assumed that the downloaded archive is saved in the <code class="filename">My Downloads</code> folder.</p><ol class="1"><li><p>Create a directory in <code class="filename">My Downloads</code> to extract the zip file's contents into.  For ease of identification, it is recommended that the version number of the binary is included in the folder name.  For example, <code class="filename">MSS-jboss-&lt;version&gt;</code>.</p></li><li><p>Extract the contents of the archive, specifying the destination folder as the one created in the previous step.</p></li><li><p>Alternatively, execute the <code class="command">jar -xvf</code> command to extract the binary distribution files from the zip archive.</p><div class="orderedlist"><ol><li><p>Move the downloaded zip file from <code class="filename">My Downloads</code> to the folder created in the previous step.</p></li><li><p>Open the Windows Command Prompt and navigate to the folder that contains the archive using the <code class="command">cd</code> command</p></li><li><p>Execute the <code class="command">jar -xvf</code> command to extract the archive contents into the current folder.</p><pre class="screen">C:\Users\&lt;user&gt;\My Downloads\mss-jboss-&lt;version&gt;&gt;jar -xvf "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ol></div></li><li><p>It is recommended that the folder holding the MSS for JBoss files (in this example, the folder named <code class="filename">mss-jboss-<em class="replaceable"><code>&lt;version&gt;</code></em></code>) is moved to a user-defined location for storing executable programs.  For example, the <code class="filename">Program Files</code> folder.</p></li><li><p>Consider deleting the archive, if free disk space is an issue.</p><pre class="screen">C:\Users\&lt;user&gt;\My Downloads\mss-jboss-&lt;version&gt;&gt;delete "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Setting_the_JBOSS_HOME_Environment_Variable"/>2.1.5. Setting the JBOSS_HOME Environment Variable</h3></div></div></div><p>Configuring MSS for JBoss consists of setting the <code class="envar">JBOSS_HOME</code> environment variable and optionally customizing the MSS for JBoss server by adding SIP Connectors, configuring the application router, and logging.</p><p>After setting <code class="envar">JBOSS_HOME</code> according to the instructions in the following section, refer to <a class="xref" href="#bsssc-binary-SIP_Servlets_Server-Configuring" title="2.3. Configuring">Section 2.3, “Configuring”</a> to learn how to configure MSS for JBoss.</p><p>Alternatively, after having set <code class="envar">JBOSS_HOME</code>, the MSS for JBoss server can be run.  Return to this section to configure it later. </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1239"/>2.1.5.1. Setting the JBOSS_HOME Environment Variable</h4></div></div></div><p>
		The <span class="application"><strong>Mobicents Platform</strong></span> (<span class="application"><strong>Mobicents</strong></span>) is built on top of the <span class="application"><strong>JBoss Application Server</strong></span> (<span class="application"><strong>JBoss AS</strong></span>). You do not need to set the <code class="envar">JBOSS_HOME</code> environment variable to run any of the <span class="application"><strong>Mobicents Platform</strong></span> servers <span class="emphasis"><em>unless</em></span> <code class="envar">JBOSS_HOME</code> is <span class="emphasis"><em>already</em></span> set.
	</p><p>The best way to know for sure whether <code class="envar">JBOSS_HOME</code> was set previously or not is to perform a simple check which may save you time and frustration.</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Checking to See If JBOSS_HOME is Set on Unix</h5><p class="formalpara">At the command line, <code class="command">echo</code>
			<strong class="userinput"><code>$JBOSS_HOME</code></strong> to see if it is currently defined in your environment:</p><pre class="screen">~]$ echo $JBOSS_HOME</pre><p>The <span class="application"><strong>Mobicents Platform</strong></span> and most Mobicents servers are built on top of the <span class="application"><strong>JBoss Application Server</strong></span> (<span class="application"><strong>JBoss AS</strong></span>). When the <span class="application"><strong>Mobicents Platform</strong></span> or Mobicents servers are built <span class="emphasis"><em>from source</em></span>, then <code class="envar">JBOSS_HOME</code> <span class="emphasis"><em>must</em></span> be set, because the Mobicents files are installed into (or “<span class="quote">over top of</span>” if you prefer) a clean <span class="application"><strong>JBoss AS</strong></span> installation, and the build process assumes that the location pointed to by the <code class="envar">JBOSS_HOME</code> environment variable at the time of building is the <span class="application"><strong>JBoss AS</strong></span> installation into which you want it to install the Mobicents files.
	</p><p>This guide does not detail building the <span class="application"><strong>Mobicents Platform</strong></span> or any Mobicents servers from source. It is nevertheless useful to understand the role played by <span class="application"><strong>JBoss AS</strong></span> and <code class="envar">JBOSS_HOME</code> in the Mobicents ecosystem.</p><p>
		The immediately-following section considers whether you need to set <code class="envar">JBOSS_HOME</code> at all and, if so, when. The subsequent sections detail how to set <code class="envar">JBOSS_HOME</code> on Unix and Windows
	</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
			Even if you fall into the category below of <span class="emphasis"><em>not needing</em></span> to set <code class="envar">JBOSS_HOME</code>, you may want to for various reasons anyway. Also, even if you are instructed that you do <span class="emphasis"><em>not need</em></span> to set <code class="envar">JBOSS_HOME</code>, it is good practice nonetheless to check and make sure that <code class="envar">JBOSS_HOME</code> actually <span class="emphasis"><em>isn't</em></span> set or defined on your system for some reason. This can save you both time and frustration.
		</p></div><h5><a id="d0e1365"/>You <span class="emphasis"><em>DO NOT NEED</em></span> to set <code class="envar">JBOSS_HOME</code> if...</h5><div class="itemizedlist"><ul><li><p>
				...you have installed the <span class="application"><strong>Mobicents Platform</strong></span> binary distribution.
			</p></li><li><p>
				...you have installed a Mobicents server binary distribution <span class="emphasis"><em>which bundles <span class="application"><strong>JBoss AS</strong></span>.</em></span>
			</p></li></ul></div><h5><a id="d0e1389"/>You <span class="emphasis"><em>MUST</em></span> set <code class="envar">JBOSS_HOME</code> if...</h5><div class="itemizedlist"><ul><li><p>
				...you are installing the <span class="application"><strong>Mobicents Platform</strong></span> or any of the Mobicents servers <span class="emphasis"><em>from source</em></span>.
			</p></li><li><p>
				...you are installing the <span class="application"><strong>Mobicents Platform</strong></span> binary distribution, or one of the Mobicents server binary distributions, which <span class="emphasis"><em>do not</em></span> bundle <span class="application"><strong>JBoss AS</strong></span>.
			</p></li></ul></div><p>
		Naturally, if you installed the <span class="application"><strong>Mobicents Platform</strong></span> or one of the Mobicents server binary releases which <span class="emphasis"><em>do not</em></span> bundle <span class="application"><strong>JBoss AS</strong></span>, yet requires it to run, then you should <a class="ulink" href="http://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html_single/index.html">install <span class="application"><strong>JBoss AS</strong></span>
		</a> before setting <code class="envar">JBOSS_HOME</code> or proceeding with anything else.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the JBOSS_HOME Environment Variable on Unix</h5><p class="formalpara">
			The <code class="envar">JBOSS_HOME</code> environment variable must point to the directory which contains all of the files for the <span><span class="application"><strong>Mobicents Platform</strong></span> or individual Mobicents server</span> that you installed. As another hint, this topmost directory contains a <code class="filename">bin</code> subdirectory.
		</p><p>
		Setting <code class="envar">JBOSS_HOME</code> in your personal <code class="filename">~/.bashrc</code> startup script carries the advantage of retaining effect over reboots. Each time you log in, the environment variable is sure to be set for you, as a user. On Unix, it is possible to set <code class="envar">JBOSS_HOME</code> as a system-wide environment variable, by defining it in <code class="filename">/etc/bashrc</code>, but this method is neither recommended nor detailed in these instructions.
	</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1469"/><p class="title"><b>Procedure 2.5. To Set JBOSS_HOME on Unix...</b></p><ol class="1"><li><p>
				Open the <code class="filename">~/.bashrc</code> startup script, which is a hidden file in your home directory, in a text editor, and insert the following line on its own line while substituting for the actual install location on your system:
			</p><pre class="screen">export JBOSS_HOME="/home/&lt;username&gt;/&lt;path&gt;/&lt;to&gt;/&lt;install_directory&gt;"</pre></li><li><p>
				Save and close the <code class="filename">.bashrc</code> startup script.
			</p></li><li><p>
				You should <code class="command">source</code> the <code class="filename">.bashrc</code> script to force your change to take effect, so that <code class="envar">JBOSS_HOME</code> becomes set for the current session<sup>[<a id="d0e1499" href="#ftn.d0e1499" class="footnote">2</a>]</sup>.
			</p><pre class="screen">~]$ source ~/.bashrc</pre></li><li><p>
				Finally, ensure that <code class="envar">JBOSS_HOME</code> is set in the current session, and actually points to the correct location:
			</p><div class="note"><h2>Note</h2><p>
					The command line usage below is based upon a binary installation of the <span class="application"><strong>Mobicents Platform</strong></span>. In this sample output, <code class="envar">JBOSS_HOME</code> has been set correctly to the <em class="replaceable"><code>topmost_directory</code></em> of the <span class="application"><strong>Mobicents</strong></span> installation. Note that if you are installing one of the standalone <span class="application"><strong>Mobicents</strong></span> servers (with <span class="application"><strong>JBoss AS</strong></span> bundled!), then <code class="envar">JBOSS_HOME</code> would point to the <em class="replaceable"><code>topmost_directory</code></em> of your server installation.
				</p></div><pre class="screen">~]$ echo $JBOSS_HOME
/home/silas/mobicents-all-1.2.1.GA-jboss-4.2.3.GA/jboss/</pre></li></ol></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the JBOSS_HOME Environment Variable on Windows</h5><p class="formalpara">
			The <code class="envar">JBOSS_HOME</code> environment variable must point to the directory which contains all of the files for the <span>Mobicents Platform or individual Mobicents server</span> that you installed. As another hint, this topmost directory contains a <code class="filename">bin</code> subdirectory.
		</p><p>
		For information on how to set environment variables in recent versions of Windows, refer to <a class="ulink" href="http://support.microsoft.com/kb/931715">http://support.microsoft.com/kb/931715</a>.
	</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Configuring"/>2.1.6. Configuring</h3></div></div></div><p>To configure MSS for JBoss, refer to <a class="xref" href="#bsssc-binary-SIP_Servlets_Server-Configuring" title="2.3. Configuring">Section 2.3, “Configuring”</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running"/>2.1.7. Running</h3></div></div></div><p>To start the server, execute one of the startup scripts in the <code class="filename">bin</code> directory (on Linux or Windows), or by double-clicking the <code class="filename">run.bat</code> executable batch file in that same directory (on Windows only).  It is recommended that the JBoss Application Server is started using the terminal or Command Prompt because the messages displayed during startup can be used to debug, and subsequently correct, any problems.  In the Linux terminal or Command Prompt, a successfully started server will return the following information :</p><pre class="programlisting">22:39:07,598 INFO  [SipApplicationDispatcherImpl] Mobicents Sip Servlets &lt;version&gt; - revision &lt;rev number&gt; started.</pre><p>Detailed instructions are given below, arranged by platform.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1594"/><p class="title"><b>Procedure 2.6. Running MSS for JBoss on Linux</b></p><ol class="1"><li><p>Change the working directory to MSS for JBoss's installation directory (the one in which the zip file's contents was extracted to)</p><pre class="screen">downloads]$ cd "mss-jboss-&lt;version&gt;"</pre></li><li><p>(Optional) Ensure that the <code class="filename">bin/run.sh</code> start script is executable.</p><pre class="screen">mss-jboss-&lt;version&gt;]$ chmod +x bin/run.sh</pre></li><li><p>Execute the <code class="filename">run.sh</code> Bourne shell script.</p><pre class="screen">mss-jboss-&lt;version&gt;]$ ./bin/run.sh</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Instead of executing the Bourne shell script to start the server, the <code class="filename">run.jar</code> executable Java archive can be executed from the <code class="filename">bin</code> directory:</p><pre class="screen">mss-jboss-&lt;version&gt;]$ java -jar bin/run.jar</pre></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1629"/><p class="title"><b>Procedure 2.7. Running MSS for JBoss on <span class="productname">Windows</span></b></p><p>There are several ways to start MSS for JBoss on Windows. All of the following methods accomplish the same task.</p><ol class="1"><li><p>Using Windows Explorer, navigate to the <code class="filename">bin</code> subdirectory in the installation directory.</p></li><li><p>The preferred way to start MSS for JBoss from the Command Prompt.  The command line interface displays details of the startup process, including any problems encountered during the startup process.</p><p>Open the Command Prompt via the <span class="guilabel"><strong>Start</strong></span> menu and navigate to the correct folder:</p><pre class="screen">C:\Users\&lt;user&gt;My Downloads&gt; cd "mss-jboss-&lt;version&gt;"</pre></li><li><p>Start the JBoss Application Server by executing one of the following files:
        </p><div class="itemizedlist"><ul><li><p><code class="filename">run.bat</code> batch file:</p><pre class="screen">C:\Users\&lt;user&gt;My Downloads\mss-jboss-&lt;version&gt;&gt;bin\run.bat</pre></li><li><p><code class="filename">run.jar</code> executable Java archive:</p><pre class="screen">C:\Users\&lt;user&gt;My Downloads\mss-jboss-&lt;version&gt;&gt;java -jar bin\run.jar</pre></li></ul></div><p>
        </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Using"/>2.1.8. Using</h3></div></div></div><p>Once the server is running, access the SIP Servlets Management Console by opening <a class="ulink" href="http://localhost:8080/sip-servlets-management/">http://localhost:8080/sip-servlets-management/</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1678"/>2.1.9. Testing</h3></div></div></div><p>After installation, there should be one pre-configured sample application deployed in the <code class="literal">default</code> server onfiguration. You can use it to verify that the server is installed and running correctly. The application name is “<span class="quote">org.mobicents.servlet.sip.example.SimpleApplication</span>”. From the Sip Servlets Management Console you can make sure it is subscribed to receive <code class="literal">INVITE</code> and <code class="literal">REGISTER</code> SIP requests.  It is a simple <code class="filename">Click2Call</code> application allowing SIP registration and calling phones from the Web user interface.</p><p>The scenario for this example consists of the following steps:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Alice and Bob each register a SIP Softphone</p></li><li><p>Alice clicks on the "Call" link to place a call to Bob</p></li><li><p>Alice's phone rings</p></li><li><p>When Alice picks up her phone, Bob's phone rings</p></li><li><p>When Bob answers his phone, the call is connected</p></li><li><p>When one of them hangs up, the other one is also disconnected </p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1719"/><p class="title"><b>Procedure 2.8. Testing the Click2Call sample application</b></p><ol class="1"><li><p>Open up a browser to <a class="ulink" href="http://localhost:8080/click2call/">http://localhost:8080/click2call/</a>. If you have no registered SIP clients you will be asked to register at least two.</p></li><li><p>Configure your SIP clients to use the sip servlets server as a register and proxy. (IP address : 127.0.0.1, port: 5080)
By default it will accept any password</p></li><li><p>After the registration you will see a table where each cell will initiate a call between the corresponding clients.</p></li><li><p>Close the calls.</p></li><li><p>Navigate to <a class="ulink" href="http://localhost:8080/click2call/simplecall.html">http://localhost:8080/click2call/simplecall.html</a>, which is a simplified version that doesn't require registered clients.
</p></li><li><p>Enter the URIs of the two SIP phones you just started and click "Submit"</p></li><li><p>The phones should be ringing again. You can pick them up and you will know that the SIP and the HTTP containers are working properly.</p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping"/>2.1.10. Stopping</h3></div></div></div><p>Detailed instructions for stopping the JBoss Application Server are given below, arranged by platform.  If the server is correctly stopped, the following three lines are displayed as the last output in the Linux terminal or Command Prompt:</p><pre class="programlisting">[Server] Shutdown complete
Shutdown complete
Halting VM</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1757"/><p class="title"><b>Procedure 2.9. Stopping MSS for JBoss on Linux</b></p><ol class="1"><li><p>Change the working directory to the binary distribution's install directory.</p><pre class="screen">~]$ cd "mss-jboss-&lt;version&gt;"</pre></li><li><p>(Optional) Ensure that the bin/shutdown.sh start script is executable:</p><pre class="screen">mss-jboss-&lt;version&gt;]$ chmod +x bin/shutdown.sh</pre></li><li><p>Run the <code class="filename">shutdown.sh</code> executable Bourne shell script with the <code class="option">-S</code> option (the short option for <code class="option">--shutdown</code>) as a command line argument:</p><pre class="screen">mss-jboss-&lt;version&gt;]$ ./bin/shutdown.sh -S</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The <code class="filename">shutdown.jar</code> executable Java archive with the <code class="option">-S</code> option can also be used to shut down the server:</p><pre class="screen">mss-jboss-&lt;version&gt;]$ java -jar bin/shutdown.jar -S</pre></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1795"/><p class="title"><b>Procedure 2.10. Stopping mss for JBoss on Windows</b></p><ul><li><p>Stopping the JBoss Application Server on Windows consists in executing either the <code class="filename">shutdown.bat</code> or the <code class="filename">shutdown.jar</code> executable file in the <code class="filename">bin</code> subdirectory of the MSS for JBoss binary distribution. Ensure the <code class="option">-S</code> option (the short option for <code class="option">--shutdown</code>) is included in the command line argument.</p><pre class="screen">C:\Users\&lt;user&gt;\My Downloads\mss-jboss-&lt;version&gt;&gt;bin\shutdown.bat -S</pre><ul>
          <li><p>The <code class="filename">shutdown.jar</code> executable Java archive with the <code class="option">-S</code> option can also be used to shut down the server:</p><pre class="screen">C:\Users\&lt;user&gt;\My Downloads\mss-jboss-&lt;version&gt;&gt;java -jar bin\shutdown.jar -S</pre></li>
        </ul></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Uninstalling"/>2.1.11. Uninstalling</h3></div></div></div><p>To uninstall MSS for JBoss, delete the directory containing the binary distribution.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running"/>2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running</h2></div></div></div><p>You can also run Mobicents SIP Servlets on top of the Apache Tomcat Servlet Container. This section provides information on the requirements and prerequisites for running MSS for Tomcat, as well as instructions on how to download, install, configure, run, use, stop, test and uninstall it.</p><p>Keep in mind that not all capabilities provided by running Mobicents SIP Servlets Server on top of the JBoss Application Server are available with MSS for Tomcat. In particular, MSS for Tomcat lacks support for both clustering and failover; MSS for Tomcat nodes can utilize the SIP load balancer, however.</p><p>If you are interested in clustering and failover support, or would rather run the Mobicents SIP Servlets Server on top of the JBoss Application Server, go to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Differences Between the Standard Tomcat Installation and One Customized for the SIP Servlets Server</h5><p class="formalpara">Provided here is a list of differences between a standard Tomcat Servlet Container installation and the SIP Servlets Server for Tomcat installation. The differences include:</p><div class="itemizedlist"><ul><li><p>The <code class="filename">server.xml</code> configuration file has been modified to provide extended classes to the standard Tomcat container classes, in order to allow SIP applications to be loaded and the SIP stack started.</p></li><li><p>A <code class="filename">dars</code> directory containing the default applications' router properties files for using the SIP Servlet Click-to-Call application (which comes bundled with the release) has been added to the <code class="filename">conf</code> directory.</p></li><li><p>Additional JAR files which can be found in the <code class="filename">lib</code> directory have been added to enable SIP Servlet functionality.</p></li></ul></div><h3><a id="bssswticar-Installing_the_Java_Development_Kit"/>Installing the Java Development Kit</h3><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1880"/>2.2.1. Java Development Kit (<acronym class="acronym">JDK</acronym>): Installing, Configuring and Running</h3></div></div></div><p>
		The <span class="application"><strong>Mobicents Platform</strong></span> is written in Java; therefore, before running any <span class="application"><strong>Mobicents</strong></span> server, you must have a working Java Runtime Environment (<acronym class="acronym">JRE</acronym>) or Java Development Kit (<acronym class="acronym">JDK</acronym>) installed on your system. In addition, the JRE or JDK you are using to run <span class="application"><strong>Mobicents</strong></span> must be version 5 or higher<sup>[<a id="d0e1903" href="#ftn.d0e1903" class="footnote">3</a>]</sup>.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Should I Install the JRE or JDK?</h5><p class="formalpara">
			Although you can run <span class="application"><strong>Mobicents</strong></span> servers using the Java Runtime Environment, we assume that most users are developers interested in developing Java-based, <span class="application"><strong>Mobicents</strong></span>-driven solutions. Therefore, in this guide we take the tact of showing how to install the full Java Development Kit.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Should I Install the 32-Bit or the 64-Bit JDK, and Does It Matter?</h5><p class="formalpara">
			Briefly stated: if you are running on a 64-Bit Linux or Windows platform, you should consider installing and running the 64-bit JDK over the 32-bit one. Here are some heuristics for determining whether you would rather run the 64-bit Java Virtual Machine (JVM) over its 32-bit cousin for your application:
		</p><div class="itemizedlist"><ul><li><p>
				Wider datapath: the pipe between RAM and CPU is doubled, which improves the performance of memory-bound applications when using a 64-bit JVM.
			</p></li><li><p>
				64-bit memory addressing gives virtually unlimited (1 exabyte) heap allocation. However large heaps affect garbage collection.
			</p></li><li><p>
				Applications that run with more than 1.5 GB of RAM (including free space for garbage collection optimization) should utilize the 64-bit JVM.
			</p></li><li><p>
				Applications that run on a 32-bit JVM and do not require more than minimal heap sizes will gain nothing from a 64-bit JVM. Barring memory issues, 64-bit hardware with the same relative clock speed and architecture is not likely to run Java applications faster than their 32-bit cousin.
			</p></li></ul></div><p>
		Note that the following instructions detail how to download and install the 32-bit JDK, although the steps are nearly identical for installing the 64-bit version.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">
			You can download the Sun JDK 5.0 (Java 2 Development Kit) from Sun's website: <a class="ulink" href="http://java.sun.com/javase/downloads/index_jdk5.jsp">http://java.sun.com/javase/downloads/index_jdk5.jsp</a>. Click on the <span class="guilabel"><strong>Download</strong></span> link next to "JDK 5.0 Update <em class="replaceable"><code>&lt;x&gt;</code></em>" (where <em class="replaceable"><code>&lt;x&gt;</code></em> is the latest minor version release number). On the next page, select your language and platform (both architecture—whether 32- or 64-bit—and operating system), read and agree to the <code class="literal">Java Development Kit 5.0 License Agreement</code>, and proceed to the download page.
		</p><p>
		The Sun website will present two download alternatives to you: one is an RPM inside a self-extracting file (for example, <code class="filename">jdk-1_5_0_16-linux-i586-rpm.bin</code>), and the other is merely a self-extracting file (e.g. <code class="filename">jdk-1_5_0_16-linux-i586.bin</code>). If you are installing the JDK on Red Hat Enterprise Linux, Fedora, or another RPM-based Linux system, we suggest that you download the self-extracting file containing the RPM package, which will set up and use the SysV service scripts in addition to installing the JDK. We also suggest installing the self-extracting RPM file if you will be running <span class="application"><strong>Mobicents</strong></span> in a production environment.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">
			The following procedures detail how to install the Java Development Kit on both Linux and Windows.
		</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1981"/><p class="title"><b>Procedure 2.11. Installing the JDK on Linux</b></p><ul><li><p>
				Regardless of which file you downloaded, you can install it on Linux by simply making sure the file is executable and then running it:
			</p><pre class="screen">~]$ chmod +x "jdk-1_5_0_&lt;minor_version&gt;-linux-&lt;architecture&gt;-rpm.bin"
~]$ ./"jdk-1_5_0_&lt;minor_version&gt;-linux-&lt;architecture&gt;-rpm.bin"</pre></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>You Installed Using the Non-RPM Installer, but Want the SysV Service Scripts</h2><p>
			If you download the non-RPM self-extracting file (and installed it), and you are running on an RPM-based system, you can still set up the SysV service scripts by downloading and installing one of the <code class="literal">-compat</code> packages from the JPackage project. Remember to download the <code class="literal">-compat</code> package which corresponds correctly to the minor release number of the JDK you installed. The compat packages are available from <a class="ulink" href="ftp://jpackage.hmdc.harvard.edu/JPackage/1.7/generic/RPMS.non-free/">ftp://jpackage.hmdc.harvard.edu/JPackage/1.7/generic/RPMS.non-free/</a>.
		</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
			You do not need to install a <code class="literal">-compat</code> package in addition to the JDK if you installed the self-extracting RPM file! The <code class="literal">-compat</code> package merely performs the same SysV service script set up that the RPM version of the JDK installer does.
		</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2012"/><p class="title"><b>Procedure 2.12. Installing the JDK on Windows</b></p><ul><li><p>
				Using Explorer, simply double-click the downloaded self-extracting installer and follow the instructions to install the JDK.
			</p></li></ul></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">
			Configuring your system for the JDK consists in two tasks: setting the <code class="envar">JAVA_HOME</code> environment variable, and ensuring that the system is using the proper JDK (or JRE) using the <code class="command">alternatives</code> command. Setting <code class="envar">JAVA_HOME</code> usually overrides the values for <code class="command">java</code>, <code class="command">javac</code> and <code class="command">java_sdk_1.5.0</code> in <code class="command">alternatives</code>, but we will set them all just to be safe and consistent.
		</p><div class="variablelist"><dl><dt><span class="term">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Generic Linux</span></dt><dd><p>
					After installing the JDK, you must ensure that the <code class="envar">JAVA_HOME</code> environment variable exists and points to the location of your JDK installation.
				</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Linux</h5><p class="formalpara">
						You can determine whether <code class="envar">JAVA_HOME</code> is set on your system by <code class="command">echo</code>ing it on the command line:
					</p><pre class="screen">~]$ echo $JAVA_HOME</pre><p>
					If <code class="envar">JAVA_HOME</code> is not set already, then you must set its value to the location of the JDK installation on your system. You can do this by adding two lines to your personal <code class="filename">~/.bashrc</code> configuration file. Open <code class="filename">~/.bashrc</code> (or create it if it doesn't exist) and add a line similar to the following one anywhere inside the file:
				</p><pre class="programlisting">export JAVA_HOME="/usr/lib/jvm/jdk1.5.0_&lt;version&gt;"
</pre><p>
					You should also set this environment variable for any other users who will be running <span class="application"><strong>Mobicents</strong></span> (any environment variables <code class="command">export</code>ed from <code class="filename">~/.bashrc</code> files are local to that user).
				</p></dd><dt><span class="term">Setting <code class="envar">java</code>, <code class="envar">javac</code> and <code class="envar">java_sdk_1.5.0</code> Using the <code class="command">alternatives</code> command </span></dt><dd><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Selecting the Correct System JVM on Linux using <code class="command">alternatives</code>
					</h5><p class="formalpara">
						On systems with the <code class="command">alternatives</code> command, including Red Hat Enterprise Linux and Fedora, you can easily choose which JDK (or JRE) installation you wish to use, as well as which <code class="command">java</code> and <code class="command">javac</code> executables should be run when called.
					</p><p>
					<span class="emphasis"><em>As the root user</em></span>, call <code class="command">/usr/sbin/alternatives</code> with the <code class="option">--config java</code> option to select between JDKs and JREs installed on your system:
				</p><pre class="programlisting">root@localhost ~]$ /usr/sbin/alternatives --config java

There are 3 programs which provide 'java'.

  Selection    Command
-----------------------------------------------
   1           /usr/lib/jvm/jre-1.5.0-gcj/bin/java
   2           /usr/lib/jvm/jre-1.6.0-sun/bin/java
*+ 3         /usr/lib/jvm/jre-1.5.0-sun/bin/java


Enter to keep the current selection[+], or type selection number:
</pre><p>
					In our case, we want to use the Sun JDK, version 5, that we downloaded and installed, to run the <code class="command">java</code> executable. In the <code class="command">alternatives</code> information printout above, a plus (<code class="literal">+</code>) next to a number indicates the one currently being used. As per <code class="command">alternatives</code>' instructions, pressing <span class="keycap"><strong>Enter</strong></span> will simply keep the current JVM, or you can enter the number corresponding to the JVM you would prefer to use.
				</p><p>
					Repeat the procedure above for the <code class="command">javac</code> command and the <code class="literal">java_sdk_1.5.0</code> environment variable, <span class="emphasis"><em>as the root user</em></span>:
				</p><pre class="screen">~]$ /usr/sbin/alternatives --config javac</pre><pre class="screen">~]$ /usr/sbin/alternatives --config java_sdk_1.5.0</pre></dd><dt><span class="term">Setting the <code class="envar">JAVA_HOME</code> Environment Variable on Windows</span></dt><dd><p>
					For information on how to set environment variables in Windows, refer to <a class="ulink" href="http://support.microsoft.com/kb/931715">http://support.microsoft.com/kb/931715</a>.
				</p></dd></dl></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">
			Finally, to make sure that you are using the correct JDK or Java version (5 or higher), and that the java executable is in your <code class="envar">PATH</code>, run the <code class="command">java <code class="option">-version</code>
			</code> command in the terminal from your home directory:
		</p><pre class="screen">~]$ java -version
java version "1.5.0_16"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b03)
Java HotSpot(TM) Client VM (build 1.5.0_16-b03, mixed mode, sharing)</pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">
			There is usually no reason (other than space concerns) to remove a particular JDK from your system, given that you can switch between JDKs and JREs easily using <code class="command">alternatives</code>, and/or by setting <code class="envar">JAVA_HOME</code>.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling the JDK on Linux</h5><p class="formalpara">
			On RPM-based systems, you can uninstall the JDK using the <code class="command">yum <code class="option">remove &lt;jdk_rpm_name&gt;</code>
			</code> command.
		</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling the JDK on Windows</h5><p class="formalpara">
			On Windows systems, check the JDK entry in the <code class="literal">Start</code> menu for an uninstall command, or use <code class="literal">Add/Remove Programs</code>.
		</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-PreInstall_Requirements_and_Prerequisites"/>2.2.2. Pre-Install Requirements and Prerequisites</h3></div></div></div><div class="variablelist"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Hardware_Requirements"/><p class="title"><b>Hardware Requirements</b></p><dl><dt><span class="term">Sufficient Disk Space</span></dt><dd><p>You must have sufficient disk space in order to install the MSS for Tomcat binary release. Once unzipped, version 1.4.0.FINAL of the MSS for Tomcat binary release requires <span class="emphasis"><em>at least</em></span> 20MB of free disk space. Keep in mind that disk space requirements may change from release to release.</p></dd><dt><span class="term">Anything Java Itself Will Run On</span></dt><dd><p>MSS for Tomcat is 100% Java. It will run on the same hardware that the Tomcat Servlet Container runs on.</p></dd></dl></div><div class="variablelist"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">JDK 5 or Higher</span></dt><dd><p>A working installation of the Java Development Kit (<acronym class="acronym">JDK</acronym>) version 5 or higher is required in order to run MSS for Tomcat.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Downloading"/>2.2.3. Downloading</h3></div></div></div><p>You can download the latest version of MSS for Tomcat from <a class="ulink" href="http://www.mobicents.org/mss-downloads.html">http://www.mobicents.org/mss-downloads.html</a>. The top row of the table holds the latest version. Note that each release of the Mobicents SIP Servlets Server is comprised of two separate binary distribution files: one which is MSS for JBoss, and the other which is MSS for Tomcat. Download Mobicents SIP Servlets Server for Tomcat and continue with the following instructions.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Installing"/>2.2.4. Installing</h3></div></div></div><p>Once the requirements and prerequisites have been met and you have downloaded the binary distribution zip file, you are ready to install MSS for Tomcat. Follow the instructions below for your platform, whether Linux or Windows.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Use_Version_Numbers_Relevant_to_Your_Installation"/><h2>Use Version Numbers Relevant to Your Installation!</h2><p>For clarity, the command line instructions presented in this chapter use specific version numbers and directory names. Remember to replace them with version numbers and file names relevant to those you are actually working with.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2292"/><p class="title"><b>Procedure 2.13. Installing the MSS for Tomcat Binary Distribution on Linux</b></p><ol class="1"><li><p>For this example, we'll assume you're currently in your home directory, which is where you downloaded the zip file to. First, create a subdirectory to hold the unzipped MSS for Tomcat files. It is good practice to include the version number in this directory name; if you do so, remember to correctly match it with the version of the MSS for Tomcat distribution you downloaded.</p><pre class="screen">~]$ cd downloads</pre></li><li><p>In <code class="filename">downloads</code>, create a subdirectory to hold the unzipped MSS for Tomcat files. It is good practice to include the version number in this directory name; if you do so, remember to correctly match it with the version of the MSS for Tomcat binary distribution you downloaded.</p><pre class="screen">~]$ mkdir "mss-tomcat-&lt;version&gt;"</pre></li><li><p>Move the downloaded zip file into the directory you have just created:</p><pre class="screen">~]$ mv "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip" "mss-tomcat-&lt;version&gt;"</pre></li><li><p>Move into that directory:</p><pre class="screen">~]$ cd "mss-tomcat-&lt;version&gt;"</pre></li><li><p>Finally, use Java's <code class="command">jar <code class="option">-xvf</code></code> command to extract the contents of the zip file into the current directory, thus completing the install:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ jar -xvf "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre><ul>
          <li><p>Alternatively, if Linux's <code class="command">unzip</code> utility is present on your system or is installable, you can use it in lieu of Java's <code class="command">jar <code class="option">-xvf</code></code> command:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ unzip "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre><div class="note"><h2>Note</h2><p>You can also use <code class="command">unzip</code>'s <code class="option">-d</code>
        <code class="filename">
                  <em class="replaceable"><code>&lt;unzip_to_location&gt;</code></em>
                </code> option to extract the zip file's contents to a location other than the current directory.</p></div></li>
        </ul></li><li><p>To free disk space, you may want to delete the zip file once you've extracted its contents:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ rm "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2364"/><p class="title"><b>Procedure 2.14. Installing the MSS for Tomcat Binary Distribution on Windows</b></p><ol class="1"><li><p>For this example, we'll assume that you downloaded the binary distribution zip file to the <code class="filename">My Downloads</code> folder. First, using Windows Explorer, create a subdirectory in <code class="filename">My Downloads</code> to extract the zip file's contents into. When you name this folder, it is good practice to include the version number; if you do so, remember to correctly match it with the version of the MSS for Tomcat binary distribution you downloaded. In these instructions, we will refer to this folder as <code class="filename">mss-tomcat-<em class="replaceable"><code>&lt;version&gt;</code></em></code>.</p></li><li><p>Double-click the downloaded zip file, selecting as the destination folder the one you just created to hold the zip file's contents.</p><ul>
          <li><p>Alternatively, it is also possible to use Java's <code class="command">jar <code class="option">-xvf</code></code> command to extract the binary distribution files from the zip archive. To use this method instead, first move the downloaded zip file from <code class="filename">My Downloads</code> to the folder that you just created to hold the SIP Servlets Server files.</p></li>
          <li><p>Then, open the Windows Command Prompt and navigate to the folder holding the archive using the <code class="command">cd</code> command.</p><div class="note"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Opening_the_Command_Prompt_from_Windows_Explorer"/><h2>Opening the Command Prompt from Windows Explorer</h2><p>If you are using Windows Vista®, you can open the Command Prompt directly from Explorer. Hold down the <span class="keycap"><strong>Shift</strong></span> key and right-click on either a folder, the desktop, or inside a folder. This will cause an <span class="guimenuitem"><strong>Open Command Window Here</strong></span> context menu item to appear, which can be used to open the Command Prompt with the current working directory set to either the folder you opened, or opened it from.</p></div></li>
          <li><p>Finally, use the <code class="command">jar <code class="option">-xvf</code></code> command to extract the archive contents into the current folder.</p><pre class="screen">C:\Users\Me\My Downloads\mss-tomcat-&lt;version&gt;&gt;jar -xvf "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li>
        </ul></li><li><p>At this point, you may want to move the folder holding the MSS for Tomcat binary files (in this example, the folder named <code class="filename">mss-tomcat-<em class="replaceable"><code>&lt;version&gt;</code></em></code>) to another location. This step is not strictly necessary, but it is probably a good idea to move the installation folder from <code class="filename">My Downloads</code> to a user-defined location for storing runnable programs. Any location will suffice, however.</p></li><li><p>You may want to delete the zip file after extracting its contents in order to free disk space:</p><pre class="screen">C:\Users\Me\My Downloads\mss-tomcat-&lt;version&gt;&gt;delete "mss-1.3.1-apache-tomcat-6.0.20-1007051527.zip"</pre></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-SIP_Servlets_Server_with_Tomcat-Setting_the_CATALINA_HOME_Environment_Variable"/>2.2.5. Setting the CATALINA_HOME Environment Variable</h3></div></div></div><p>Before running the Mobicents server you are installing, you should consider if you need to set the <code class="envar">CATALINA_HOME</code> environment variable. Setting it (or re-setting it) will always work. Whether or not you <span class="emphasis"><em>need</em></span> to set <code class="envar">CATALINA_HOME</code> depends on the following factors:</p><div class="itemizedlist"><ul><li><p>If you are installing a binary Mobicents server and <code class="envar">CATALINA_HOME</code> is not set on your system, then you <span class="emphasis"><em>do not need</em></span> to set it, but doing so will do no harm.</p></li><li><p>If you are installing a binary Mobicents server and <code class="envar">CATALINA_HOME</code> is (already) set on your system, then you need to make sure it points to the location of the new Mobicents server.</p></li><li><p>If you are installing a Mobicents server from source which uses the Tomcat servlet container, then you <span class="emphasis"><em>must</em></span> set <code class="envar">CATALINA_HOME</code>.</p></li></ul></div><p>The following instructions detail how to set <code class="envar">CATALINA_HOME</code> on both Linux and Windows.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="bssswticar-Setting_the_CATALINA_HOME_Environment_Variable_on_Linux"/><p class="title"><b>Procedure 2.15. Setting the <code class="envar">CATALINA_HOME</code> Environment Variable on Linux</b></p><ol class="1"><li><p>The <code class="envar">CATALINA_HOME</code> environment variable must point to the location of your Tomcat installation. Any Mobicents server which runs on top of the Tomcat servlet container has a topmost directory, i.e. the directory in which you unzipped the zip file to install the server, and underneath that directory, a <code class="filename">bin</code> directory. <code class="envar">CATALINA_HOME</code> must be set to the topmost directory of your Mobicents server installation.</p><p>Setting this variable in your personal <code class="filename">~/.bashrc</code> file has the advantage that it will always be set (for you, as a user) each time you log in or reboot the system. To do so, open <code class="filename">~/.bashrc</code> in a text editor (or create the file if it doesn't already exist) and insert the following line anywhere in the file, taking care to substitute <code class="filename">&lt;mobicents_server&gt;</code> for the topmost directory of the Mobicents server you installed:</p><pre class="screen">export CATALINA_HOME="/home/&lt;username&gt;/&lt;path&gt;/&lt;to&gt;/&lt;mobicents_server&gt;"</pre><p>Save and close <code class="filename">.bashrc</code>.</p></li><li><p>You can—and should—<code class="command">source</code> your <code class="filename">.bashrc</code> file to make your change take effect (so that <code class="envar">CATALINA_HOME</code> is set) for the current session:</p><pre class="screen">~]$ source ~/.bashrc</pre></li><li><p>Finally, make sure that <code class="envar">CATALINA_HOME</code> has been set correctly (that it leads to the right directory), and has taken effect in the current session.</p><p>The following command will show the path to the directory pointed to by <code class="envar">CATALINA_HOME</code>:</p><pre class="screen">~]$ echo $CATALINA_HOME</pre><p>To be absolutely sure, change your directory to the one pointed to by <code class="envar">CATALINA_HOME</code>:</p><pre class="screen">~]$ cd $CATALINA_HOME &amp;&amp; pwd</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="bssswticar-Setting_the_CATALINA_HOME_Environment_Variable_on_Windows"/><p class="title"><b>Procedure 2.16. Setting the <code class="envar">CATALINA_HOME</code> Environment Variable on Windows</b></p><ul><li><p>The <code class="envar">CATALINA_HOME</code> environment variable must point to the location of your Tomcat installation. Any Mobicents server which runs on top of the Tomcat servlet container has a topmost directory, i.e. the directory in which you unzipped the zip file to install the server, and underneath that directory, a <code class="filename">bin</code> directory. <code class="envar">CATALINA_HOME</code> must be set to the topmost directory of your Mobicents server installation.</p><p>If you are planning on running the Tomcat container as the Administrator, then you should, of course, set the <code class="envar">CATALINA_HOME</code> environment variable <span class="emphasis"><em>as the administrator</em></span>, and if you planning to run Tomcat as a normal user, then set <code class="envar">CATALINA_HOME</code> as a user environment variable.</p><p>For information on how to set environment variables in Windows, refer to <a class="ulink" href="http://support.microsoft.com/kb/931715">http://support.microsoft.com/kb/931715</a>.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Configuring"/>2.2.6. Configuring</h3></div></div></div><p>Configuring MSS for Tomcat consists in setting the <code class="envar">CATALINA_HOME</code> environment variable and then, optionally, customizing your MSS for Tomcat container by adding SIP Connectors, configuring the application router, and configuring logging. See <a class="xref" href="#bsssc-binary-SIP_Servlets_Server-Configuring" title="2.3. Configuring">Section 2.3, “Configuring”</a> to learn what and how to configure MSS for Tomcat.</p><p>Alternatively, you can simply run your MSS for Tomcat container now and return to this section to configure it later.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running"/>2.2.7. Running</h3></div></div></div><p>Once installed, you can run the Tomcat Servlet Container by executing the one of the startup scripts in the <code class="filename">bin</code> directory (on Linux or Windows), or by double-clicking the <code class="filename">run.bat</code> executable batch file in that same directory (on Windows only). However, we suggest always starting Tomcat using the terminal or Command Prompt because you are then able to read—and act upon—any startup messages, and possibly debug any problems that may arise. In the Linux terminal or Command Prompt, you will be able to tell that the container started successfully if the last line of output is similar to the following:</p><pre class="programlisting">Using CATALINA_BASE:   /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0
Using CATALINA_HOME:   /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0
Using CATALINA_TMPDIR: /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0/temp
Using JRE_HOME:       /etc/java-config-2/current-system-vm</pre><p>Detailed instructions are given below, arranged by platform.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2617"/><p class="title"><b>Procedure 2.17. Running MSS for Tomcat on Linux</b></p><ol class="1"><li><p>Change your working directory to the SIP Servlets-customized Tomcat's topmost directory (the one in which you extracted the zip file's contents to):</p><pre class="screen">~]$ cd "mss-tomcat-&lt;version&gt;"</pre></li><li><p>(Optional) Ensure that the <code class="filename">bin/startup.sh</code> start script is executable:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ chmod +x bin/startup.sh</pre></li><li><p>Finally, execute the <code class="filename">startup.sh</code> Bourne shell script:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ ./bin/startup.sh</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2641"/><p class="title"><b>Procedure 2.18. Running MSS for Tomcat on Windows</b></p><ol class="1"><li><p>There are several different ways to start the Tomcat Servlet Container on Windows. All of the following methods accomplish the same task.</p><p>Using Windows Explorer, change your folder to the one in which you unzipped the downloaded zip file, and then to the <code class="filename">bin</code> subdirectory.</p></li><li><p>Although not the preferred way (see below), it is possible to start the Tomcat Servlet Container by double-clicking on the <code class="filename">startup.bat</code> executable batch file.</p><ul>
          <li><p>As mentioned above, the best way to start the Tomcat Servlet Container is by using the Command Prompt. Doing it this way will allow you to view all of the server startup details, which will enable you to easily determine whether any problems were encountered during the startup process. You can open the Command Prompt directly from the <code class="filename">&lt;topmost_directory&gt;\bin</code> folder in Windows Explorer, or you can open the Command Prompt via the <span class="guilabel"><strong>Start</strong></span> menu and navigate to the correct folder:</p><pre class="screen">C:\Users\Me\My Downloads&gt; cd "mss-tomcat-&lt;version&gt;"</pre></li>
          <li><p>Start the Tomcat Servlet Container by running the executable <code class="filename">startup.bat</code> batch file:</p><pre class="screen">C:\Users\Me\My Downloads\mss-tomcat-&lt;version&gt;&gt;bin\startup.bat</pre></li>
        </ul></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping"/>2.2.8. Stopping</h3></div></div></div><p>Detailed instructions for stopping the Tomcat Servlet Container are given below, arranged by platform. Note that if you properly stop the server, you will see the following three lines as the last output in the Linux terminal or Command Prompt (both running and stopping the Tomcat Servlet Container produces the same output):</p><pre class="screen">Using CATALINA_BASE:   /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0
Using CATALINA_HOME:   /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0
Using CATALINA_TMPDIR: /home/silas/temp/apps/mobicents/sip_servlets_server/mss-tomcat-1.0/temp
Using JRE_HOME:       /etc/java-config-2/current-system-vm</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2690"/><p class="title"><b>Procedure 2.19. Stopping MSS for Tomcat on Linux by Executing <code class="filename">shutdown.sh</code></b></p><ol class="1"><li><p>You can shut down the Tomcat Servlet Container by executing the <code class="filename">shutdown.sh</code> Bourne shell script in the <code class="filename">&lt;topmost_directory&gt;/bin</code> directory. To do so, first change your working directory to the binary distribution's topmost directory (the one to which you extracted the downloaded zip file's contents):</p><pre class="screen">downloads]$ cd "mss-tomcat-&lt;version&gt;"</pre></li><li><p>(Optional) Ensure that the bin/shutdown.sh start script is executable:</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ chmod +x bin/shutdown.sh</pre></li><li><p>Finally, run the <code class="filename">shutdown.sh</code> executable Bourne shell script</p><pre class="screen">mss-tomcat-&lt;version&gt;]$ ./bin/shutdown.sh</pre></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2719"/><p class="title"><b>Procedure 2.20. Stopping MSS for Tomcat on Windows</b></p><ul><li><p>Stopping the Tomcat Servlet Container on Windows consists in executing the <code class="filename">shutdown.bat</code> executable batch script in the <code class="filename">bin</code> subdirectory of the SIP Servlets-customized Tomcat binary distribution:</p><pre class="screen">C:\Users\Me\My Downloads\mss-tomcat-&lt;version&gt;&gt;bin\shutdown.bat</pre></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server-Using"/>2.2.9. Using</h3></div></div></div><p>After starting the server successfully, you can access the default web applications included with MSS for Tomcat by opening the following URL in your browser: <a class="ulink" href="http://localhost:8080/">http://localhost:8080/</a>.</p><p>You can also access the SIP Servlets Management Console by opening <a class="ulink" href="http://localhost:8080/sip-servlets-management/">http://localhost:8080/sip-servlets-management/</a> in your browser.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Testing"/>2.2.10. Testing</h3></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Uninstalling"/>2.2.11. Uninstalling</h3></div></div></div><p>To uninstall MSS for Tomcat, simply delete the directory you decompressed the binary distribution archive into.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bsssc-binary-SIP_Servlets_Server-Configuring"/>2.3. Configuring</h2></div></div></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors"/>2.3.1. Configuring SIP Connectors</h3></div></div></div><p>SIP Connectors are added in the same way as HTTP Connectors: by adding a <code class="literal">&lt;Connector&gt;</code> element under the <code class="literal">&lt;Service&gt;</code> element in the container's <code class="filename">server.xml</code> configuration file.</p><p>Mobicents SIP Servlets has three SIP Connectors configured by default : UDP And TCP are running on the binding IP Address of the container and port 5080 and TLS is running on the binding IP Address of the container and port 5081</p><p>For example, to add a SIP Connector on the IP address <code class="literal">127.0.0.1</code>, on port <code class="literal">5080</code>, using the UDP transport protocol, you should insert the following XML element:</p><div class="example"><a id="d0e2782"/><p class="title"><b>Example 2.1. Adding a SIP Connector to server.xml</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Connector</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">port</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5080&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_attribute_name">ipAddress</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;127.0.0.1&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">protocol</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipProtocolHandler&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">signalingTransport</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;udp&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">useStun</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">stunServerAddress</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stun01.sipphone.com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">stunServerPort</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3478&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">staticServerAddress</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;122.122.122.122&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">staticServerPort</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;44&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">useStaticAddress</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">httpFollowsSip</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="variablelist"><p class="title"><b>SIP &lt;connector&gt; Attributes</b></p><dl><dt><span class="term">port</span></dt><dd><p>The port number on which the container will be able to receive SIP messages.</p></dd><dt><span class="term">ipAddress</span></dt><dd><p>The IP address at which the container will be able to receive SIP messages.  The container can be configured to listen to all available IP addresses by setting <em class="parameter"><code>ipAddress</code></em> to <strong class="userinput"><code>0.0.0.0 &lt;sipPathName&gt;</code></strong>.</p></dd><dt><span class="term">protocol</span></dt><dd><p>Specifies the connector is a SIP Connector and not an HTTP Connector.  There is no need to change this property.</p></dd><dt><span class="term">signalingTransport</span></dt><dd><p>Specifies the transport on which the container will be able to receive SIP messages.  For example, "udp".</p></dd><dt><span class="term">useStun</span></dt><dd><p>Enables Session Traversal Utilities for NAT (STUN) support for this Connector.  The attribute defaults to "false".  If set to "true", ensure that the <code class="literal">ipAddress</code> attribute is <span class="emphasis"><em>not</em></span> set to <code class="literal">127.0.0.1</code>.  Refer to <a class="xref" href="#mssstun-MSS_STUN" title="7.4. STUN Support">Section 7.4, “STUN Support”</a> for more information about STUN.</p></dd><dt><span class="term">stunServerAddress</span></dt><dd><p>Specifies the STUN server address used to discover the public IP address of the SIP Connector.  This attribute is only required if the <code class="literal">useStun</code> attribute is set to "true". Refer to <a class="xref" href="#mssstun-MSS_STUN" title="7.4. STUN Support">Section 7.4, “STUN Support”</a> for more information about STUN and public STUN servers.</p></dd><dt><span class="term">stunServerPort</span></dt><dd><p>Specifies the STUN server port of the STUN server used in the <code class="literal">stunServerAddress</code> attribute. You should rarely need to change this attribute; also, it is only needed if the <code class="literal">useStun</code> attribute is set to "true". Refer to <a class="xref" href="#mssstun-MSS_STUN" title="7.4. STUN Support">Section 7.4, “STUN Support”</a> for more information about STUN.</p></dd><dt><span class="term">addressResolverClass</span></dt><dd><p>Specifies the <code class="literal">gov.nist.core.net.AddressResolver</code> implementation class that will be used by the container to perform DNS lookups. The default class used by the container is <code class="literal">org.mobicents.servlet.sip.core.DNSAddressResolver</code> but any class implementing <code class="literal">gov.nist.core.net.AddressResolver</code> NIST SIP Stack interface and having a Constructor with a <code class="literal">org.mobicents.servlet.sip.core.SipApplicationDispatcher</code> param can be used. To disable DNS lookups, this attribute should be left empty..</p></dd><dt><span class="term">useStaticAddress</span></dt><dd><p>Specifies  whether the settings in staticServerAddress and staticServerPort are activated.  The default value is "false" (deactivated).</p></dd><dt><span class="term">staticServerAddress</span></dt><dd><p>Specifies what load-balancer server address is inserted in Contact/Via headers for server-created requests. This parameter  is useful for  cluster configurations where  requests should  be bound to a load-balancer address, rather than  a specific node address.</p></dd><dt><span class="term">staticServerPort</span></dt><dd><p>Specifies the port of the load-balancer specified in staticServerAddress . This parameter is useful in cluster configurations where requests should be bound to a load-balancer address rather than a specific node address.</p></dd><dt><span class="term">httpFollowsSip</span></dt><dd><p>This flag makes the application server aware of how the SIP load balancers assign request affinity and stores this information in the application session. When HTTP load balancer sends HTTP request not associated with this application session the application server will force this HTTP request to be repeated to land on the correct node.</p></dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>A comprehensive list of implementing classes for the SIP Stack is available from the <a class="ulink" href="http://hudson.jboss.org/hudson/job/jain-sip/lastSuccessfulBuild/artifact/javadoc/javax/sip/SipStack.html">Class SipStackImpl page on nist.gov</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bsssc-binary-SIP_Servlets_Server-Configuring_Application_Routing"/>2.3.2. Application Routing and Service Configuration</h3></div></div></div><p>The application router is called by the container—whether JBoss or Tomcat—to select a SIP Servlet application to service an initial request. It embodies the logic used to choose which applications to invoke. An application router is required for a container to function, but it is a separate logical entity from the container. The application router is solely responsible for application selection and must not implement application logic. For example, the application router cannot modify a request or send a response.</p><p>For more information about the application router, refer to the following sections of the JSR 289 specification: Application Router Packaging and Deployment, Application Selection Process, and Appendix C.
   </p><p>In order to configure the application router, you should edit the <code class="literal">Service</code> element in the container's <code class="filename">server.xml</code> configuration file:</p><div class="example"><a id="bsssc-Configuring_the_Service_Element_in_the_Containers_server.xml"/><p class="title"><b>Example 2.2. Configuring the Service Element in the Container's server.xml</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Sip-Servlets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">usePrettyEncoding</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">additionalParameterableHeaders</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Header1,Header2&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">bypassResponseExecutor</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">bypassRequestExecutor</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">baseTimerInterval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">t2Interval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">t4Interval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timerDInterval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;32000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">dispatcherThreadPoolSize</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;file:///home/silas/workspaces/mobicents-sip-servlets/</span><br />
<span class="xml_attribute_value">&nbsp;sip-servlets-examples/reinvite-demo/reinvite-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">dialogPendingRequestChecking</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>Provided here is a description of the SIP Service element's attributes:</p><div class="variablelist"><dl><dt><span class="term">className</span></dt><dd><p>This attribute specifies that the servlet container is a <span class="emphasis"><em>converged</em></span> (i.e. SIP + HTTP) servlet container.</p></dd><dt><span class="term">sipApplicationDispatcherClassName</span></dt><dd><p>This attribute specifies the class name of the <code class="literal">org.mobicents.servlet.sip.core.SipApplicationDispatcher</code> implementation to use. The routing algorithm and application selection process is performed in that class.</p></dd><dt><span class="term">darConfigurationFileLocation</span></dt><dd><p>The default application router file location. This is used by the default application router to determine the application selection logic. Refer to Appendix C of the JSR 289 specification for more details.</p></dd><dt><span class="term">sipStackPropertiesFile</span></dt><dd><p>Specifies the location of the file containing key-value pairs corresponding to the SIP stack configuration properties.  This attribute is used to further tune the JAIN SIP Stack.  If this property is omitted, the following default values are assumed:</p><div class="itemizedlist"><ul><li><p>gov.nist.javax.sip.LOG_MESSAGE_CONTENT=true</p></li><li><p>gov.nist.javax.sip.TRACE_LEVEL=32</p></li><li><p>gov.nist.javax.sip.DEBUG_LOG=logs/mss-jsip-debuglog.txt</p></li><li><p>gov.nist.javax.sip.SERVER_LOG=logs/mss-jsip-messages.xml</p></li><li><p>javax.sip.STACK_NAME=Mobicents-SIP-Servlets</p></li><li><p>javax.sip.AUTOMATIC_DIALOG_SUPPORT=off</p></li><li><p>gov.nist.javax.sip.DELIVER_UNSOLICITED_NOTIFY=true</p></li><li><p>gov.nist.javax.sip.THREAD_POOL_SIZE=64</p></li><li><p>gov.nist.javax.sip.REENTRANT_LISTENER=true</p></li><li><p>gov.nist.javax.sip.MAX_FORK_TIME_SECONDS=0. Dialog forking is not enabled by default as it has an impact on memory. If set to a value greater than 0, Dialog Forking will be enabled on Mobicents Sip Servlets.</p></li><li><p>gov.nist.javax.sip.AUTOMATIC_DIALOG_ERROR_HANDLING=false. Merged requests Loop Detection is turned off by default</p></li></ul></div><p>Mobicents SIP Servlets also adds its own properties to allow for even more configuration and flexibility :</p><div class="itemizedlist"><ul><li><p>If the property <code class="literal">org.mobicents.servlet.sip.SERVER_HEADER</code> is set, A Server header will be added to all SIP Responses leaving the container.</p></li><li><p>If the property <code class="literal">org.mobicents.servlet.sip.USER_AGENT_HEADER</code> is set, A Server header will be added to all SIP Requests leaving the container.</p></li></ul></div></dd><dt><span class="term">usePrettyEncoding</span></dt><dd><p>Allows Via, Route, and RecordRoute header field information to be split into multiple lines, rather than each header field being separating with a comma.  The attribute defaults to "true".  Leaving this attribute at the default setting may assist in debugging non-RFC3261 compliant SIP servers.</p></dd><dt><span class="term">additionalParameterableHeaders</span></dt><dd><p>Comma-separated list of header names that are treated as Parameterable by the container.  The specified headers are classed as valid, in addition to the standard Parameterable headers defined in the Sip Servlets 1.1 Specification. </p><p>Setting and getting parameters is allowed for the standard, and additional parameters.  Parameters that are not specified in <code class="literal">additionalParameterableHeaders</code> will result in a ServletParseException error.</p></dd><dt><span class="term">bypassRequestExecutor/bypassResponseExecutor</span></dt><dd><p>If set to false, the SIP Servlets server uses a ThreadPoolExecutor linked to a LinkedBlockingQueue to dispatch the request/response threads. The container can thus handles two different responses (for example a 180 Ringing and a 200 OK) concurrently, but a race condition can occur where the second response overtakes the first one (200 OK dispatched to the application before the 180 Ringing) on UDP.</p><p>So those flags are true by default thus using jain sip serializing per transaction to ensure such race conditions don't occur in Mobicents Sip Servlets even though they can still happen on UDP at jain sip level. </p></dd><dt><span class="term">baseTimerInterval</span></dt><dd><p>Specifies the <code class="literal">T1</code> Base Timer Interval, which allows the SIP Servlets Container to adjust its timers depending on network conditions.  The default interval is 500 (milliseconds).</p><p>For more information about  available timers, refer to  <a class="ulink" href="http://tools.ietf.org/html/rfc3261#appendix-A">RFC326 "Table of Timer Values"1</a>, and the document contained in the <a class="ulink" href="http://www.3gpp.org/ftp/Specs/html-info/24229.htm">3GPP-IMS TS 24.229 v9.1.0 specification ZIP archive</a>.</p><p>All of the timers present in the tables depend on <code class="literal">T1</code>, <code class="literal">T2</code>, <code class="literal">T4</code>, and <code class="literal">Timer D</code> </p></dd><dt><span class="term">t2Interval</span></dt><dd><p>Specifies the <code class="literal">T2</code> Interval, which allows the SIP Servlets Container to adjust its timers depending on network conditions.  The default interval is 4000 (milliseconds).</p><p>For more information about available timers, refer to  <a class="ulink" href="http://tools.ietf.org/html/rfc3261#appendix-A">RFC326 "Table of Timer Values"1</a>, and the document contained in the <a class="ulink" href="http://www.3gpp.org/ftp/Specs/html-info/24229.htm">3GPP-IMS TS 24.229 v9.1.0 specification ZIP archive</a>.</p><p>All of the timers present in the tables depend on <code class="literal">T1</code>, <code class="literal">T2</code>, <code class="literal">T4</code>, and <code class="literal">Timer D</code> </p></dd><dt><span class="term">t4Interval</span></dt><dd><p>Specifies the <code class="literal">T4</code> Interval, which allows the SIP Servlets Container to adjust its timers depending on network conditions.  The default interval is 5000 (milliseconds).</p><p>For more information about available timers, refer to  <a class="ulink" href="http://tools.ietf.org/html/rfc3261#appendix-A">RFC326 "Table of Timer Values"1</a>, and the document contained in the <a class="ulink" href="http://www.3gpp.org/ftp/Specs/html-info/24229.htm">3GPP-IMS TS 24.229 v9.1.0 specification ZIP archive</a>.</p><p>All of the timers present in the tables depend on <code class="literal">T1</code>, <code class="literal">T2</code>, <code class="literal">T4</code>, and <code class="literal">Timer D</code> </p></dd><dt><span class="term">timerDInterval</span></dt><dd><p>Specifies the <code class="literal">Timer D</code> Interval, which allows the SIP Servlets Container to adjust its timers depending on network conditions.  The default interval is 32000 (milliseconds).</p><p>For more information about available timers, refer to  <a class="ulink" href="http://tools.ietf.org/html/rfc3261#appendix-A">RFC326 "Table of Timer Values"1</a>, and the document contained in the <a class="ulink" href="http://www.3gpp.org/ftp/Specs/html-info/24229.htm">3GPP-IMS TS 24.229 v9.1.0 specification ZIP archive</a>.</p><p>All of the timers present in the tables depend on <code class="literal">T1</code>, <code class="literal">T2</code>, <code class="literal">T4</code>, and <code class="literal">Timer D</code> </p></dd><dt><span class="term">dispatcherThreadPoolSize</span></dt><dd><p>The number of threads used for processing  SIP messages inside the Sip Servlets container by the dispatcher. The default value is 4.</p></dd><dt><span class="term">dialogPendingRequestChecking</span></dt><dd><p>This property enables and disables error checking when SIP transactions overlap. If within a single dialog an INVITE request arrives while there is antoher transaction proceeding, the container will send a 491 error response. The default value is false.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bsssc-binary-SIP_Servlets_Server-Configuring_Logging"/>2.3.3. SIP Servlets Server Logging</h3></div></div></div><p>There are two separate levels of logging:</p><div class="itemizedlist"><ul><li><p>Logging at the container level, which can be configured using the <code class="filename">log4j.xml</code> configuration file, which is usually located in the container's <code class="filename">lib</code> directory.</p></li><li><p>Logging of the NIST SIP stack, which is configured in the <code class="literal">Connector</code> element of the container's <code class="filename">server.xml</code> configuration file.</p></li></ul></div><p>You can setup the logging so that the NIST SIP Stack will log into the container logs</p><p>To use LOG4J in NIST SIP Stack use the following, You need to define a category in <code class="filename">JBOSS_HOME/server/default/conf/jboss-log4j.xml</code> and set it to <code class="literal">off</code></p><div class="example"><a id="bsssc-Configuring_the_Stack_Logs_in_the_Container_log4j.xml"/><p class="title"><b>Example 2.3. Configuring the NIST SIP Stack to log into the Container's logs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;gov.nist&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;OFF&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>So that this category is used in MSS you need to specify it in <code class="filename">JBOSS_HOME/server/default/conf/mss-sip-stack.properties</code> as well by adding this property <code class="literal">gov.nist.javax.sip.LOG4J_LOGGER_NAME=gov.nist</code> and setting this property <code class="literal">gov.nist.javax.sip.TRACE_LEVEL=LOG4J</code></p></div></div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="footnotes"><br/><hr/><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e723" href="#d0e723" class="para">1</a>] </sup>
			At this point in time, it is possible to run most <span class="application"><strong>Mobicents</strong></span> servers, such as the JAIN SLEE Server, using a Java 6 JRE or JDK. Be aware, however, that presently the XML Document Management Server does not run on Java 6. We suggest checking the Mobicents web site, forums or discussion pages if you need to inquire about the status of running the XML Document Management Server with Java 6.
		</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e1499" href="#d0e1499" class="para">2</a>] </sup>
					Note that any other terminals which were opened prior to your having altered <code class="filename">.bashrc</code> will need to <code class="command">source</code>
						<code class="filename">~/.bashrc</code> as well should they require access to <code class="envar">JBOSS_HOME</code>.
				</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e1903" href="#d0e1903" class="para">3</a>] </sup>
			At this point in time, it is possible to run most <span class="application"><strong>Mobicents</strong></span> servers, such as the JAIN SLEE Server, using a Java 6 JRE or JDK. Be aware, however, that presently the XML Document Management Server does not run on Java 6. We suggest checking the Mobicents web site, forums or discussion pages if you need to inquire about the status of running the XML Document Management Server with Java 6.
		</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sssicar-SIP_Servlets_Server-Application-Router"/>Chapter 3. Application Router</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#tsdar-Default-Application-Router">3.1. Default Application Router</a></span></dt><dd><dl><dt><span class="section"><a href="#tsdar-Application-Router-Role">3.1.1. Role of the Application Router</a></span></dt><dt><span class="section"><a href="#tsdar-Mobicents-Default-Application-Router">3.1.2. Mobicents Default Application Router</a></span></dt><dt><span class="section"><a href="#tsdar-Limitations">3.1.3. Limitations of the Default Application Router</a></span></dt></dl></dd><dt><span class="section"><a href="#tsear-echarts-Application-Router">3.2. DFC Application Router</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3602">3.2.1. Description of DFC Application Router</a></span></dt><dt><span class="section"><a href="#d0e3609">3.2.2. Installing the DFC Application Router</a></span></dt></dl></dd></dl></div><p>Application Routing is
  performed within the Mobicents Sip Servlets container by the Default
  Application Router.  The following sections describe the Default Application Router, and how other Application Router implementations
  compliant with the JSR 289 specification can be installed.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="tsdar-Default-Application-Router"/>3.1. Default Application Router</h2></div></div></div><p>The Application Router is called by the container to select a SIP
  Servlet application to service an initial request. It embodies the logic
  used to choose which applications to invoke.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="tsdar-Application-Router-Role"/>3.1.1. Role of the Application Router</h3></div></div></div><p>An Application Router is required for a container to function, but
    it is a separate logical entity from the container. The Application Router
    is solely responsible for application selection and does not implement
    application logic. For example, the Application Router cannot modify a
    request or send a response.</p><p>There is no direct interaction between the Application Router and
    applications, only between the SIP Servlets Container and the Application
    Router.</p><p>The
    SIP Servlets container is responsible for passing the required information  to the Application Router within the initial request so  the Application Router can make informed routing decisions. Except for  the information passed by the
    container, the Application Router is free to make use of any other
    information or data stores. It is up to the individual implementation how the Application Router makes use of the information or data stores.</p><p>The
    deployer in a SIP Servlet environment controls application composition by
    defining and deploying the Application Router implementation.  Giving the
    deployer control over application composition is desirable because the deployer is solely  responsible for the services available to subscribers. </p><p>Furthermore, the SIP Servlets
    specification intentionally allows the Application Router implementation
    to consult arbitrary information or data stores. This is because the
    deployer maintains subscriber information and this information is often
    private and valuable.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="tsdar-Mobicents-Default-Application-Router"/>3.1.2. Mobicents Default Application Router</h3></div></div></div><p>Mobicents SIP Servlets provides an implementation of the Default
    Application Router (DAR) as defined in the  SIP Servlets 1.1 specification,
    Appendix C.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="tsdar-DAR-Configuration-File"/>3.1.2.1. The DAR Configuration File</h4></div></div></div><p>The Default Application Router (DAR) obtains its operational parameters from  a 
      configuration text file that  is modeled as a Java properties file. The configuration file 
      contains the information needed by the Application Router to select
      which SIP Servlet application will handle an incoming initial request.
       </p><p>In the case of Mobicents
          SIP Servlets, it is also possible to configure the DAR  through the
          <code class="filename">server.xml</code> configuration file (see  <a class="xref" href="#bsssc-Configuring_the_Service_Element_in_the_Containers_server.xml" title="Example 2.2. Configuring the Service Element in the Container's server.xml">Example 2.2, “Configuring the Service Element in the Container's server.xml”</a> and  <a class="xref" href="#wwtssmc-Working_with_the_SIP_Servlets_Management_Console" title="1.2. Working with the SIP Servlets Management Console">Section 1.2, “Working with the SIP Servlets Management Console”</a>).</p><p>The properties file has the following characteristics and requirements:</p><div class="itemizedlist"><ul><li><p>It must  be made available to the DAR.  </p></li><li><p>It must allow the contents and file structure to be accessible from a hierarchical
          URI  supplied as a system property
          <code class="filename">javax.servlet.sip.ar.dar.configuration</code>.</p></li><li><p>It is first read by the container when it
          loads up and is refreshed each time an application is
          deployed and undeployed.</p></li><li><p>It has a simple format in which the name of
          the property is the SIP method and the value is a  comma-separated string value for the <code class="literal">SipApplicationRouterInfo</code>
          object.</p><pre class="screen">INVITE: (sip-router-info-1), (sip-router-info-2)..
SUBSCRIBE: (sip-router-info-3), (sip-router-info-4)..
ALL: (sip-router-info-5), (sip-router-info-6)..</pre><p>Mobicents SIP Servlets defines a new keyword called <code class="literal">ALL</code>.  The keyword 
        allows mapping between the sip-router-info data, and all methods
        supported by the container (for example, INVITE, REGISTER, SUBSCRIBE).  This maping  can 
        save time when configuring an application that listens to all
        incoming methods. </p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If   <code class="literal">ALL</code>, and a specific method are defined in
        the DAR file, the specific method takes precedence over  <code class="literal">ALL</code>.  When the specific method no longer has applications to serve, <code class="literal">ALL</code> is enabled again. </p></div><p>The sip-router-info data specified in the properties file is a
      string value version of the <code class="literal">SipApplicationRouterInfo</code> object. It consists
      of the following information:</p><div class="itemizedlist"><ul><li><p>The name of the application as known to the container.  The application name can be obtained from the  <span class="markup">&lt;app-name&gt;</span> element of the <code class="filename">sip.xml</code> deployment
          descriptor of the application,  or the <code class="literal">@SipApplication</code>
          annotation.</p></li><li><p>The identity of the subscriber that the DAR returns. The DAR can 
          return any header in the SIP request using the DAR directive
          <code class="literal">DAR:SIP_HEADER</code>.  For example,  <code class="literal">DAR:From</code> would return the SIP URI in the <code class="literal">From</code>
          header. The DAR can  alternatively  return any string from the SIP request.</p></li><li><p>The routing region, which consists of one of the following strings:  <code class="literal">ORIGINATING</code>,
          <code class="literal">TERMINATING</code> or <code class="literal">NEUTRAL</code>.  This information is not currently used
          by the DAR to make routing decisions.</p></li><li><p>A SIP URI indicating the route as returned by the Application
          Router, which can be used to route the request externally.  The value may be an empty string.</p></li><li><p>A route modifier, which consists of one of the following strings: <code class="literal">ROUTE</code>,
          <code class="literal">ROUTE_BACK</code> or <code class="literal">NO_ROUTE</code>.  The route modifier is used in conjunction with the 
          route information to route a request externally.</p></li><li><p>A string representing the order in which  applications must be
          invoked (starts at 0).  The string is removed later on in the routing process,  and substituted with the order positions of sip-router-info data.</p></li><li><p>
				An optional string that contains Mobicents-specific parameters. Currently, only the <code class="literal">DIRECTION</code> and <code class="literal">REGEX</code> parameters are supported.
			</p>.
			<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					The field can contain unsupported <code class="literal">key=value</code> properties that may be supported in future releases. The unsupported properties will be ignored during parsing, until support for the attributes is provided.
				</p></div><p>
				The syntax is demonstrated in <a class="xref" href="#example-DAR_Direction_Example" title="Example 3.1. DIRECTION Example">Example 3.1, “DIRECTION Example”</a>.
			</p><div class="itemizedlist"><ul><li><p>
						The <code class="literal">DIRECTION</code> parameter specifies whether an application serves external(INBOUND) requests or initiates (OUTBOUND) requests.
					</p><p>
						If an application is marked <code class="literal">DIRECTION=INBOUND</code>, it will not be called for requests initiated by applications behaving as UAC. To mark an application as UAC, specify <code class="literal">DIRECTION=INBOUND</code> in the optinal parameters in the DAR.
					</p><p>
						Applications that do not exist in the DAR list for the container are assumed to be <code class="literal">OUTBOUND</code>. Because undefined applications are incapable of serving external requests, they must have self-initiated the request. The Sip Servlets Management Console can be used to specify the <code class="literal">DIRECTION</code> parameter.
					</p></li><li><p>
						The <code class="literal">REGEX</code> parameter specifies a regular expression to be matched against the initial request passed to the Application Router.
					</p><p>
          				If the regular expression matches a part of the initial request, the application is called otherwise it is skipped.
          			</p><p>
          				By example in the following sip-router-info data : </p><pre class="screen">INVITE: ("org.mobicents.servlet.sip.testsuite.SimpleApplication", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0", "REGEX=From:.*sip:.*@sip-servlets\.com")</pre><p>, only incoming initial requests having a From Header whose the SIP URI belongs to the sip-servlets.com domain will be passed to the SimpleApplication.
           			</p></li></ul></div></li></ul></div><div class="example"><a id="example-DAR_Direction_Example"/><p class="title"><b>Example 3.1. DIRECTION Example</b></p><div class="example-contents"><p>In this example, two applications are declared for the
   <code class="literal">INVITE</code>
   request. The
   <code class="literal">LocationServiceApplication</code> is called for requests coming from outside the container, but it
   will not be
   called for the requests initiated by the UAC application
   <code class="literal">Click2DialApplication</code>.    </p><pre class="screen">
INVITE: ("org.mobicents.servlet.sip.testsuite.Click2DialApplication", "DAR:From",
"ORIGINATING", "", "NO_ROUTE", "0", "DIRECTION=OUTBOUND"), \
("org.mobicents.servlet.sip.testsuite.LocationServiceApplication", "DAR\:From",
"ORIGINATING", "", "NO_ROUTE", "0", "DIRECTION=INBOUND")</pre><p>This type of configuration is useful in cases where different application must be responsible for both requests initited by the container,  and external requests received by the container.
  </p></div></div><br class="example-break"/><div class="example"><a id="d0e3440"/><p class="title"><b>Example 3.2. ORIGINATING/TERMINATING DAR Example</b></p><div class="example-contents"><p>In this example, the DAR is configured to invoke two applications on
      receipt of an INVITE request; one each in the originating and the terminating halves.  The applications are identified by their application deployment descriptor names.</p><pre class="screen">INVITE: ("OriginatingCallWaiting", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0"), ("CallForwarding", "DAR:To", "TERMINATING", "","NO_ROUTE", "1") </pre><p>For this example, the returned subscriber identity  is the URI from each application's 
      <code class="literal">From</code> and <code class="literal">To</code> headers respectively.  The DAR does
      not return any route to the container, and maintains the invocation state
      in the <code class="literal">stateInfo</code> as the index of the last application in the
      list.</p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3458"/>3.1.2.2. Routing of SIP Messages to Applications</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3461"/>3.1.2.2.1. Initial Requests and Application Selection Process</h5></div></div></div><p>Initial Requests are those that can essentially be dialog
        creating (such as, <code class="literal">INVITE</code>, <code class="literal">SUBSCRIBE</code> and  <code class="literal">NOTIFY</code>),  and not part of an already existing dialog.</p><p>Initial requests are routed to applications deployed in
        the container according to the SIP Servlets 1.1 specification, Section
        15.4.1 Procedure for Routing an Initial Request.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There are
        some other corner cases that apply to initial requests. Refer to  Appendix B Definition of an Initial Request in the SIP Servlets 1.1
        specification. </p></div><div class="example"><a id="d0e3482"/><p class="title"><b>Example 3.3. INVITE Routing</b></p><div class="example-contents"><p>The following example describes how the DAR routes an INVITE to two applications  deployed in a container.  The applications in this example are a
        Location Service and a Call Blocking application.</p><p>In the example, the assumption of a request coming to the server is described. However, applications can act as a UAC, and  generate initial requests
          on their own.   For routing purposes, it is not necessary for 
          the specified application initiating the request to have an  entry in the DAR file.</p><p>The DAR file  contains the required information for the  two
        applications to be invoked in the correct order.</p><pre class="screen">INVITE: ("LocationService", "DAR:From", "ORIGINATING", "", "NO_ROUTE", "0"), ("CallBlocking", "DAR:To", "TERMINATING", "","NO_ROUTE", "1") </pre><p>Processing occurs in the following order:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>A new <code class="literal">INVITE</code> (not a re-INVITE) arrives at the container.  </p><p>The <code class="literal">INVITE</code>  is a  dialog creating request, and is  not part of any
        dialog.</p></li><li><p>The Application Router is called. </p><p>From the <code class="literal">INVITE</code> information, the first
        application to invoke is the Location Service. </p></li><li><p>The Application Router returns  the application invocation order 
        information to the container (along with the rest of the
        sip-router-info data) so  the container knows which application to
        invoke.</p></li><li><p>The container   invokes the LocationService that proxies the
        <code class="literal">INVITE</code>. </p><p>The proxied <code class="literal">INVITE</code> is considered  as a new <code class="literal">INVITE</code> to the known IP Address of the registered user for the Request
        URI</p><p>For further information regarding <code class="literal">INVITE</code> handling, refer to  "Section 15.2.2 Sending an Initial Request" in the  SIP
        Servlets 1.1 Specification.</p></li><li><p>Because the <code class="literal">INVITE</code> has been proxied, the container  invokes the
        Application Router for the proxied <code class="literal">INVITE</code> to see if any more
        applications are interested in the event. </p></li><li><p>From the proxied invite, the Application Router determines that the second application to invoke is the Call Blocking application.
        </p></li><li><p>The Application Router returns  information regarding the Call Blocking application to the container (along with the
        rest of the sip-router-info data) so  the container knows which
        application to invoke.</p></li><li><p>The container routes the <code class="literal">INVITE</code> for the Call Blocking application to the next application in the chain.</p></li><li><p>The Call Blocking application determines  that the user that initiated the call  is black listed. The application rejects the
        call with a "Forbidden" response. </p></li><li><p>Because the Call Blocking application acts as a UAS,
        the Application Selection Process is stopped for the original <code class="literal">INVITE</code>.</p></li></ol></div><p>The path  the <code class="literal">INVITE</code> has taken (that is, LocationService to 
        CallBlocking) is called the application path.  The Routing of the
        responses will now occur as explained in the next section.</p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3573"/>3.1.2.2.2. Response Routing</h5></div></div></div><p>Responses always follow the reverse of the path taken by the
        corresponding request. In our case the Forbidden response will first
        go back to LocationService then back to the caller. This is true for
        responses to both initial and subsequent requests. The application
        path is a logical concept and as such may or may not be explicitly
        represented within containers.</p><p>Another possible outcome could have been that the Call Blocking
        application instead of sending a Forbidden response, allowed the call
        and proxied the INVITE to the same Request URI chosen by the Location
        Service. Then when the callee sends back the 200 OK Response, this
        response goes back the same way through the application path (so in
        the present case Call Blocking, then Location Service, then back to
        the caller).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>An important note here with regard to that second scenario
          that according to the SIP Servlets 1.1 specification, Sections
          15.1.2 The Role of Applications and 15.1.4 Application Independence,
          the Call Blocking application cannot just do nothing with the
          request and expect the container to route the request in its place
          (either to a next application in chain if another one is present or
          to the outside world if none is present). The Application has to do
          something with request (either proxy it or act as a UAS).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3583"/>3.1.2.2.3. Subsequent Requests</h5></div></div></div><p>Subsequent requests are all requests that are not
        Initial.</p><p>The second scenario where the Call Blocking application allowed
        the call will be used in this section to showcase subsequent requests.
        So the caller has received the 200 OK response back. Now according to
        the SIP specification (RFC 3261), it sends an ACK. The ACK arrives at
        the container and is not a dialog creating request and is already part
        of an ongoing dialog (early dialog) so the request is detected as a
        Subsequent request and will follow the application path created by the
        initial request. The ACK will go through Location Service, Call
        Blocking, and finally to the callee.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="tsdar-Limitations"/>3.1.3. Limitations of the Default Application Router</h3></div></div></div><p>The DAR  is a minimalist Application Router implementation that is part of the reference implementation.  While it could be used instead of a production Application Router, it offers no
    processing logic except for  the declaration of the application order. </p><p>In real world deployments, the Application Router plays
    an extremely important role in application orchestration and composition.
    It is likely that the Application Router would  make use of complex rules and diverse data
    repositories in future implementations.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="tsear-echarts-Application-Router"/>3.2. DFC Application Router</h2></div></div></div><p> </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3602"/>3.2.1. Description of DFC Application Router</h3></div></div></div><p>Instead of using the Mobicents Default Application Router, any SIP
    Servlets 1.1 compliant Application Router can be used,  such as the eCharts <a class="ulink" href="http://echarts.org/EChartsSipServletManual/sip-echartsse4.html#x6-140004.1">DFC Application Router</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3609"/>3.2.2. Installing the DFC Application Router</h3></div></div></div><p>Detailed instructions are available from <a class="ulink" href="http://echarts.org/Blog/Running-E4SS-apps-on-Mobicents-SIP-Servlets.html">the eCharts website</a> or the following procedures describe how to install the eCharts DFC Application Router (DFCAR) on a variety of SIP Servlet Server platforms.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e3618"/><p class="title"><b>Procedure 3.1. Installing DFCAR on Tomcat</b></p><ol class="1"><li><p class="title"><b>Deploy the DFCAR</b></p><p>Drop the <code class="filename">dfcar.jar</code> from the ECharts distribution package in
      <code class="literal">TOMCAT_HOME/lib</code> directory </p></li><li><p class="title"><b>Remove the DAR</b></p><p>Remove the Mobicents
      Default Application Router located in
      <code class="literal">TOMCAT_HOME/lib/sip-servlets-application-router-*.jar</code></p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e3639"/><p class="title"><b>Procedure 3.2. Installing DFCAR on JBoss 5.1.x</b></p><ol class="1"><li><p class="title"><b>Deploy the DFCAR</b></p><p>Drop the <code class="filename">dfcar.jar</code> from the ECharts distribution package in
      <code class="literal">JBOSS_HOME/server/default/deploy/jbossweb.sar/ </code>directory.</p></li><li><p class="title"><b>Remove the DAR</b></p><p>Remove the Mobicents Default Application Router
      located in
      <code class="literal">JBOSS_HOME/server/default/deploy/jbossweb.sar/sip-servlets-application-router-*.jar</code></p></li></ol></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ssea-SIP_Servlet_Example_Applications"/>Chapter 4. SIP Servlet Example Applications</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sfss-Services_for_SIP_Servlets">4.1. Operating the Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#sfss-The_Location_Service">4.1.1. The Location Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Diameter_Event-Changing_Service">4.1.2. The Diameter Event-Changing Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Blocking_Service">4.1.3. The Call-Blocking Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Forwarding_Service">4.1.4. The Call-Forwarding Service</a></span></dt><dt><span class="section"><a href="#sfss-The_Call-Controller_Service">4.1.5. The Call-Controller Service</a></span></dt><dt><span class="section"><a href="#mipbx-Media_IPBX">4.1.6. Media IPBX</a></span></dt></dl></dd></dl></div><p>The SIP Servlet server has a selection of examples which demonstrate particular capabilities of the server.  <a class="xref" href="#tab-ssea-SIP_Servlet_Example_Applications" title="Table 4.1. Available Examples">Table 4.1, “Available Examples”</a> lists the available examples, their location, and a brief description about the functionality each example demonstrates.  The examples can also provide a useful starting point for developing SIP Applications, therefore it is encouraged to experiment and adapt the base examples.  Each example is available in both binary and source formats.</p><div class="table"><a id="tab-ssea-SIP_Servlet_Example_Applications"/><p class="title"><b>Table 4.1. Available Examples</b></p><div class="table-contents"><table summary="Available Examples" border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr><th align="center">Example</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">
            <a class="xref" href="#sfss-The_Call-Blocking_Service" title="4.1.3. The Call-Blocking Service">Section 4.1.3, “The Call-Blocking Service”</a>
          </td><td align="left">Demonstrates how to block calls by specifying that the INVITE SIP Extension checks the <code class="literal">From</code> address to see if it is specified in the block list. If the blocked SIP address matches, the Call Blocking application send a FORBIDDEN response.</td></tr><tr><td align="left">
            <a class="xref" href="#sfss-The_Call-Forwarding_Service" title="4.1.4. The Call-Forwarding Service">Section 4.1.4, “The Call-Forwarding Service”</a>
          </td><td align="left">Demonstrates how to forward calls by specifying that the INVITE SIP Extension checks the <code class="literal">To</code> address to see if it is specified in the forward list. If the SIP address matches, the application acts as a back-to-back user agent (B2BUA).</td></tr><tr><td align="left">
            <a class="xref" href="#sfss-The_Call-Controller_Service" title="4.1.5. The Call-Controller Service">Section 4.1.5, “The Call-Controller Service”</a>
          </td><td align="left">Call Blocking and Call Forwarding are merged to create a new service.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/speed_dial.html">Speed Dial</a>
          </td><td align="left">Demonstrates how to implement speed dialing for SIP addresses. The demonstration uses a static list of speed dial numbers. The numbers are translated into a complete address based on prior configuration. The SIP addresses are proxied without record-routing, or supervised mode.</td></tr><tr><td align="left">
            <a class="xref" href="#sfss-The_Location_Service" title="4.1.1. The Location Service">Section 4.1.1, “The Location Service”</a>
          </td><td align="left">Demonstrates a location service that performs a lookup based on the request URI, into a hard-coded list of addresses. The request is proxied to the set of destination addresses associated with that URI.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/speeddial_locationservice.html">Composed Speed Dial and Location</a>
          </td><td align="left">Speed Dial and Location are merged to create a new service. Speed Dial proxies the speed dial number to a SIP address, then Location Service proxies the call to the actual location of the call recipient.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/click2call.html">Click to Call</a>
          </td><td align="left">Demonstrates how SIP Servlets can be used along with HTTP servlets as a converged application to place calls from a web portal. The example is a modified version of the click to dial example from the Sailfin project, but has been reworked to comply with JSR 289.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/chatserver.html">Chat Server</a>
          </td><td align="left">Demonstrates <code class="literal">MESSAGE</code> SIP Extension support. This example is based on the chatroom server demonstration from the BEA dev2dev project, and has been modified to meet JSR 289 requirements.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-jsr309-demo.html">Media JSR 309 Example</a>
          </td><td align="left">Demonstrates how the Sip Servlets Application Developers can leverage JSR-309 API which provides to application developers,  multimedia capabilities with a generic media server (MS) abstraction interface This example is only compatible with JBoss AS 5. The solution is know to work with Twinkle and linphone SIP soft-phones.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/shopping-demo-jsr309.html">Shopping</a>
          </td><td align="left">Demonstrates integration with Seam and Java Enterprise Edition (JEE), and JSR 309 Media integration with text to speech (TTS) and dual-tone multi-frequency (DTMF) tones. The demonstration builds on the Converged Demo example, and adds support for the SIP Servlets v1.1 specification.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/jslee-sips-interop-demo.html">JSLEE/SIP Servlets Interoperability</a>
          </td><td align="left">Demonstrates how the Mobicents platform components can work in concert with each other to provide a integrated solution. All major components of the platform are used in this example, which was created to demonstrate to JavaOne 2008 delegates a possible use case scenario for the platform.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/facebook-c2c.html">Facebook Click to Call</a>
          </td><td align="left">Demonstrates how SIP Servlets and HTTP Servlets can be used can be used to create a Facebook plug-in that allows user to call POTS phones through a SIP-PSTN gateway provider. This demonstration is only available from the source repository; no binary is available.</td></tr><tr><td align="left">
            <a class="xref" href="#sfss-The_Diameter_Event-Changing_Service" title="4.1.2. The Diameter Event-Changing Service">Section 4.1.2, “The Diameter Event-Changing Service”</a>
          </td><td align="left">Demonstrates how the Diameter Event Charging, and the Location service, can be used to perform fixed-rated charging of calls (event charging). When a call is initiated, a debit of ten euros is applied to the <code class="literal">A Party</code> account. If the call is rejected by the <code class="literal">B Party</code>, or <code class="literal">A Party</code> hangs up before <code class="literal">B Party</code> can answer the call, the ten euro charge is credited to the <code class="literal">A Party</code> account.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-diameter_sh.html">Diameter Sh OpenIMS Integration</a>
          </td><td align="left">Demonstrates the integration between Mobicents and OpenIMS, using the Diameter Sh interface to receive profile updates and SIP.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-diameter_rorf.html">Diameter Ro/Rf IIntegration</a>
          </td><td align="left">a Diameter Ro/Rf service that performs online call charging</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/conference-demo-jsr309.html">Conference</a>
          </td><td align="left">Demonstrates the capabilities of the Media Server, such as endpoint composition and conferencing, as well as proving that SIP Servlets are capable of working seamlessly with any third-party web framework, without repackaging or modifying the deployment descriptors. The demonstration uses Google's GWT Ajax framework with server-push updates to provide a desktop-like user interface experience and JSR 309 for Media Control. </td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-ipbx.html">Media IPBX</a>
          </td><td align="left">Demonstrates how a SIP PBX solution can be deployed using the Mobicents platform. For more information, refer to <a class="xref" href="#mipbx-Media_IPBX" title="4.1.6. Media IPBX">Section 4.1.6, “Media IPBX”</a>.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-jruby-example.html">JRuby on Rails SIP Servlets</a>
          </td><td align="left">Demonstrates how JRuby on Rails can be used by the Mobicents platform to provide a multi-language application that can initiate phone calls to customers after they log a complaint through a web portal.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-pure-jruby-telco.html">Pure JRuby on Rails Telco</a>
          </td><td align="left">Builds on the JRuby on Rails SIP Servlets demonstration, but adds the ability to call the application rather that initially interact through the web portal. The application has the ability to set up and tear down the call.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/alerting-app.html">Alerting Application</a>
          </td><td align="left">This application was developped so that the JBoss RHQ/Jopr Enterprise Management Solution would be able to notify system administrators when a monitoring alert is fired by Jopr/RHQ.</td></tr><tr><td align="left">
            <a class="ulink" href="http://www.mobicents.org/mss-presence-client-example.html">Alerting Application</a>
          </td><td align="left">A Call Blocking application interoperating with the Mobicents SIP Presence Service to fetch the blocked contacts through XCAP.</td></tr></tbody></table></div></div><br class="table-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sfss-Services_for_SIP_Servlets"/>4.1. Operating the Example Applications</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sfss-The_Location_Service"/>4.1.1. The Location Service</h3></div></div></div><p>The Mobicents Location Service contains a list of mappings of
    request URIs to destination addresses. When the Location Service receives
    a request, it performs a lookup on that mapping and proxies the request
    simultaneously to the destination address (or addresses) associated with
    that URI.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="sfss-The_Location_Service_Mappings_Cannot_Currently_Be_Configured"/><h2>The Location Service Mappings Cannot Currently Be Configured</h2><p>The Location Service currently performs a lookup on a hard-coded
      list of addresses. This model is evolving toward the eventual use of a
      database.</p></div><p>Regardless of whether you are using the JBoss Application Server or
    the Tomcat Servlet Container as the Servlets Server, the application,
    container and Location Service perform the following steps:</p><div class="itemizedlist"><ul><li><p>A user—let us call her Alice—makes a call to
        <code class="literal">sip:receiver@sip-servlets.com</code>. The
        <code class="literal">INVITE</code> is received by the servlet container, which
        then starts the Location Service.</p></li><li><p>The Location Service, using non-SIP means, determines that the
        callee (i.e. the receiver) is registered at two locations, identified
        by the two SIP URIs, <code class="literal">sip:receiver@127.0.0.1:5090</code>
        and <code class="literal">sip:receiver@127.0.0.1:6090</code>.</p></li><li><p>The Location Service proxies to those two destinations in
        parallel, without record-routing, and without making use of supervised
        mode.</p></li><li><p>One of the destinations returns a <code class="literal">200 OK</code>
        status code; the second proxy is then canceled.</p></li><li><p>The <code class="literal">200 OK</code> is forwarded to Alice, and call
        setup is completed as usual.</p></li></ul></div><p>Here is the current list of hard-coded contacts and their location
    URIs:</p><div class="itemizedlist"><p class="title"><b>sip:receiver@sip-servlets.com</b></p><ul><li><p><code class="literal">sip:receiver@127.0.0.1:5090</code></p></li><li><p><code class="literal">sip:receiver@127.0.0.1:6090</code></p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sfss-binary-Location_Service--Installing_Configuring_and_Running"/>4.1.1.1. The Location Service: Installing, Configuring and Running</h4></div></div></div><p> </p><p class="formalpara"><a id="sfss-binary-Location_Service-Pre-Install_Requirements_and_Prerequisites"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Pre-Install Requirements and Prerequisites</h5><p class="formalpara">The following requirements must be met before installation can begin.</p><div class="variablelist"><a id="sfss-binary-Location_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">Either an MSS for JBoss or an MSS for Tomcat Installation</span></dt><dd><p>The Location Service requires either an MSS for JBoss or an
            MSS for Tomcat binary installation.</p><p>You can find detailed instructions on installing MSS for
            JBoss here: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p><p>You can find detailed instructions on installing MSS for
            Tomcat here: <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Location_Service-Downloading"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">The Location Service is comprised of two archive files, a Web
        Archive (WAR) and a Default Application Router (DAR) configuration
        file, which you need to add to your installed SIP Servlets Server. For
        more information about WAR files, refer to the <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Server_Configuration_Guide/beta422/html/index.html">JBoss Application Server Administration and Development Guide</a>. For
        more information about DAR files, refer to the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=289">JSR 289 spec, Appendix C</a>.</p><p>Download the Location Service's WAR file from here: <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/location-service/1.4/location-service-1.4.war">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/location-service/1.4/location-service-1.4.war</a>.</p><p>Download the Location Service's DAR file from here: <a class="ulink" href="http://www.mobicents.org/locationservice-dar.properties">http://www.mobicents.org/locationservice-dar.properties</a>.</p><p class="formalpara"><a id="sfss-binary-Location_Service-Installing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">Both the <code class="filename">location-service-1.4.war</code> WAR file
        and the <code class="filename">locationservice-dar.properties</code> DAR file
        that you downloaded should be placed into different directories in
        your SIP Servlet Server installation hierarchy. Which directory
        depends on whether you are using the Location Service with MSS for
        JBoss or with MSS for Tomcat:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Place <code class="filename">location-service-1.4.war</code> into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/</code>
            directory, and <code class="filename">locationservice-dar.properties</code>
            into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/conf/dars/</code>
            directory.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Place <code class="filename">location-service-1.4.war</code> into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/webapps/</code>
            directory, and <code class="filename">locationservice-dar.properties</code>
            into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/dars/</code>
            directory.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Location_Service-Configuring"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">The <code class="literal">darConfigurationFileLocation</code> attribute of
        the <code class="literal">Service</code> element must be set to the value
        <strong class="userinput"><code>conf/dars/locationservice-dar.properties</code></strong>. The
        instructions are given below by SIP Servlets Server type:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/jboss-web.deployer/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <em class="replaceable"><code>conf/dars/locationservice-dar.properties</code></em>:</p><div class="example"><a id="sfss-Editing_SS_for_JBoss_server.xml_for_the_Location_Service"/><p class="title"><b>Example 4.1. Editing MSS for JBoss's server.xml for the Location Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/locationservice-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <strong class="userinput"><code>conf/dars/locationservice-dar.properties</code></strong>:</p><div class="example"><a id="sfss-Editing_MSS_for_Tomcats_server.xml_for_the_Location_Service"/><p class="title"><b>Example 4.2. Editing MSS for Tomcat's server.xml for the Location Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Sip-Servlets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/locationservice-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Location_Service-Running"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running</h5><p class="formalpara">Once the WAR and DAR files have been placed in the right
        directories, and the JBoss Application Server or Tomcat Servlet
        Container knows where to find them (which you specified in a
        <code class="filename">server.xml</code> file), then you should go ahead and
        run SIP Servlets Server.</p><p>To learn how to run the SIP Servlets-enabled JBoss Application
      Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running" title="2.1.7. Running">Section 2.1.7, “Running”</a>.</p><p>To learn how to run the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running" title="2.2.7. Running">Section 2.2.7, “Running”</a>.</p><p class="formalpara"><a id="sfss-binary-Location_Service-Testing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">The following procedure shows how to test the Location
        Service.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e4134"/><p class="title"><b>Procedure 4.1. </b></p><ol class="1"><li><p>Start two SIP soft-phones. The first phone should be set up as
          <strong class="userinput"><code>sip:receiver@sip-servlets.com</code></strong> at IP address
          <strong class="userinput"><code>127.0.0.1</code></strong> on port
          <strong class="userinput"><code>5090</code></strong>. The second phone can be set up in any
          way you like. Note that the SIP phones do not have to be
          registered.</p></li><li><p>Using the second phone, make a call to
          <code class="literal">sip:receiver@sip-servlets.com</code>. If the Location
          Service has been set up correctly and is running, the first phone—as
          the receiver or callee—should now be ringing.</p></li></ol></div><p class="formalpara"><a id="sfss-binary-Location_Service-Stopping"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Stopping</h5><p class="formalpara">To learn how to stop the SIP Servlets-enabled JBoss Application
        Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping" title="2.1.10. Stopping">Section 2.1.10, “Stopping”</a>.</p><p>To learn how to stop the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping" title="2.2.8. Stopping">Section 2.2.8, “Stopping”</a>.</p><p class="formalpara"><a id="sfss-binary-Location_Service-Uninstalling"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">Unless disk space is at a premium, there is usually no need to
        uninstall the Location Service. However, if you will not be using it
        again, you may want to unset or reset the
        <code class="literal">darConfigurationFileLocation</code> attribute of the
        <code class="literal">Service</code> element, which you set in the
        <code class="filename">server.xml</code> configuration file in <a class="xref" href="#sfss-binary-Location_Service-Configuring" title="Configuring">Configuring</a>.</p><p>You may also wish to delete the WAR and DAR files for the Location
      Service, which you installed in <a class="xref" href="#sfss-binary-Location_Service-Installing" title="Installing">Installing</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sfss-The_Diameter_Event-Changing_Service"/>4.1.2. The Diameter Event-Changing Service</h3></div></div></div><p>The Diameter Event-Changing Service is based on the Location
    Service, which performs call-charging at a fixed rate. Upon the initiation
    of a call, a debit of €10.00 occurs. In the cases of a call being rejected
    or the caller disconnecting (hanging up) before an answer is received, the
    caller's account is refunded.</p><p>Note that an MSS for JBoss installation is required to run this
    example; it will not work with MSS for Tomcat.</p><p>Provided here is a step-by-step description of the procedure as
    performed by the application and container:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sfss-Diameter_Event-Changing_Service_Step-By-Step"/><p class="title"><b>Procedure 4.2. Diameter Event-Changing Service Step-By-Step</b></p><ol class="1"><li><p>A user, Alice, makes a call to
        <code class="literal">sip:receiver@sip-servlets.com</code>. The
        <code class="literal">INVITE</code> is received by the servlet container, which
        sends a request to debit Alice's account to the Charging Server. The
        servlet container then invokes the location service.</p></li><li><p>the Location Service determines, without using the SIP protocol
        itself, where the callee—or receiver—is registered. The callee may be
        registered at two locations identified by two SIP URIs:
        <code class="literal">sip:receiver@127.0.0.1:5090</code> and
        <code class="literal">sip:receiver@127.0.0.1:6090</code>.</p></li><li><p>The Location Service proxies to those two destinations
        simultaneously, without record-routing and without using supervised
        mode.</p></li><li><p>One of the destinations returns <code class="literal">200 (OK)</code>, and
        so the container cancels the other.</p></li><li><p>The <code class="literal">200 (OK)</code> is forwarded upstream to Alice
        and the call setup is carried out as usual.</p></li><li><p>If neither or none of the registered destinations accepts the
        call, a Diameter Accounting-Request for refund is sent to the Diameter
        Charging Server in order to debit the already-credited €10.00</p></li></ol></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sfss-binary-Diameter_Event-Changing_Service--Installing_Configuring_and_Running"/>4.1.2.1. Diameter Event-Changing Service: Installing, Configuring and Running</h4></div></div></div><p>Preparing your MSS for JBoss server to run the Diameter
      Event-Changing example requires downloading a WAR archive, a DAR
      archive, the Ericsson Charging Emulator, setting an attribute in JBoss's
      <code class="filename">server.xml</code> configuration file, and then running
      JBoss AS. Detailed instructions follow.</p><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Pre-Install_Requirements_and_Prerequisites"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Pre-Install Requirements and Prerequisites</h5><p class="formalpara">The following requirements must be met before installation can begin.</p><div class="variablelist"><a id="sfss-binary-Diameter_Event-Changing_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">One MSS for JBoss Installation</span></dt><dd><p>Before proceeding, you should follow the instructions for
            installing, configuring, running and testing MSS for JBoss from
            the binary distribution.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Downloading"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">The following procedure describes how to download the required files.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><ol class="1"><li><p>First, download the Web Application Archive
          (<acronym class="acronym">WAR</acronym>) file corresponding to this example, the
          current version of which is named
          <code class="filename">diameter-event-charging-1.0.war</code>, from <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/diameter-event-charging/1.0/">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/diameter-event-charging/1.0/</a>.</p></li><li><p>Secondly, download the corresponding Disk Archive
          (<acronym class="acronym">DAR</acronym>) configuration file here:
           <a class="ulink" href="http://www.mobicents.org/diametereventcharging-dar.properties">http://www.mobicents.org/diametereventcharging-dar.properties</a>.</p></li><li><p>Finally, you will need to download the Ericsson Charging
          Emulator, version 1.0, from <a class="ulink" href="http://www.ericsson.com/mobilityworld/developerszonedown/downloads/tools/charging_solutions/ChargingSDK-1_0_D31E.zip">http://www.ericsson.com/mobilityworld/developerszonedown/downloads/tools/charging_solutions/ChargingSDK-1_0_D31E.zip</a>.</p></li></ol></div><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Installing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">The following procedure describes how to install the downloaded files.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><ol class="1"><li><p>Place the <code class="filename">diameter-event-charging-1.0.war</code>
          WAR archive into the
          <code class="filename">jboss_home/server/&lt;profile&gt;/deploy</code>
          directory, where <code class="filename">&lt;deploy&gt;</code> is your
          Configuration Profile, whether "default" or
          "all" (the latter if you are using MSS for JBoss's
          clustering capabilities).</p></li><li><p>Place the
          <code class="filename">diametereventcharging-dar.properties</code> DAR file
          in your
          <code class="filename"><code class="envar">$JBOSS_HOME</code>/server/&lt;profile&gt;/conf/dars</code>
          directory.</p></li><li><p>Finally, open the terminal, move into the directory to which
          you downloaded the Ericsson Charging SDK (for the sake of this
          example, we will call this directory
          <code class="filename">charging_sdk</code>), and then unzip the downloaded
          zip file (you can use Java's <code class="command">jar <code class="option">-xvf</code></code> command for this:</p><pre class="screen">~]$ cd charging_sdk
charging_sdk]$ jar -xvf ChargingSDK-1_0_D31E.zip</pre><p>Alternatively, you can use Linux's <code class="command">unzip</code>
          command to do the dirty work:</p><pre class="screen">charging_sdk]$ unzip ChargingSDK-1_0_D31E.zip</pre></li></ol></div><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Configuring"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">To configure the server for the Event-Changing example, simply
        open the <code class="filename">server.xml</code> configuration file in your
        server's
        <code class="filename"><code class="envar">$JBOSS_HOME</code>/server/&lt;profile&gt;/deploy/jboss-web.deployer/</code>
        directory, and edit the value of the
        <code class="literal">darConfigurationFileLocation</code> attribute of the
        <code class="literal">Service</code> element so that it is
        <code class="literal">conf/dars/mobicents-dar.properties</code>.</p><div class="example"><a id="sfss-Editing_the_darConfigurationFileLocation_Attribute_of_the_Service_Tag"/><p class="title"><b>Example 4.3. Editing the darConfigurationFileLocation Attribute of the Service Tag</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">...</span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">sipApplicationRouterClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.router.DefaultApplicationRouter&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/mobicents-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">...</span><br />
</pre></div></div><br class="example-break"/><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Running"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running</h5><p class="formalpara">The following procedure describes how to run the Diameter Event-Changing Service.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sfss-Diameter_Event-Changing_Service"/><p class="title"><b>Procedure 4.3. Diameter Event-Changing Service</b></p><ol class="1"><li><p>First, you should run your MSS for JBoss server. For
          instructions on doing so, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running" title="2.1.7. Running">Section 2.1.7, “Running”</a>.</p></li><li><p>Then, run the Ericsson Charging Emulator. Open a terminal,
          change the working directory to the location of the unzipped
          Charging Emulator files (in
          <code class="filename">ChargingSDK-1_0_D31E</code> or a similarly-named
          directory), and run it with the <code class="command">java -jar <code class="filename">PPSDiamEmul.jar</code></code> command:</p><pre class="screen">~]$ java -jar PPSDiamEmul.jar</pre></li></ol></div><p class="formalpara"><a id="sfss-binary-Diameter_Event-Changing_Service-Using"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Using</h5><p class="formalpara">Using the Event-Changing service means, firstly, inserting some
        parameters into the Charging Emulator, and then, by using two SIP
        (soft)phones, calling one with the other. The following sequential
        instructions show you how.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="sfss-SIP_SoftPhone_Which"/><h2>SIP (Soft)Phone? Which?</h2><p>The Mobicents team recommends one of the following SIP phones,
        and has found that they work well: the 3CX Phone, the SJ Phone or the
        WengoPhone.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sfss-Using_the_Diameter_Event-Changing_Service"/><p class="title"><b>Procedure 4.4. Using the Diameter Event-Changing Service</b></p><ol class="1"><li><p class="title"><b>Configure the Ericsson SDK Charging Emulator</b></p><p>Once you have started the Charging Emulator, you should
          configure it exactly as portrayed in <a class="xref" href="#figure-mss-ChargingEmulatorConfig" title="Figure 4.1. Configuring the Charging Emulator">Figure 4.1, “Configuring the Charging Emulator”</a>.</p><div class="figure"><a id="figure-mss-ChargingEmulatorConfig"/><div class="figure-contents"><div class="mediaobject" align="center"><a id="sfss-mss-DiameterEventChanging-ss-ChargingEmulatorConfig"/><img src="images/mss-DiameterEventChanging-ss-ChargingEmulatorConfig.png" align="middle" alt="Configuring the Charging Emulator"/><div class="caption"><p>Configuring the Charging Emulator</p></div></div></div><p class="title"><b>Figure 4.1. Configuring the Charging Emulator</b></p></div><br class="figure-break"/><div class="orderedlist"><ol><li><p>Set the <code class="literal">Peer Id</code> to:
              <strong class="userinput"><code>aaa://127.0.0.1:21812</code></strong></p></li><li><p>Set the <code class="literal">Realm</code> to:
              <strong class="userinput"><code>mobicents.org</code></strong></p></li><li><p>Set the <code class="literal">Host IP</code> to:
              <strong class="userinput"><code>127.0.0.1</code></strong></p></li></ol></div></li><li><p>Start two SIP (soft)phones. You should set the first phone up
          with the following parameters:
          <strong class="userinput"><code>sip:receiver@sip-servlets</code></strong> on IP address
          <strong class="userinput"><code>127.0.0.1</code></strong> on port
          <strong class="userinput"><code>5090</code></strong>. The other phone can be set up any way
          you like.</p></li><li><p>Before making a call, open the <span class="guimenu"><strong>Config</strong></span> → <span class="guimenuitem"><strong>Options</strong></span> dialog window, as shown in the image.</p><div class="mediaobject" align="center"><a id="sfss-mss-DiameterEventChanging-ss-ChargingAccountConfig"/><img src="images/mss-DiameterEventChanging-ss-ChargingAccountConfig.png" align="middle"/><div class="caption"><p>Configuring Accounts in the Charging
            Emulator</p></div></div><p>In the <span class="guilabel"><strong>Account Configuration</strong></span> window of
          the Charging Emulator, you can see the user's balances. Select a
          user to watch the balance. You can also stretch the window
          lengthwise to view the user's transaction history.</p></li><li><p>Time to call! From the second,
          “<span class="quote">any-configuration</span>” phone, make a call to
          <code class="literal">sip:receiver@sip-servlets.com</code>. Upon doing so, the
          other phone should ring or signal that it is being contacted
          .</p></li><li><p>You should be able to see a request—immediately following the
          invite and before the other party (i.e. you) accepts or rejects the
          call—sent to the Charging Emulator. That is when the debit of the
          user's account is made. In the case that the call is rejected, or
          the caller gives up, a second, new Diameter request is sent to
          refund the initial amount charged by the call. On the other hand, if
          the call is accepted, nothing else related to Diameter happens, and
          no second request takes place.</p><p>Please not that this is not the truly-correct way to do
          charging, as Diameter provides other means, such as unit
          reservation. However, for the purpose of a demonstration it is
          sufficient to show the debit and follow-up credit working. Also,
          this is a fixed-price call, regardless of the duration. Charging
          can, of course, be configured so that it is time-based.</p></li></ol></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sfss-The_Call-Blocking_Service"/>4.1.3. The Call-Blocking Service</h3></div></div></div><p>The Mobicents Call-Blocking Service, upon receiving an
    <code class="literal">INVITE</code> request, checks to see whether the sender's
    address is a blocked contact. If so, it returns a
    <code class="literal">FORBIDDEN</code> reply; otherwise, call setup proceeds as
    normal.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="sfss-Blocked_Contacts_Cannot_Currently_Be_Configured"/><h2>Blocked Contacts Cannot Currently Be Configured</h2><p>Blocked contacts are currently hard-coded addresses. This model is
      evolving towards the eventual use of a database.</p></div><p>Here is the current hard-coded list of blocked contacts:</p><div class="itemizedlist"><ul><li><p><code class="literal">sip:blocked-sender@sip-servlets.com</code></p></li><li><p><code class="literal">sip:blocked-sender@127.0.0.1</code></p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sfss-binary-Call-Blocking_Service--Installing_Configuring_and_Running"/>4.1.3.1. The Call-Blocking Service: Installing, Configuring and Running</h4></div></div></div><p> </p><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Pre-Install_Requirements_and_Prerequisites"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Pre-Install Requirements and Prerequisites</h5><p class="formalpara">The following requirements must be met before installation can begin.</p><div class="variablelist"><a id="sfss-binary-Call-Blocking_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">Either an MSS for JBoss or an MSS for Tomcat Installation</span></dt><dd><p>The Call-Blocking Service requires either an MSS for JBoss
            or an MSS for Tomcat binary installation.</p><p>You can find detailed instructions on installing MSS for
            JBoss here: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p><p>You can find detailed instructions on installing MSS for
            Tomcat here: <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Downloading"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">The Call-Blocking Service is comprised of two archive files, a
        Web Archive (WAR) and a Default Application Router (DAR) configuration
        file, which you need to add to your installed SIP Servlets Server. For
        more information about WAR files, refer to the <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Server_Configuration_Guide/beta422/html/index.html">JBoss Application Server Administration and Development Guide</a>. For
        more information about DAR files, refer to the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=289">JSR 289 spec, Appendix C</a>.</p><p>Download the Call-Blocking Service's WAR file from here: <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-blocking/1.4/call-blocking-1.4.war">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-blocking/1.4/call-blocking-1.4.war</a>.</p><p>Download the Call-Blocking Service's DAR file from here: <a class="ulink" href="http://www.mobicents.org/call-blocking-servlet-dar.properties">http://www.mobicents.org/call-blocking-servlet-dar.properties</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Installing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">Both the <code class="filename">call-blocking-1.4.war</code> WAR file and
        the <code class="filename">call-blocking-servlet-dar.properties</code> DAR file
        that you downloaded should be placed into different directories in
        your SIP Servlet Server installation hierarchy. Which directory depends
        on whether you are using the Call-Blocking Service with MSS for JBoss
        or with MSS for Tomcat:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Place <code class="filename">call-blocking-1.4.war</code> into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/</code>
            directory, and
            <code class="filename">call-blocking-servlet-dar.properties</code> into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/conf/dars/</code>
            directory.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Place
            <code class="filename">call-blocking-servlet-dar.properties</code> into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/webapps/</code>
            directory, and
            <code class="filename">call-blocking-servlet-dar.properties</code> into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/dars/</code>
            directory.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Configuring"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">The <code class="literal">darConfigurationFileLocation</code> attribute of
        the <code class="literal">Service</code> element must be set to the value
        <strong class="userinput"><code>conf/dars/call-blocking-servlet-dar.properties</code></strong>.
        The instructions for doing so are given below by SIP Servlets Server
        type:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/jboss-web.deployer/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <em class="replaceable"><code>conf/dars/call-blocking-servlet-dar.properties</code></em>:</p><div class="example"><a id="sfss-Editing_SS_for_JBoss_server.xml_for_the_Call-Blocking_Service"/><p class="title"><b>Example 4.4. Editing MSS for JBoss's server.xml for the Call-Blocking Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-blocking-servlet-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <strong class="userinput"><code>conf/dars/call-blocking-servlet-dar.properties</code></strong>:</p><div class="example"><a id="sfss-Editing_MSS_for_Tomcats_server.xml_for_the_Call-Blocking_Service"/><p class="title"><b>Example 4.5. Editing MSS for Tomcat's server.xml for the Call-Blocking Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Sip-Servlets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-blocking-servlet-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Running"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running</h5><p class="formalpara">Once the WAR and DAR files have been placed in the right
        directories, and the JBoss Application Server or Tomcat Servlet
        Container knows where to find them (which you specified in a
        <code class="filename">server.xml</code> file), then you should go ahead and
        run SIP Servlets Server.</p><p>To learn how to run the SIP Servlets-enabled JBoss Application
      Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running" title="2.1.7. Running">Section 2.1.7, “Running”</a>.</p><p>To learn how to run the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running" title="2.2.7. Running">Section 2.2.7, “Running”</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Testing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">The following procedure shows how to test the Call-Blocking
        Service.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e4727"/><p class="title"><b>Procedure 4.5. Testing the Call Blocking Service</b></p><ol class="1"><li><p>Start a SIP softphone of your choice. The account name should
          be <strong class="userinput"><code>blocked-sender</code></strong>. The <code class="literal">From Header</code> should list one of the following addresses:
          <strong class="userinput"><code>sip:blocked-sender@sip-servlets.com</code></strong> or
          <strong class="userinput"><code>sip:blocked-sender@127.0.0.1</code></strong>. The SIP
          softphone does not need to be registered.</p></li><li><p>Make a call to any address, and you should receive a
          <code class="literal">FORBIDDEN</code> response.</p></li></ol></div><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Stopping"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Stopping</h5><p class="formalpara">To learn how to stop the SIP Servlets-enabled JBoss Application
        Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping" title="2.1.10. Stopping">Section 2.1.10, “Stopping”</a>.</p><p>To learn how to stop the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping" title="2.2.8. Stopping">Section 2.2.8, “Stopping”</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Blocking_Service-Uninstalling"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">Unless disk space is at a premium, there is usually no need to
        uninstall the Call-Blocking Service. However, if you will not be using
        it again, you may want to unset or reset the
        <code class="literal">darConfigurationFileLocation</code> attribute of the
        <code class="literal">Service</code> element, which you set in the
        <code class="filename">server.xml</code> configuration file in <a class="xref" href="#sfss-binary-Call-Blocking_Service-Configuring" title="Configuring">Configuring</a>.</p><p>You may also wish to delete the WAR and DAR files for the
      Call-Blocking Service, which you installed in <a class="xref" href="#sfss-binary-Call-Blocking_Service-Installing" title="Installing">Installing</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sfss-The_Call-Forwarding_Service"/>4.1.4. The Call-Forwarding Service</h3></div></div></div><p>The Mobicents Call-Forwarding Service, upon receiving an
    <code class="literal">INVITE</code> request, checks to see whether the sender's
    address is among those in a list of addresses which need to be forwarded.
    If so, then the Call-Forwarding Service acts as a Back-to-Back User Agent
    (B2BUA), and creates a new call leg to the destination. When the response
    is received from the new call leg, it sends it an acknowledgment
    (<code class="literal">ACK</code>) and then responds to the original caller. If, on
    the other hand, the server does not receive an <code class="literal">ACK</code>,
    then it tears down the new call leg with a <code class="literal">BYE</code>. Once
    the <code class="literal">BYE</code> is received, then it answers
    <code class="literal">OK</code> directly and sends the <code class="literal">BYE</code> to
    the new call leg.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="sfss-Contacts_to_Forward_Cannot_Currently_Be_Configured"/><h2>Contacts to Forward Cannot Currently Be Configured</h2><p>Contacts to forward are currently hard-coded addresses. This model
      is evolving toward the eventual use of a database.</p></div><p>Here is the current hard-coded list of contacts to forward:</p><div class="itemizedlist"><ul><li><p><code class="literal">sip:receiver@sip-servlets.com</code></p></li><li><p><code class="literal">sip:receiver@127.0.0.1</code></p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sfss-binary-Call-Forwarding_Service--Installing_Configuring_and_Running"/>4.1.4.1. The Call-Forwarding Service: Installing, Configuring and Running</h4></div></div></div><p> </p><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Pre-Install_Requirements_and_Prerequisites"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Pre-Install Requirements and Prerequisites</h5><p class="formalpara">The following requirements must be met before installation can begin.</p><div class="variablelist"><a id="sfss-binary-Call-Forwarding_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">Either an MSS for JBoss or an MSS for Tomcat Installation</span></dt><dd><p>The Call-Forwarding Service requires either an MSS for JBoss
            or an MSS for Tomcat binary installation.</p><p>You can find detailed instructions on installing MSS for
            JBoss here: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p><p>You can find detailed instructions on installing MSS for
            Tomcat here: <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Downloading"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">The Call-Forwarding Service is comprised of two archive files, a
        Web Archive (WAR) and a Data Archive (DAR), which you need to add to
        your installed SIP Servlets Server. For more information about WAR and
        DAR files, refer to the <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Server_Configuration_Guide/beta422/html/index.html">JBoss Application Server Administration and Development Guide</a>.</p><p>Download the Call-Forwarding Service's WAR file from here: <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-forwarding/1.4/call-forwarding-1.4.war">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-forwarding/1.4/call-forwarding-1.4.war</a>.</p><p>Download the Call-Forwarding Service's DAR file from here: <a class="ulink" href="http://www.mobicents.org/call-forwarding-servlet-dar.properties">http://www.mobicents.org/call-forwarding-servlet-dar.properties</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Installing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">Both the <code class="filename">call-forwarding-1.4.war</code> WAR file
        and the <code class="filename">call-forwarding-servlet-dar.properties</code>
        DAR file that you downloaded should be placed into different
        directories in your SIP Servlet Server installation hierarchy. Which
        directory depends on whether you are using the Call-Forwarding Service
        with MSS for JBoss or with MSS for Tomcat:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Place <code class="filename">call-forwarding-1.4.war</code> into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/</code>
            directory, and
            <code class="filename">call-forwarding-servlet-dar.properties</code> into
            the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/conf/dars/</code>
            directory.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Place <code class="filename">call-forwarding-1.4.war</code> into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/webapps/</code>
            directory, and
            <code class="filename">call-forwarding-servlet-dar.properties</code> into
            the <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/dars/</code>
            directory.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Configuring"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">The <code class="literal">darConfigurationFileLocation</code> attribute of
        the <code class="literal">Service</code> element must be set to the value
        <strong class="userinput"><code>conf/dars/call-forwarding-b2bua-servlet-dar.properties</code></strong>.
        The instructions for doing so are given below by SIP Servlets Server
        type:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/jboss-web.deployer/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <em class="replaceable"><code>conf/dars/call-forwarding-b2bua-servlet-dar.properties</code></em>:</p><div class="example"><a id="sfss-Editing_SS_for_JBoss_server.xml_for_the_Call-Forwarding_Service"/><p class="title"><b>Example 4.6. Editing MSS for JBoss's server.xml for the Call-Forwarding Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-forwarding-b2bua-servlet-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <strong class="userinput"><code>conf/dars/call-forwarding-b2bua-servlet-dar.properties</code></strong>:</p><div class="example"><a id="sfss-Editing_MSS_for_Tomcats_server.xml_for_the_Call-Forwarding_Service"/><p class="title"><b>Example 4.7. Editing MSS for Tomcat's server.xml for the Call-Forwarding Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Sip-Servlets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-forwarding-b2bua-servlet-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Running"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running</h5><p class="formalpara">Once the WAR and DAR files have been placed in the right
        directories, and the JBoss Application Server or Tomcat Servlet
        Container knows where to find them (which you specified in a
        <code class="filename">server.xml</code> file), then you should go ahead and
        run SIP Servlets Server.</p><p>To learn how to run the SIP Servlets-enabled JBoss Application
      Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running" title="2.1.7. Running">Section 2.1.7, “Running”</a>.</p><p>To learn how to run the SIP Servlets-enabled Tomcat Container,
      refer to <a class="ulink" href="bbssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running">bbssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Testing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">The following procedure shows how to test the Call-Forwarding
        Service.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e5022"/><p class="title"><b>Procedure 4.6. </b></p><ol class="1"><li><p>Start two SIP soft-phones of your choice. Set the account
          settings of the first SIP softphone to:</p><div class="itemizedlist"><ul><li><p>Account name:
              <strong class="userinput"><code>forward-receiver</code></strong></p></li><li><p>IP address: <strong class="userinput"><code>127.0.0.1</code></strong></p></li><li><p>Port: <strong class="userinput"><code>5090</code></strong></p></li></ul></div><p>Neither of the SIP soft-phones needs to be registered.</p></li><li><p>From the second phone, make a call to
          <code class="literal">sip:receiver@sip-servlets.com</code>. The first phone,
          "forward-receiver", should now be ringing.</p></li></ol></div><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Stopping"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Stopping</h5><p class="formalpara">To learn how to stop the SIP Servlets-enabled JBoss Application
        Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping" title="2.1.10. Stopping">Section 2.1.10, “Stopping”</a>.</p><p>To learn how to stop the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping" title="2.2.8. Stopping">Section 2.2.8, “Stopping”</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Forwarding_Service-Uninstalling"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">Unless disk space is at a premium, there is usually no need to
        uninstall the Call-Forwarding Service. However, if you will not be
        using it again, you may want to unset or reset the
        <code class="literal">darConfigurationFileLocation</code> attribute of the
        <code class="literal">Service</code> element, which you set in the
        <code class="filename">server.xml</code> configuration file in <a class="xref" href="#sfss-binary-Call-Forwarding_Service-Configuring" title="Configuring">Configuring</a>.</p><p>You may also wish to delete the WAR and DAR files for the
      Call-Forwarding Service, which you installed in <a class="xref" href="#sfss-binary-Call-Forwarding_Service-Installing" title="Installing">Installing</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sfss-The_Call-Controller_Service"/>4.1.5. The Call-Controller Service</h3></div></div></div><p>The Call-Controller service is a composition of two other services:
    Call-Blocking and Call-Forwarding. Essentially, it performs the services
    of both call-forwarding and call-blocking.</p><div class="itemizedlist"><ul><li><p>To learn about how the Call-Blocking service works, refer to
        <a class="xref" href="#sfss-The_Call-Blocking_Service" title="4.1.3. The Call-Blocking Service">Section 4.1.3, “The Call-Blocking Service”</a>.</p></li><li><p>To learn about how the Call-Forwarding service works, refer to
        <a class="xref" href="#sfss-The_Call-Forwarding_Service" title="4.1.4. The Call-Forwarding Service">Section 4.1.4, “The Call-Forwarding Service”</a>.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><a id="sfss-Blocked_Contacts_and_Contacts_to_Forward_Cannot_Currently_Be_Configured"/><h2>Blocked Contacts and Contacts to Forward Cannot Currently Be Configured</h2><p>Both the list of blocked contacts and the list of contacts to
      forward are currently both hard-coded. However, both of those models are
      evolving toward the eventual use of databases.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sfss-binary-Call-Controller_Service--Installing_Configuring_and_Running"/>4.1.5.1. The Call-Controller Service: Installing, Configuring and Running</h4></div></div></div><p>The Call-Controller service requires the two WAR files for the
      Call-Blocking and Call-Forwarding services to be placed in the correct
      directory inside your Mobicents SIP Servlets Server binary installation.
      However, the Call-Controller service does <span class="emphasis"><em>not</em></span>
      require their corresponding DAR files: you need only to download and
      install a DAR file customized for the Call-Controller service. The
      instructions below show you how to do precisely this; there is no need,
      therefore, to first install either the Call-Blocking or the
      Call-Forwarding services, though it is helpful to at least be familiar
      with them.</p><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Pre-Install_Requirements_and_Prerequisites"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Pre-Install Requirements and Prerequisites</h5><p class="formalpara">The following requirements must be met before installation can begin.</p><div class="variablelist"><a id="sfss-binary-Call-Controller_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">Either an MSS for JBoss or an MSS for Tomcat Installation</span></dt><dd><p>The Call-Controller Service requires either an MSS for JBoss
            or an MSS for Tomcat binary installation.</p><p>You can find detailed instructions on installing MSS for
            JBoss here: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p><p>You can find detailed instructions on installing MSS for
            Tomcat here: <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Downloading"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Downloading</h5><p class="formalpara">The Call-Controller Service is comprised of two WAR files, one
        for the Call-Forwarding service and one for Call-Blocking, and a
        customized Call-Controller DAR file. You do not need to install the
        DAR files for the Call-Forwarding or the Call-Blocking services. For
        more information about WAR files, refer to the <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Server_Configuration_Guide/beta422/html/index.html">JBoss Application Server Administration and Development Guide</a>. For
        more information about DAR files, refer to the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=289">JSR 289 spec, Appendix C</a></p><p>Download the Call-Blocking Service's WAR file from here: <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-blocking/1.4/call-blocking-1.4.war">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-blocking/1.4/call-blocking-1.4.war</a>.</p><p>Download the Call-Forwarding Service's WAR file from here: <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-forwarding/1.4/call-forwarding-1.4.war">http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/call-forwarding/1.4/call-forwarding-1.4.war</a>.</p><p>Download the Call-Controller Service's DAR file from here: <a class="ulink" href="http://www.mobicents.org/call-controller-servlet-dar.properties">http://www.mobicents.org/call-controller-servlet-dar.properties</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Installing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Installing</h5><p class="formalpara">The <code class="filename">call-blocking-1.4.war</code>,
        <code class="filename">call-forwarding-1.4.war</code> and
        <code class="filename">call-controller-servlet-dar.properties</code> archive
        files that you downloaded should be placed into different directories
        in your SIP Servlet Server installation hierarchy. Which directory
        depends on whether you are using the Call-Controller Service with MSS
        for JBoss or with MSS for Tomcat:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Place <code class="filename">call-blocking-1.4.war</code> and
            <code class="filename">call-forwarding-1.4.war</code> into the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/</code>
            directory, and
            <code class="filename">call-controller-servlet-dar.properties</code> into
            the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/conf/dars/</code>
            directory.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Place <code class="filename">call-blocking-1.4.war</code> and
            <code class="filename">call-forwarding-1.4.war</code> into the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/webapps/</code>
            directory, and
            <code class="filename">call-controller-servlet-dar.properties</code> into
            the <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/dars/</code>
            directory.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Configuring"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring</h5><p class="formalpara">The <code class="literal">darConfigurationFileLocation</code> attribute of
        the <code class="literal">Service</code> element must be set to the value
        <strong class="userinput"><code>conf/dars/call-controller-servlet-dar.properties</code></strong>.
        Instructions for doing so are given below by SIP Servlets Server
        type:</p><div class="variablelist"><dl><dt><span class="term">MSS for JBoss</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">JBOSS_HOME</code>/server/default/deploy/jboss-web.deployer/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <em class="replaceable"><code>conf/dars/call-controller-servlet-dar.properties </code></em>:</p><div class="example"><a id="sfss-Editing_SS_for_JBoss_server.xml_for_the_Call-Controller_Service"/><p class="title"><b>Example 4.8. Editing MSS for JBoss's server.xml for the Call-Controller Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-controller-servlet-dar.properties&nbsp;&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd><dt><span class="term">MSS for Tomcat</span></dt><dd><p>Open the
            <code class="filename"><code class="envar">CATALINA_HOME</code>/conf/server.xml</code>
            configuration file and find the <code class="literal">Service</code>
            element. Add an attribute to it called
            <strong class="userinput"><code>darConfigurationFileLocation</code></strong>, and set it to
            <strong class="userinput"><code>conf/dars/call-controller-servlet-dar.properties </code></strong>:</p><div class="example"><a id="sfss-Editing_MSS_for_Tomcats_server.xml_for_the_Call-Controller_Service"/><p class="title"><b>Example 4.9. Editing MSS for Tomcat's server.xml for the Call-Controller Service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Sip-Servlets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/call-controller-servlet-dar.properties&nbsp;&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Make sure that the configuration file only contains one
            <code class="literal">darConfigurationFileLocation</code> attribute: your
            new one.</p></dd></dl></div><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Running"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running</h5><p class="formalpara">Once the WAR and DAR files have been placed in the right
        directories, and the JBoss Application Server or Tomcat Servlet
        Container knows where to find them (which you specified in a
        <code class="filename">server.xml</code> file), then you should go ahead and
        run SIP Servlets Server.</p><p>To learn how to run the SIP Servlets-enabled JBoss Application
      Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Running" title="2.1.7. Running">Section 2.1.7, “Running”</a>.</p><p>To learn how to run the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Running" title="2.2.7. Running">Section 2.2.7, “Running”</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Testing"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing</h5><p class="formalpara">Two use-cases can be distinguished for the Call-Controller
        service: one in which a call is blocked, and another in which a call
        is forwarded. Therefore, we have two cases for which we can test the
        Call-Controller.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sfss-Blocking_a_Call_with_the_Call-Controller"/><p class="title"><b>Procedure 4.7. Blocking a Call with Call-Controller</b></p><ol class="1"><li><p>Start two SIP soft-phones of your choice. Set the account
          settings of the SIP soft-phones to:</p><div class="itemizedlist"><p class="title"><b>Relevant First Softphone Settings</b></p><ul><li><p>Account name:
              <strong class="userinput"><code>forward-receiver</code></strong></p></li><li><p>IP address: <strong class="userinput"><code>127.0.0.1</code></strong></p></li><li><p>Port: <strong class="userinput"><code>5090</code></strong></p></li></ul></div><div class="itemizedlist"><p class="title"><b>Relevant Second Softphone Settings</b></p><ul><li><p>Account name: <strong class="userinput"><code>blocked-sender</code></strong></p></li></ul></div><p>Neither of the SIP soft-phones needs to be registered.</p></li><li><p>From the second phone, <code class="literal">blocked-sender</code>, make
          a call to <code class="literal">sip:receiver@sip-servlets.com</code>. You
          should receive a <code class="literal">FORBIDDEN</code> response.</p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sfss-Forwarding_a_Call_with_the_Call-Controller"/><p class="title"><b>Procedure 4.8. Forwarding a Call with Call-Controller</b></p><ol class="1"><li><p>Start two SIP soft-phones of your choice. Set the account
          settings of the SIP soft-phones to:</p><div class="itemizedlist"><p class="title"><b>Relevant First Softphone Settings</b></p><ul><li><p>Account name:
              <strong class="userinput"><code>forward-receiver</code></strong></p></li><li><p>IP address: <strong class="userinput"><code>127.0.0.1</code></strong></p></li><li><p>Port: <strong class="userinput"><code>5090</code></strong></p></li></ul></div><div class="itemizedlist"><p class="title"><b>Relevant Second Softphone Settings</b></p><ul><li><p>Account name: <strong class="userinput"><code>forward-sender</code></strong></p></li></ul></div><p>Neither of the SIP soft-phones needs to be registered.</p></li><li><p>From the second softphone, <code class="literal">forward-sender</code>,
          make a call to <code class="literal">sip:receiver@sip-servlets.com</code>. The
          first phone, <code class="literal">forward-receiver</code>, should now be
          ringing.</p></li></ol></div><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Stopping"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Stopping</h5><p class="formalpara">To learn how to stop the SIP Servlets-enabled JBoss Application
        Server, refer to <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping" title="2.1.10. Stopping">Section 2.1.10, “Stopping”</a>.</p><p>To learn how to stop the SIP Servlets-enabled Tomcat Container,
      refer to <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping" title="2.2.8. Stopping">Section 2.2.8, “Stopping”</a>.</p><p class="formalpara"><a id="sfss-binary-Call-Controller_Service-Uninstalling"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Uninstalling</h5><p class="formalpara">Unless disk space is at a premium, there is usually no need to
        uninstall the Call-Controller Service. However, if you will not be
        using it again, you may want to unset or reset the
        <code class="literal">darConfigurationFileLocation</code> attribute of the
        <code class="literal">Service</code> element, which you set in the
        <code class="filename">server.xml</code> configuration file in <a class="xref" href="#sfss-binary-Call-Controller_Service-Configuring" title="Configuring">Configuring</a>.</p><p>You may also wish to delete the WAR and DAR files for the
      Call-Controller Service, which you installed in <a class="xref" href="#sfss-binary-Call-Controller_Service-Installing" title="Installing">Installing</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><a class="xref" href="#ssea-SIP_Servlet_Example_Applications" title="Chapter 4. SIP Servlet Example Applications">Chapter 4, <i>SIP Servlet Example Applications</i></a>
        provides more information about other service examples
        available.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mipbx-Media_IPBX"/>4.1.6. Media IPBX</h3></div></div></div><p>The Media IPBX provides an extensible and customizable SIP PBX solution, based on the Seam Telco Framework (STF).  While the PBX is currently provided as a capability demonstration, the ultimate goal is to transition Media IPBX into a fully-fledged SIP PBX solution.</p><p>Media IPBX terminates all calls to Mobicents Media Server conference endpoints, which provides flexibility in manipulating established calls including server-side conferencing and ring-back tones.  The PBX can also be implemented as a Session Border Controller.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Media IPBX is compatible with Mobicents SIP Servlets with JBoss AS 4.2.3; versions prior to this release do not support Media IPBX.</p></div><p>Media IPBX provides the following major features:
      </p><div class="itemizedlist"><ul><li><p>User authentication.</p></li><li><p>SIP phone registration.</p></li><li><p>System configuration.</p></li><li><p>Individual user views.</p></li><li><p>Call monitoring and management.</p></li><li><p>Multiple SIP phone instances per user.</p></li><li><p>Status-based SIP phone assignment for incoming calls.</p></li><li><p>Public Switched Telephone Network (PSTN) support including administrative functions.</p></li><li><p>Support for SIP REGISTER requests to automatically add phones by matching the username, or username and hostname (in 'strict mode' only).</p></li><li><p>Optionally specify local or online sources for announcements and ringback tones.</p></li><li><p>Session Border Controller capability.</p></li><li><p>Full conferencing support, including:
          </p><div class="itemizedlist"><ul><li><p>Privacy functions, such as mute and closed-calls.</p></li><li><p>Call status announcement.</p></li><li><p>Ringback tones when waiting for other participants to join the conference.</p></li><li><p>Joining incoming calls to a conference.</p></li><li><p>Parking calls and isolating a single speaker using dual-tone multi-frequency (DTMF) tones.  This feature is currently experimental.</p></li></ul></div><p>
          </p></li></ul></div><p>
    </p><p>Many of the features in Media IPBX are presented to the user as hints on the GUI portal pages.  It is recommended to install Media IPBX and experiment with the demonstration to gain an understanding of how the solution works.</p><p>For information about installing and running Media IPBX, including binary and source code locations, visit the <a class="ulink" href="http://www.mobicents.org/mss-ipbx.html">Media IPBX homepage</a>.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5521"/>Chapter 5. Clustering and High Availability</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ssfjcs-SS_for_JBoss-Clustering_Support">5.1. Mobicents SIP Servlets for JBoss: Clustering Support</a></span></dt><dd><dl><dt><span class="section"><a href="#ssfjcs-binary-SIP_Servlets_Server_Cluster-Installing_Configuring_and_Running">5.1.1. SIP Servlets Server Cluster: Installing, Configuring and Running</a></span></dt></dl></dd><dt><span class="section"><a href="#ssfjfs-SS_for_JBoss-Failover_Support">5.2. Mobicents SIP Servlets for JBoss: Transparent Failover</a></span></dt><dd><dl><dt><span class="section"><a href="#ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover--Installing_Configuring_and_Running">5.2.1. MSS for JBoss Cluster: Installing, Configuring and Running</a></span></dt></dl></dd><dt><span class="section"><a href="#sslb-MSS_Load_Balancer">5.3. Load Balancer</a></span></dt><dd><dl><dt><span class="section"><a href="#sslb-SIP_Load_Balancing_Basics">5.3.1. SIP Load Balancing Basics</a></span></dt><dt><span class="section"><a href="#d0e5812">5.3.2. HTTP Load Balancing Basics</a></span></dt><dt><span class="section"><a href="#d0e5851">5.3.3. Pluggable balancer algorithms</a></span></dt><dt><span class="section"><a href="#d0e5888">5.3.4. Distributed load balancing</a></span></dt><dt><span class="section"><a href="#sslb-SIP_Servlets_Load_Balancer-Implementation">5.3.5. Implementation of the Mobicents Load Balancer</a></span></dt><dt><span class="section"><a href="#d0e5918">5.3.6. SIP Message Flow</a></span></dt><dt><span class="section"><a href="#sslb-binary-SIP_Load_Balancer-Installing_Configuring_and_Running">5.3.7. SIP Load Balancer: Installing, Configuring and Running</a></span></dt><dt><span class="section"><a href="#d0e6508">5.3.8. IP Load Balancing</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ssfjcs-SS_for_JBoss-Clustering_Support"/>5.1. Mobicents SIP Servlets for JBoss: Clustering Support</h2></div></div></div><p>Mobicents supports the clustering of SIP Servlets-enabled JBoss Application Servers for performance, reliability and failover purposes. Note that only MSS for JBoss Servers can be used as cluster nodes; MSS for Tomcat Containers are not supported.</p><p>The SIP Servlets Server uses the  JBoss Application Server as its servlet container, and takes advantage of its capabilities, including clustering and failover.  For detailed background information about JBoss Application Server clustering refer to the <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Clustering_Guide/beta422/html/index.html">JBoss Application Server Clustering Guide</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Installing_Configuring_and_Running"/>5.1.1. SIP Servlets Server Cluster: Installing, Configuring and Running</h3></div></div></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-PreInstall_Requirements_and_Prerequisites"/>5.1.1.1. Pre-Install Requirements and Prerequisites</h4></div></div></div><p/><div class="variablelist"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">A SIP Servlets-enabled JBoss Application Server</span></dt><dd><p>Before proceeding, ensure you have correctly configured your JBoss Application Server, according to SIP Servlet Server requirements:</p><div class="itemizedlist"><ul><li><p>
         <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>
        </p></li></ul></div><p>The easiest way to set up a cluster of SIP Servlets-enabled JBoss Application Servers is to install, configure and test the binary distribution on one machine, and then  copy the entire installation (directory) to the other machines in the cluster. This is the approach taken in this chapter.</p><p>Install a SIP Servlets Server with JBoss by following the instructions detailed in <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>. </p><p>Afer meeting the requirement you can begin to configure the server  <a class="xref" href="#ssfjcs-binary-SIP_Servlets_Server_Cluster-Configuring" title="5.1.1.2. Configuring">Section 5.1.1.2, “Configuring”</a> below.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Configuring"/>5.1.1.2. Configuring</h4></div></div></div><p>Once installed, the MSS for JBoss binary distribution requires only minor configuration in order to enable clustering. </p><p>SIP, and HTTP session state clustering is  pre-configured straight out of the binary distribution. However, to enable session replication in a node, you must tag it as <code class="literal">&lt;distributable/&gt;</code> both in the <code class="filename">web.xml</code> and <code class="filename">sip.xml</code> descriptors. This can be done only individually (per application).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Running"/>5.1.1.3. Running</h4></div></div></div><p>Clustering with MSS for JBoss nodes requires running all of the nodes using the "all" Server Configuration Profile, which is specified when you invoke <code class="command">run.sh</code> or <code class="command">run.bat</code>.</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running MSS for JBoss with the "all" Configuration Profile, on Linux</h5><p class="formalpara">To run the server on Linux using the "all" Configuration Profile, start the server with the following command:</p><pre class="screen">MSS-jboss-&lt;version&gt;]$ ./bin/run.sh -c all</pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Running MSS for JBoss with the "all" Configuration Profile, on Windows</h5><p class="formalpara">To run the server on Windows using the "all" Configuration Profile, open the Command Prompt, change your folder to the topmost folder of your MSS for JBoss installation, and issue the following command:</p><pre class="screen">C:Usersuser\&lt;username&gt;My DownloadsMSS-jboss-&lt;version&gt;&gt;binrun.bat -c all</pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Distributing requests between nodes</h5><p class="formalpara">Together with the application server nodes, it is advised to run a SIP load-balancer or an IP load-balancer.  The IP load balancer will distribute the traffic evenly between the nodes. A load-balancer is a single entry-point to all nodes. All calls should be made through the load balancer if  High Availability is required. For more information about load balancing, refer to  <a class="xref" href="#sslb-SIP_Servlets_Load_Balancer-Implementation" title="5.3.5. Implementation of the Mobicents Load Balancer">Section 5.3.5, “Implementation of the Mobicents Load Balancer”</a>.</p><p>By default, the servers are configured with one SIP load-balancer set to the  IP address <code class="literal">127.0.0.1</code>. This is specified in the <code class="literal">balancers</code> attribute in the <code class="filename">server.xml</code> configuration file as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.failover.SipStandardBalancerNodeService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">balancers</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;127.0.0.1&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">sipPathName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.ha&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">concurrencyControlMode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;None&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/mobicents-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Multiple load balancers can be specified and all of them will be updated on the health status of the node. The complete syntax for the balancers string is the following:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">balancers</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ipAddress1:sipPort1:rmiPort1;ipAddress2:sipPort2:rmiPort2;..3...4..&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If the RMI port is omitted port 2000 is assumed, and if the SIP port is omitted 5065 is assumed.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The SIP port  specified in the balancers string for each balancer refers to the internal SIP port of the SIP balancer. That is because the internal port faces the cluster nodes directly. Requests coming through the internal port will go to the external port and vice versa. If you put the external port in the <code class="literal">balancers</code> string, then the SIP LB will assume that the requests comes from outside the cluster and it will route it back to some cluster node instead of routing it outside the cluster as expected. Always use the SIP internal port in the <code class="literal">balancers</code> string. Exception to this rule is when a single port is used for internal and external ports in the SIP load balancer. In that case the direction analysis is done based on <code class="literal">Via</code> headers and the requests are routed correctly without extra settings.</p><p/></div><p>When multiple SIP load balancers are specified, the outgoing requests will always go through the first one, or an IP load balancer can be used and the requests will be distributed based on the IP balancer policy. To route the outgoing requests to a particular IP address (the IP load balancer address for example) the <code class="literal">outboundProxy</code> property can be used:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">balancers</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;127.0.0.1:5060:2000;127.0.0.1:5160:2100&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_attribute_name">outboundProxy</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;127.0.0.1:5500&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>In this example configuration all outbound requests will go through 127.0.0.1:5500, while the node will perform the health checks against two SIP load balancers. If the 127.0.0.1:5500 machine is an IP load balancer it should be configured to spray the  SIP load balancers and they will route the requests outside the cluster reliably.</p><p>The <code class="literal">outboundProxy</code> attribute overrides the default effect of specifying a SIP port for SIP load balancers in the <code class="literal">balancers</code> string.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Stopping"/>5.1.1.4. Stopping</h4></div></div></div><p>Individual nodes in the cluster should be stopped one-by-one, followed by the SIP load balancer. Refer to:</p><div class="itemizedlist"><ul><li><p>Stopping the SIP load balancer: <a class="xref" href="#sslb-binary-SIP_Load_Balancer-Stopping" title="5.3.7.7. Stopping">Section 5.3.7.7, “Stopping”</a>
     </p></li><li><p>Stopping MSS for JBoss: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Stopping" title="2.1.10. Stopping">Section 2.1.10, “Stopping”</a>
     </p></li><li><p>Stopping MSS for Tomcat: <a class="xref" href="#bssswticar-binary-SIP_Servlets_Server_with_Tomcat-Stopping" title="2.2.8. Stopping">Section 2.2.8, “Stopping”</a>
     </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Testing"/>5.1.1.5. Testing</h4></div></div></div><p>To test your JBoss cluster setup for mid-call failover (Established SIP Dialog), refer to:</p><div class="itemizedlist"><ul><li><p>
      <a class="xref" href="#ssfjfs-SS_for_JBoss-Failover_Support" title="5.2. Mobicents SIP Servlets for JBoss: Transparent Failover">Section 5.2, “Mobicents SIP Servlets for JBoss: Transparent Failover”</a>
     </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjcs-binary-SIP_Servlets_Server_Cluster-Uninstalling"/>5.1.1.6. Uninstalling</h4></div></div></div><p>Uninstalling a SIP Servlets Cluster would entail deleting the Mobicents SIP Servlets Servers directories, the SIP Load Balancer directory, and possibly removing the unused <code class="envar">JBOSS_HOME</code> environment variable.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ssfjfs-SS_for_JBoss-Failover_Support"/>5.2. Mobicents SIP Servlets for JBoss: Transparent Failover</h2></div></div></div><p>A Mobicents SIP Servlets Server for JBoss cluster does not employ any standby nodes. 
  Typically, therefore, proxies and registrars must share the user location table by using a database cluster.</p><p>The Mobicents SIP load balancer, which is a SIP Call ID-aware load balancer, is used as the intermediary. 
  The SIP load balancer forwards stateful transaction requests to cluster nodes based on its provisioning algorithm. 
  The SIP load balancer acts as an entry-point to the cluster and distributes the incoming requests between nodes. 
  It is always advised to use a SIP load balancer or an IP load balancer in a cluster configuration. </p><p>The SIP Stack used by the Mobicents SIP Servlets for JBoss supports <code class="literal">ESTABLISHED SIP DIALOG</code> failover. This means that failover will occur only on established calls (SIP Dialogs which are in the CONFIRMED state as per RFC 3261) and calls that are in the process of being setup will not be failed over (SIP Dialogs which are in the EARLY state as per RFC 3261).</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Testing a cluster</h5><p class="formalpara">This choice of implementation has many benefits:</p><div class="itemizedlist"><ul><li><p>There is no need for standby nodes, because the remaining nodes in a degraded cluster automatically and transparently (to the user) take on the load of the failed node. This can be done because both the SIP load balancer and SIP Servlet-enabled JBoss Application Servers support mid-call failover (Established SIP Dialog).</p></li><li><p>There is no need to ensure that requests are directed to the correct node, because in a SIP Servlets-enabled JBoss Application Server (or Mobicents JAIN SLEE server) cluster, any node can serve any request to any User Agent (UA).</p></li><li><p>All hardware is in use, reducing costs.</p></li><li><p>Maintenance is easier, due to all nodes having nearly-identical configurations.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover--Installing_Configuring_and_Running"/>5.2.1. MSS for JBoss Cluster: Installing, Configuring and Running</h3></div></div></div><p>There are a number of options you can specify for MSS clustering. By default most of them are configured in the "all" server configuration, which is ready to use. In this chapter we will cover the most common configuration options you might need.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Downloading"/>5.2.1.1. Downloading</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Installing"/>5.2.1.2. Installing</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Configuring"/>5.2.1.3. Configuring</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Running"/>5.2.1.4. Running</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Using"/>5.2.1.5. Using</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Testing"/>5.2.1.6. Testing</h4></div></div></div><p/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ssfjfs-binary-Testing_SS_for_JBoss_Cluster_Failover-Uninstalling"/>5.2.1.7. Uninstalling</h4></div></div></div><p/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sslb-MSS_Load_Balancer"/>5.3. Load Balancer</h2></div></div></div><div class="figure"><a id="d0e5781"/><div class="figure-contents"><div class="mediaobject"><a id="sslb-mss-MSSSIPLoadBalancer-dia-StarNetworkTopology"/><img src="images/mss-MSSSIPLoadBalancer-dia-StarNetworkTopology.jpg" alt="Star Cluster Topology."/></div></div><p class="title"><b>Figure 5.1. Star Cluster Topology.</b></p></div><br class="figure-break"/><p>The Mobicents SIP load balancer is used to balance the load of SIP service requests and responses between nodes in a SIP Servlets Server cluster. Both MSS for JBoss and MSS for Tomcat servers can be used in conjunction with the SIP load balancer to increase the performance and availability of SIP services and applications. </p><p>In terms of functionality, the Mobicents SIP load balancer is a simple stateless proxy server that intelligently forwards SIP session requests and responses between User Agents (UAs) on a Wide Area Network (WAN), and SIP Servlets Server nodes, which are almost always located on a Local Area Network (LAN). All SIP requests and responses pass through the SIP load balancer.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sslb-SIP_Load_Balancing_Basics"/>5.3.1. SIP Load Balancing Basics</h3></div></div></div><p>All User Agents send SIP messages, such as <code class="literal">INVITE</code> and  <code class="literal">MESSAGE</code>, to the same SIP URI (the IP address and port number of the SIP load balancer on the WAN). The load balancer then parses, alters, and forwards those messages to an available node in the cluster. If the message was sent as a part of an existing SIP session, it will be forwarded to the cluster node which processed that User Agent's original transaction request. </p><p>The SIP Servlets Server that  receives the message  acts upon it and sends a response back to the SIP load balancer. The SIP load balancer reparses, alters and forwards the message back to the original User Agent. This entire proxying and provisioning process is carried out independent of  the User Agent, which is only concerned with the SIP service or application it is using.</p><p>By using the load balancer, SIP traffic is balanced across a pool of available SIP Servlets Servers, increasing the overall throughput of the SIP service or application running on either individual nodes of the cluster.  In the case of   MSS for JBoss's <code class="literal">&lt;/distributed&gt;</code> capabilities, load balancing advantages are applied across the entire cluster.</p><p>The SIP load balancer is also able to fail over requests mid-call from unavailable nodes to available ones, thus increasing the reliability of the SIP service or application.  The load balancer increases throughput and reliability by dynamically provisioning SIP service requests and responses across responsive nodes in a cluster.  This enables SIP applications to meet the real-time demand for SIP services.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5812"/>5.3.2. HTTP Load Balancing Basics</h3></div></div></div><p>In addition to the SIP load balancing, there are several options for coordinated or cooperative load balancing with other protocols such as HTTP. Typically, a JBoss Application Server will use apache HTTP server with mod_jk, mod_proxy, mod_cluster or similar extension installed as an HTTP load balancer. This apache-based load balancer will parse incoming HTTP requests and it will look for the session ID of those requests in order to ensure all requests from the same session arrive at the same application server. By default, this is done by examining the <code class="literal">jsessionid</code> HTTP cookie or GET parameter and looking for the   <code class="literal">jvmRoute</code> assigned to the session. The typical <code class="literal">jsessionid</code> value is of the form <code class="literal">&lt;sessionId&gt;.&lt;jvmRoute&gt;</code> (e.g. <code class="literal">mysessionid323424.node1</code> where <code class="literal">node1</code> is the <code class="literal">jvmRoute</code> component). The very first request for each new HTTP session do not have any session ID assigned, thus apache routes the request to a random application server node. When the node responds it assigns a session ID and <code class="literal">jvmRoute</code> to the response of the request in a HTTP cookie and this response goes back to the client through apache, which keeps track of which node owns which <code class="literal">jvmRoute</code>. Once, the very first request is served this way, the subsequent requests from this session will carry the assigned cookie and the apache load balancer will always route the requests to the node, which advertised itself as the <code class="literal">jvmRoute</code> owner.</p><p>Instead of using apache,  an  integrated HTTP load balancing is also available. The SIP load balancer has an HTTP port where you could direct all incoming HTTP requests. The integrated HTTP load balancer behaves exactly like apache by default, but this behaviour is extensible and can be overridden completely with the pluggable balancer algorithms. The integrated HTTP load balancer  is much easier to configure and generally requires no effort, because it reuses most SIP settings ans assumes reasonable default values.</p><p>Unlike the native apache, the integrated HTTP load balancer is written completely in Java, thus a performance penalty should be expected when using it. However, the integrated HTTP balancer has an advantage when related SIP and HTTP requests must stick to the same node.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5851"/>5.3.3. Pluggable balancer algorithms</h3></div></div></div><p>The SIP/HTTP load balancer exposes an interface to allow users to customize the routing decision making for special purposes. By default there are three built-in algorithms. Only one algorithm is active at any time and it is specified with the <code class="literal">algorithmClass</code> property in the configuration file.</p><p>It is completely up to the algorithm how and whether to support distributed architecture or how to store the information needed for session affinity. The algorithms will be called for every SIP and HTTP request and other significant events to make more informed decisions.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Users must be aware that, bydefault requests explicitly addressed to a live server node passing through the load balancer will be forwarded directly to the server node. This allows for pre-specified routing use-cases, where the target node is known by the SIP client through other means. If the target node is dead, then the  node selection algorithm is used to route the request to an available node.</p></div>The following is a list o the built-in algorithms:<div class="variablelist"><dl><dt><span class="term">org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm </span></dt><dd><p>This algorithm is not distributable. It selects nodes randomly to serve a give Call-ID extracted from the requests and responses. It keeps a map with  <code class="literal">Call-ID -&gt; nodeId</code> associations and this map is not shared with other load balancers which will cause them to make different decisions. For HTTP it behaves like apache.</p></dd><dt><a id="sslb-binary-SIP_Load_Balancer-Configuration_Properties_File_1"/><span class="term">org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm </span></dt><dd><p>This algorithm is distributable and can be used in distributed load balancer configurations. It extracts the hash value of specific headers from SIP and HTTP messages to decide which application server node will handle the request. Information about the options in this algorithms is available in the balancer configuration file comments.</p></dd><dt><a id="sslb-binary-SIP_Load_Balancer-Configuration_Properties_File_2"/><span class="term">org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm </span></dt><dd><p>This algorithm is distributable and is similar to the previous algorithm, but it attempts to keep session affinity even when the cluster nodes are removed or added, which would normally cause hash values to point to different nodes.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5888"/>5.3.4. Distributed load balancing</h3></div></div></div><p>When the capacity of a single load balancer is exceeded, multiple load balancers can be used. With the help of an IP load balancer the traffic can be distributed between all SIP/HTTP load balancers based on some IP rules or round-robin. With consistent hash and <code class="literal">jvmRoute</code>-based balancer algorithms it doesn't matter which SIP/HTTP load balancer will process the request, because they would all make the same decisions based on information in the requests (headers, parameters or cookies) and the list of available nodes. With consistent hash algorithms there is no state to be preserved in the SIP/HTTP balancers.</p><div class="figure"><a id="d0e5896"/><div class="figure-contents"><div class="mediaobject"><a id="sslb-mss-MSSSIPLoadBalancer-dia-StarNetworkTopology_2"/><img src="images/bidirectional-distributed-sip-lb.gif" alt="Example deployment scenario with IP load balancers serving both directions for incoming and outgoing requests in a cluster"/></div></div><p class="title"><b>Figure 5.2. Example deployment scenario with IP load balancers serving both directions for incoming and outgoing requests in a cluster</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sslb-SIP_Servlets_Load_Balancer-Implementation"/>5.3.5. Implementation of the Mobicents Load Balancer</h3></div></div></div><p>Each individual Mobicents SIP Servlets Server in the cluster is responsible for contacting the SIP load balancer and relaying its health status and regular "heartbeats".  </p><p>From these health status reports and heartbeats, the SIP load balancer creates and maintains a list of all available and healthy nodes in the cluster. The load balancer forwards SIP requests between these cluster nodes,  providing that the provisioning algorithm reports that each node is healthy and is still sending heartbeats. </p><p>If an abnormality is detected, the  SIP load balancer removes the unhealthy or unresponsive node from the  list of available nodes. In addition, mid-session and mid-call messages are failed over to a healthy node. </p><p>For more information about this aspect of the load balancer,  refer to <a class="xref" href="#ssfjfs-SS_for_JBoss-Failover_Support" title="5.2. Mobicents SIP Servlets for JBoss: Transparent Failover">Section 5.2, “Mobicents SIP Servlets for JBoss: Transparent Failover”</a>.</p><p>The SIP load balancer first receives SIP requests from endpoints on a port that is specified in its Configuration Properties configuration file. The SIP load balancer, using a round-robin algorithm, then selects a node to which it forwards the SIP requests. The load balancer  forwards all same-session requests to the first node selected to initiate the session, providing that the  node is healthy and available.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5918"/>5.3.6. SIP Message Flow</h3></div></div></div><p>The Mobicents SIP load balancer appends  itself to the <code class="literal">Via</code> header of each request, so that returned responses are sent to the SIP Balancer before they are sent to the originating endpoint. </p><p>The load balancer also adds itself to the path of subsequent requests by adding Record-Route headers. It can subsequently handle mid-call failover by forwarding  requests to a different node in the cluster if the node that  originally handled the request   fails or becomes unavailable. The SIP load balancer  immediately fails over if it receives and unhealthy status, or irregular  heartbeats from a node.</p><p>The SIP Servlets Server extends the <code class="literal">SipStandardService</code> class, which extends the Tomcat <code class="literal">StandardService</code> class.  The <code class="literal">StandardService</code> class is responsible for  implementing  the Tomcat <code class="literal">Service</code> interface. </p><p>In  Tomcat architecture, a service is an intermediate component which resides inside a server,  and binds  one or more <code class="literal">Connectors</code> to exactly one <code class="literal">Engine</code>. When the service is started, the new <code class="literal">SipStandardBalancerNodeService</code> looks up its configuration information and obtains the SIP load balancer address.  The  heartbeat and health status is sent to the SIP load balancer address  to identify the service  as an available node of the cluster.</p><p>The node parameters are configurable through their <code class="literal">MBean</code> interfaces; information on their configuration is provided in the following sections.</p><p>In advanced configurations, it is possible to run more than one SIP load balancer.</p><p><a class="xref" href="#figure-mss-Basic_IP_and_Port_Cluster_Configuration" title="Figure 5.3. Basic IP and Port Cluster Configuration">Figure 5.3, “Basic IP and Port Cluster Configuration”</a> describes a basic  IP and Port Cluster Configuration.  In the diagram, the SIP load balancer is the server with the IP address of <code class="literal">192.168.1.1</code>.</p><div class="figure"><a id="figure-mss-Basic_IP_and_Port_Cluster_Configuration"/><div class="figure-contents"><div class="mediaobject" align="center"><a id="sslb-mss-MSSSIPLoadBalancer-dia-ClusterIPsAndPorts"/><img src="images/mss-MSSSIPLoadBalancer-dia-ClusterIPsAndPorts.jpg" align="middle" alt="Basic IP and Port Cluster Configuration"/></div></div><p class="title"><b>Figure 5.3. Basic IP and Port Cluster Configuration</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sslb-binary-SIP_Load_Balancer-Installing_Configuring_and_Running"/>5.3.7. SIP Load Balancer: Installing, Configuring and Running</h3></div></div></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-PreInstall_Requirements_and_Prerequisites"/>5.3.7.1. Pre-Install Requirements and Prerequisites</h4></div></div></div><p/><div class="variablelist"><a id="sslb-binary-SIP_Load_Balancer-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">A SIP Servlet-Enabled JBoss Application Server or Tomcat Servlet Container</span></dt><dd><p>Running the SIP load balancer requires at least two SIP Servlets Servers as client nodes.  Therefore, before configuring the SIP load balancer, we should make sure we've installed a SIP Servlets Server first. The Mobicents SIP load balancer will work with a SIP Servlets-enabled JBoss Application Server <span class="emphasis"><em>or</em></span> a SIP Servlets-enabled Tomcat Container.</p><p>However, if you intend to cluster multiple nodes for performance, reliability and failover purposes, then you will want to install and set up SIP Servlets-enabled JBoss AS nodes, because only they can be clustered, and not SIP-Servlet Tomcat Containers.</p><div class="itemizedlist"><ul><li><p>To install a SIP Servlet-enabled JBoss Application Server, follow the instructions here: <a class="xref" href="#bssswjicar-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running" title="2.1. SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running">Section 2.1, “SIP Servlet-Enabled JBoss Application Server: Installing, Configuring and Running”</a>.</p></li><li><p>To install a SIP Servlet-enabled Tomcat Servlet Container, follow these instructions: <a class="xref" href="#bssswticar-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running" title="2.2. SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running">Section 2.2, “SIP Servlet-Enabled Tomcat Servlet Container: Installing, Configuring and Running”</a>.</p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Downloading"/>5.3.7.2. Downloading</h4></div></div></div><p>The load balancer is located in the <code class="filename">sip-balancer</code> top-level directory of the MSS distribution. You will find the following files in the directory:</p><div class="variablelist"><dl><dt><span class="term">SIP load balancer executable JAR file</span></dt><dd><p>This is the binary file with all dependencies</p></dd><dt><a id="sslb-binary-SIP_Load_Balancer-Configuration_Properties_File"/><span class="term">SIP load balancer Configuration Properties file</span></dt><dd><p>This is the properties files with various settings</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Installing"/>5.3.7.3. Installing</h4></div></div></div><p>The SIP load balancer executable JAR file can be placed anywhere in the file system.  It is recommended that the file is placed in the directory containing other JAR executables, so it can be easily located in the future.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Configuring"/>5.3.7.4. Configuring</h4></div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Configuring"/>5.3.7.4. Configuring</h4></div></div></div><p>Configuring the SIP load balancer and the two SIP Servlets-enabled Server nodes is described in <a class="xref" href="#sslb-Configuring_the_SIP_Load_Balancer_and_Servlet_Server_Nodes" title="Procedure 5.1. Configuring the Mobicents SIP Load Balancer and Servlet Server Nodes">Configuring the Mobicents SIP Load Balancer and Servlet Server Nodes</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sslb-Configuring_the_SIP_Load_Balancer_and_Servlet_Server_Nodes"/><p class="title"><b>Procedure 5.1. Configuring the Mobicents SIP Load Balancer and Servlet Server Nodes</b></p><ol class="1"><li><p class="title"><b>Configure lb.properties Configuration Properties File</b></p><p>Configure the SIP load balancer's Configuration Properties file by substituting valid values for your personal setup.  <a class="xref" href="#sslb-Complete_Sample_lb.properties_File" title="Example 5.1. Complete Sample lb.properties File">Example 5.1, “Complete Sample lb.properties File”</a>  shows a sample <code class="filename">lb.properties</code> file, with key element descriptions provided after the example. The lines beginning with the pound sign are comments.</p><div class="example"><a id="sslb-Complete_Sample_lb.properties_File"/><p class="title"><b>Example 5.1. Complete Sample lb.properties File</b></p><div class="example-contents"><pre class="programlisting">
# Mobicents Load Balancer Settings
# For an overview of the Mobicents Load Balancer visit http://docs.google.com/present/view?id=dc5jp5vx_89cxdvtxcm

# The binding address of the load balancer
host=127.0.0.1

# The RMI port used for heartbeat signals
rmiRegistryPort=2000

# The SIP port used where client should connect
externalPort=5060
 
# The SIP port from where servers will receive messages
# delete if you want to use only one port for both inbound and outbound)
# if you like to activate the integrated HTTP load balancer, this is the entry point
internalPort=5065
 
# The HTTP port for HTTP forwarding
httpPort=2080

#Specify UDP or TCP (for now both must be the same)
internalTransport=UDP
externalTransport=UDP

# If you are using IP load balancer, put the IP address and port here
#externalIpLoadBalancerAddress=127.0.0.1
#externalIpLoadBalancerPort=111
 
# Requests initited from the App Servers can route to this address (if you are using 2 IP load balancers for bidirectional SIP LB)
#internalIpLoadBalancerAddress=127.0.0.1
#internalIpLoadBalancerPort=111

# Designate extra IP addresses as serer nodes
#extraServerNodes=222.221.21.12:21,45.6.6.7:9003,33.5.6.7,33.9.9.2

# Call-ID affinity algortihm settings. This algorithm is the default. No need to uncomment it.
#algorithmClass=org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm
# This property specifies how much time to keep an association before being evitcted.
# It is needed to avoid memory leaks on dead calls. The time is in seconds.
#callIdAffinityMaxTimeInCache=500

# Uncomment to enable the consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set, cna be "from.user" or "to.user" when you want the SIP URI username
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession
 
# Uncomment to enable the persistent consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession
 
#This is the JBoss Cache 3.1 configuration file (with jgroups), if not specified it will use default
#persistentConsistentHashCacheConfiguration=/home/config.xml
 
# Call-ID affinity algortihm settings. This algorithm is the default. No need to uncomment it.
#algorithmClass=org.mobicents.tools.sip.balancer.CallIDAffinityBalancerAlgorithm
# This property specifies how much time to keep an association before being evitcted.
# It is needed to avoid memory leaks on dead calls. The time is in seconds.
#callIdAffinityMaxTimeInCache=500

# Uncomment to enable the consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.HeaderConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set, cna be "from.user" or "to.user" when you want the SIP URI username
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession

# Uncomment to enable the persistent consistent hash based on Call-ID algorithm.
#algorithmClass=org.mobicents.tools.sip.balancer.PersistentConsistentHashBalancerAlgorithm
# This property is not required, it defaults to Call-ID if not set
#sipHeaderAffinityKey=Call-ID
#specify the GET HTTP parameter to be used as hash key
#httpAffinityKey=appsession
 
#This is the JBoss Cache 3.1 configuration file (with jgroups), if not specified it will use default
#persistentConsistentHashCacheConfiguration=/home/config.xml

#Adjusting the heatbeat. The hearbeat must be specified together with the individual server JAIN SIP property org.mobicents.ha.javax.sip.HEARTBEAT_INTERVAL
#If a node doesnt check in within that time (in ms), it is considered dead
nodeTimeout=5100
#The consistency of the above condition is checked every heartbeatInterval milliseconds
heartbeatInterval=150


#JSIP stack configuration.....
javax.sip.STACK_NAME = SipBalancerForwarder
javax.sip.AUTOMATIC_DIALOG_SUPPORT = off
// You need 16 for logging traces. 32 for debug + traces.
// Your code will limp at 32 but it is best for debugging.
gov.nist.javax.sip.TRACE_LEVEL = 32
gov.nist.javax.sip.DEBUG_LOG = logs/sipbalancerforwarderdebug.txt
gov.nist.javax.sip.SERVER_LOG = logs/sipbalancerforwarder.xml
gov.nist.javax.sip.THREAD_POOL_SIZE = 64
gov.nist.javax.sip.REENTRANT_LISTENER = true

            </pre></div></div><br class="example-break"/><div class="variablelist"><dl><dt><span class="term">host</span></dt><dd><p>Local IP address, or interface, on which the SIP load balancer will listen for incoming requests.</p></dd><dt><span class="term">externalPort</span></dt><dd><p>Port on which the SIP load balancer listens for incoming requests from SIP User Agents.</p></dd><dt><span class="term">internalPort</span></dt><dd><p>Port on which the SIP load balancer forwards incoming requests to available, and healthy, SIP Servlets Server cluster nodes.</p></dd><dt><span class="term">rmiRegistryPort</span></dt><dd><p>Port on which the SIP load balancer will establish the RMI heartbeat connection to the application servers. When this connection fails or a disconnection instruction is received, an application server node is removed and handling of requests continues without it by redirecting the load to the lie nodes.</p></dd><dt><span class="term">httpPort</span></dt><dd><p>Port on which the SIP load balancer will accept HTTP requests to be distributed across the nodes.</p></dd><dt><span class="term"> internalTransport</span></dt><dd><p>Transport protocol for the internal SIP connections associated with the internal SIP port of the load balancer. Possible choices are <code class="literal">UDP</code>, <code class="literal">TCP</code> and <code class="literal">TLS</code>.</p></dd><dt><span class="term"> externalTransport</span></dt><dd><p>Transport protocol for the external SIP connections associated with the external SIP port of the load balancer. Possible choices are <code class="literal">UDP</code>, <code class="literal">TCP</code> and <code class="literal">TLS</code>. It must match the transport of the internal port.</p></dd><dt><span class="term">externalIpLoadBalancerAddress</span></dt><dd><p>Address of the IP load balancer (if any) used for incoming requests to be distributed in the direction of the application server nodes. This address may be used by the SIP load balancer to be put in SIP headers where the external address of the SIP load balancer is needed.</p></dd><dt><span class="term">externalIpLoadBalancerPort</span></dt><dd><p>The port of the external IP load balancer. Any messages arriving at this port should be distributed across the external SIP ports of a set of   SIP load balancers.</p></dd><dt><span class="term">internalIpLoadBalancerAddresst</span></dt><dd><p>Address of the IP load balancer (if any) used for outgoing requests (requests initiated from the servers) to be distributed in the direction of the clients. This address may be used by the SIP load balancer to be put in SIP headers where the internal address of the SIP load balancer is needed.</p></dd><dt><span class="term">internalIpLoadBalancerPort</span></dt><dd><p>The port of the internal IP load balancer. Any messages arriving at this port should be distributed across the internal SIP ports of a set of   SIP load balancers.</p></dd><dt><span class="term">extraServerNodes</span></dt><dd><p>Comma-separated list of hosts that are server nodes. You can put here alternative names of the application servers here and they will be recognized. Names are important, because they might be used for direction-analysis. Requests coming from these server will go in the direction of the clients and will not be routed back to the cluster.</p></dd><dt><span class="term">algorithmClass</span></dt><dd><p>The fully-qualified Java class name of the balancing algorithm to be used. There are three algorithms to choose from and you can write your own to implement more complex routing behaviour. Refer to the sample configuration file for details about the available options for each algorithm. Each algorithm can have algorithm-specific properties for fine-grained configuration.</p></dd><dt><span class="term">nodeTimeout</span></dt><dd><p>In milliseonds. Default value is 5100. If a server node doesnt check in within this time (in ms), it is considered dead.</p></dd><dt><span class="term">heartbeatInterval</span></dt><dd><p>In milliseconds. Default value is 150 milliseonds. The hearbeat interval  must be much smaller than the interval specified  in the   JAIN SIP property on the server machines - <code class="literal">org.mobicents.ha.javax.sip.HEARTBEAT_INTERVAL</code></p></dd></dl></div><div class="note"><h2>Note</h2><p>The remaining keys and properties in the configuration properties file can be used to tune the JAIN SIP stack, but are not specifically required for load balancing.  To assist with tuning, a comprehensive list of implementing classes for the SIP Stack is available from the <a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/javax/sip/SipStack.html">Interface SIP Stack page on nist.gov</a>.  For a comprehensive list of properties associated with the SIP Stack implementation, refer to <a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/gov/nist/javax/sip/SipStackImpl.html">Class SipStackImpl page on nist.gov</a>.</p></div></li><li><p class="title"><b>Configure the <code class="filename">server.xml</code> configuration file</b></p><p>Ensure the following attributes are configured for the <code class="literal">&lt;service&gt;</code> element in <code class="filename">server.xml</code>.</p><div class="itemizedlist"><ul><li><p>The <code class="literal">className</code> attribute must have the value <code class="literal">org.mobicents.servlet.sip.startup.failover.SipStandardBalancerNodeService</code> instead of <code class="literal">org.mobicents.servlet.sip.startup.SipStandardService.</code></p></li><li><p>The <code class="literal">balancers</code> attribute must contain a IP address (or list of addresses) of the SIP load balancer(s) to which heartbeat information will be sent.</p></li><li><p>The <code class="literal">sipPathName</code> attribute must contain the following value <code class="literal">org.mobicents.ha</code> to indicate that the server will be using the Mobicents JAIN SIP HA SIP Stack which is an extension of the JAIN SIP Stack offering transparent replication.</p></li></ul></div></li></ol></div><p>the SIP load balancer uses <a class="ulink" href="http://java.sun.com/j2se/1.4.2/docs/guide/util/logging/overview.html">Java Logging as a logging mechanism</a>. As such you cna configure it through a property file and specify the property file to be used by using the following command <code class="literal">-Djava.util.logging.config.file=./lb-logging.properties</code>. Please refer to JDK logging for more informationon how to configure the Java logging.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Configuration File Locations</h2><p>On MSS for Tomcat server installations, <code class="filename">server.xml</code> is located in <code class="filename">&lt;install_directory&gt;/conf</code>.</p><p>On MSS for JBoss server installations, the default <code class="filename">server.xml</code> configuration file is located
         in <code class="filename">server/default/deploy/jboss-web.sar</code> (or <code class="filename">server/default/deploy/jboss-web.deployer</code> for JBoss Application Server 4.x and EAP 4.x).</p><p>On MSS for JBoss installations, with JBoss clustering support enabled, the "all" <code class="filename">server.xml</code> file must be configured.  It is located in <code class="filename">server/all/deploy/jboss-web.deployer</code>.</p><p>To determine what profile should be altered for each MSS for JBoss installation, refer to <a class="xref" href="#ssfjcs-SS_for_JBoss-Clustering_Support" title="5.1. Mobicents SIP Servlets for JBoss: Clustering Support">Section 5.1, “Mobicents SIP Servlets for JBoss: Clustering Support”</a>.</p></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Easy Node Configuration with JMX</h5><p class="formalpara">Both SIP Servlet-enabled JBoss and Tomcat have <acronym class="acronym">JMX</acronym> (Java Management Extensions) interfaces that allow for easy server configuration. The JMX Console is available once the server has been started by navigating to <a class="ulink" href="http://localhost:8080/jmx-console/">http://localhost:8080/jmx-console/</a>.  </p><p>Both the <code class="literal">balancers</code> and <code class="literal">heartBeatInterval</code> attribute values are available under <code class="literal">serviceName=jboss.web,type=Service</code> in the JMX Console.</p><div class="variablelist"><dl><dt><span class="term">balancers</span></dt><dd><p>Host names of the SIP load balancer(s) with corresponding <code class="literal">addBalancerAddress</code> and <code class="literal">removeBalancerAddress</code> methods.</p></dd><dt><span class="term">heartBeatInterval</span></dt><dd><p>Interval at which each heartbeat is sent to the SIP load balancer(s).</p></dd></dl></div><p> </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6307"/>5.3.7.4.1. Converged Load Balancing</h5></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6310"/>5.3.7.4.1.1. Apache HTTP load balancer</h6></div></div></div><p>The MSS SIP load balancer can work in concert  with HTTP load balancers such as  <code class="literal">mod_jk</code> and <code class="literal">mod_proxy</code> in two different ways. 
          By default whenever an HTTP session is bound to a particular node, an instruction is sent to the SIP load balancer to direct the SIP calls from the same application 
          session to the same node.</p><p>It is sufficient to configure <code class="literal">mod_jk</code> to work for HTTP in JBoss in order to enable cooperative load balancing. MSS will read the
           configuration and will use it without any extra configuration. You can read more about configuring <code class="literal">mod_jk</code> with JBoss in your JBoss Application Server 
           documentation.</p><p>Alternatively you may disable this behaviour and make the HTTP load balancer follow the decisions made by the SIP load balancer with the httpFollowsSip flag. This is 
          achieved by changing the jvmRoute part of the session ID cookie used internally by <code class="literal">mod_jk</code>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6334"/>5.3.7.4.1.1.1. The httpFollowsSip flag</h6></div></div></div><p>The <code class="literal">httpFollowsSip</code> flag in the service configuration makes the application server aware of how different mod_jk and SIP load balancers have assigned 
          request affinity for each application session. The application servers assign exactly one node to each Sip Servlets application session and this node is the node where the
           last SIP request associated with the application session has landed (decised by the SIP load balancer). Then the application server will actively update the session ID
            cookie (the jvmRoute part) of any HTTP request that arrives at 
          the wrong node. The application server will do so with a specially composed HTTP redirect response or with a HTML refresh hint. As a backup strategy, if the request is bound to seek
           non-existing node forever and it will let the request be served by a new node. This avoids having a client stuck reloading the same page over and over.</p><p>One problem with this flag is that if you have two or more SIP sessions associated with the same application session and the load balancer has decided to send SIP requests
           to different nodes, which might happend if you use Call-ID based affinity, then the application server will have to change the jvmRoute very often for every SIP request resulting
            in significant overhead. It is generally not adviced to enable this flag if you have more than 1 SIP session per application session and the means to guarantee all SIP sessions
            from the application session will land on the same node.</p><p>This is an example how to enable the option. It is disabled by default.</p><pre class="programlisting">&lt;Connector port="5080" 
     ipAddress = "${jboss.bind.address}"
     ...
     httpFollowsSip="true" /&gt;
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6348"/>5.3.7.4.1.2. Integrated HTTP load balancer</h6></div></div></div><p>To use the integrated HTTP load balancer, no extra configuration is needed. If a unique  <code class="literal">jvmRoute</code> is specified and enabled  in each application server, it will behave exactly as the apache balancer. If <code class="literal">jvmRoute</code> is not present it will use session ID as a hash value and attempt to create sticky session. The integrated balancer can be used together with the apache balancer at the same time.</p><p>In addition to the apache behaviour, there is a consistent hash balancer algorithm that can be enabled for both HTTP and SIP messages. For both HTTP and SIP messages, there is a configurable affinity key, which is evaluated and hashed against each unassigned request. All requests with the same hash value will always be routed to the same application server node. For example, the SIP affinity key could be the callee user name and the HTTP affinity key could the “<span class="quote">appsession</span>” HTTP GET parameter of the request. If the desired behaviour group these requests, we can just make sure the affinity values (user name and GET parameter) are the same.</p><div class="figure"><a id="d0e6364"/><div class="figure-contents"><div class="mediaobject"><a id="sslb-mss-MSSSIPLoadBalancer-dia-StarNetworkTopology_1"/><img src="images/converged-integrated-lb.png" alt="Ensuring SIP and HTTP requests are being grouped by common affinity value."/></div></div><p class="title"><b>Figure 5.4. Ensuring SIP and HTTP requests are being grouped by common affinity value.</b></p></div><br class="figure-break"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Running"/>5.3.7.5. Running</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="sslb-Running_the_SIP_Load_Balancer_and_Servlet_Server_Nodes"/><p class="title"><b>Procedure 5.2. Running the SIP Load Balancer and Servlet Server Nodes</b></p><ol class="1"><li><p class="title"><b>Start the SIP Load Balancer</b></p><p>Start the SIP load balancer, ensuring the Configuration Properties file (<code class="filename">lb.properties</code> in this example) is specified.  In the Linux terminal, or using the Windows Command Prompt, the SIP Load Balancer is started by issuing a command similar to this one:</p><pre class="screen">java -jar sip-balancer-1.0-20080829.103906-21-jar-with-dependencies.jar lb-configuration.properties</pre><p>Executing the SIP load balancer produces  output similar to the following example:</p><pre class="screen">home]$ java -jar sip-balancer-1.0-20080829.103906-21-jar-with-dependencies.jar lb-configuration.properties 
Oct 21, 2008 1:10:58 AM org.mobicents.tools.sip.balancer.SIPBalancerForwarder start
INFO: Sip Balancer started on address 127.0.0.1, external port : 5060, port : 5065
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node registry starting...
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node expiration task created
Oct 21, 2008 1:10:59 AM org.mobicents.tools.sip.balancer.NodeRegisterImpl startServer
INFO: Node registry started</pre><p>The output shows the IP address on which the SIP load balancer is listening, as well as the external and internal listener ports.</p></li><li><p class="title"><b>Configure SIP Servlet Server Nodes</b></p><p>SIP Servlets Server nodes can run on the JBoss Application Server, or the Tomcat Servlet Container.  The SIP Servlets Server binary distributions define the type of SIP Servlets Server nodes used, and should already be installed from <a class="xref" href="#sslb-binary-SIP_Load_Balancer-Software_Prerequisites" title="Software Prerequisites">Software Prerequisites</a>.</p><p>The <code class="filename">server.xml</code> file specifies the nodes used.  Because there is more then one client node specified, unique listener ports must be specified for each node to monitor HTTP and/or SIP connections.  <a class="xref" href="#sslb-Changing_the_SIP_Connector_Port_for_Servlet_Server_Nodes" title="Example 5.2. Changing the SIP Connector Port for Servlet Server Nodes in server.xml">Example 5.2, “Changing the SIP Connector Port for Servlet Server Nodes in server.xml”</a> describes the affected element in the <code class="filename">server.xml</code> file.</p><div class="note"><h2>Configuration File Location</h2><p>For the JBoss SIP Servlets Server binary distribution, <code class="filename">server.xml</code> is located in the  <code class="filename">&lt;install_directory&gt;/server/all/deploy/jboss-web.deployer/</code> directory (for JBoss Application Server 4.x or EAP 4.x <code class="filename">&lt;install_directory&gt;/server/all/deploy/jboss-web.deployer/</code>).  For the Tomcat binary distribution, <code class="filename">server.xml</code> is located in the <code class="filename">&lt;install_directory&gt;/conf/</code> directory.</p></div><div class="example"><a id="sslb-Changing_the_SIP_Connector_Port_for_Servlet_Server_Nodes"/><p class="title"><b>Example 5.2. Changing the SIP Connector Port for Servlet Server Nodes in server.xml</b></p><div class="example-contents"><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--&nbsp;Define&nbsp;a&nbsp;SIP&nbsp;Connector&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Connector</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">port</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5080&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/></li><li><p class="title"><b>Start Load Balancer Client Nodes</b></p><p>Start all SIP load balancer client nodes.</p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Testing"/>5.3.7.6. Testing</h4></div></div></div><p>To test load balancing, the same application must be deployed manually on each node.  Two SIP Softphones must be installed.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e6446"/><p class="title"><b>Procedure 5.3. Testing Load Balancing</b></p><ol class="1"><li><p class="title"><b>Deploy an Application</b></p><p>Ensure that for each node, the DAR file location is specified in the <code class="filename">server.xml</code> file.</p><p>Deploy the Location service manually on both nodes.</p></li><li><p class="title"><b>Start the "Sender" SIP softphone</b></p><p>Start a SIP softphone client with the SIP address of <strong class="userinput"><code>sip:sender@sip-servlets-com</code></strong>, listening on port 5055.  The outbound proxy must be specified as the sip-balancer (http://127.0.0.1:5060)</p></li><li><p class="title"><b>Start the "Receiver" SIP softphone</b></p><p>Start a SIP softphone client with the SIP address of <strong class="userinput"><code>sip:receiver-failover@sip-servlets-com</code></strong>, listening on port 5090.</p></li><li><p class="title"><b>Initiate two calls from "Sender" SIP softphone</b></p><p>Initiate one call from <strong class="userinput"><code>sip:sender@sip-servlets-com</code></strong> to <strong class="userinput"><code>sip:receiver-failover@sip-servlets-com</code></strong>.  Tear down the call once completed.</p><p>Initiate a second call using the same SIP address, and tear down the call once completed.  Notice that the call is handled by the second node.</p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Stopping"/>5.3.7.7. Stopping</h4></div></div></div><p>Assuming that you started the JBoss Application Server as a foreground process in the Linux terminal, the easiest way to stop it is by pressing the <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> key combination in the same terminal in which you started it.</p><p>This should produce similar output to the following:</p><pre class="screen">^COct 21, 2008 1:11:57 AM org.mobicents.tools.sip.balancer.SipBalancerShutdownHook run
INFO: Stopping the sip forwarder</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="sslb-binary-SIP_Load_Balancer-Uninstalling"/>5.3.7.8. Uninstalling</h4></div></div></div><p>To uninstall the SIP load balancer,  delete the JAR file you installed.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6508"/>5.3.8. IP Load Balancing</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6511"/>5.3.8.1. IP Load Balancers</h4></div></div></div><p>An IP load-balancer is a network appliance that distributes traffic to an application server (or actual servers) using a  load-balancing algorithm.  IP load-balancing is often used when the other load-balancers' capacity is exceeded and can not scale further without hardware upgrades.</p><p>Routing decisions are made  based on OSI Layer 2, 3 or 4 data. This type of load balancer only examines low-level TCP, UDP or ethernet packet structures including MAC addresses, IP addresses, ports, and protocol types (TCP or UDP or other). </p><p>An IP  load balancer never reads the payload of the TCP/IP packets and therefore never parses SIP or HTTP (or any protocol above OSI Layer 4).  Because an IP load balancing device is not SIP or HTTP aware in any way, it is much more performant than <code class="literal">mod_jk</code> or the MSS SIP load-balancer.

</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6523"/>5.3.8.2. Technical overview</h4></div></div></div><p>In its simplest form, the IP load-balancer usually "owns" the public-facing IP address (known as a VIP).   The traffic is routed to actual servers in it's private network similar to NAT. It is also possible to not change the IP address and just work on the MAC address by assuming that all actual  servers are configured to accept packets for the VIP address. The features offered by the IP load balancer depend largely on the vendor. </p><p>Some examples of  Linux-based  software load balancers include <a class="ulink" href="http://www.redhat.com/cluster_suite/">Red Hat Cluster Suite (RHCS)</a> and <a class="ulink" href="http://www.linuxvirtualserver.org/">Linux Virtual Server (LVS)</a>. There are many hardware vendors as well.</p><p>One main drawback relating to  IP load balancers is that they can not make routing decisions based on SIP messages and (with some exceptions) they can not work cooperatively with HTTP or other load balancers.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6540"/>5.3.8.3. Configuring MSS Cluster for pure IP Load Balancing</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Pure IP load balancing is not a recommented option. It is advised to use a distributed load balancer instead. Proper operation with pure IP load balancing depends on the ability of the IP load balancer to establish request affinity based on IP addresses and ports.</p></div></div><div class="section" lang="en-US"><div class="titlepage"/><p>First you need to remove the SIP load balancers from any configuration in MSS. In particular the <code class="literal">balancers</code> 
      attribute in <code class="filename">server.xml</code>.   and edit the jboss.web  engine tag. You should remove the balancers attribute from the Service tag of 
      jboss.web service. This simply removes the default load balancer from the system and the traffic bypasses the SIP load-balancer. Next you must configure
       MSS to put the IP load balancer IP address in the <code class="literal">Via</code>, <code class="literal">Contact</code> and other system headers where 
       the IP address of the server machine is required. This will ensure that any responses or subsequent SIP requests follow the same path, but always hit 
       the load balancer instead of particular cluster node that may fail.  To specify the IP load balancer address in MSS your should edit
        this file <code class="filename">JBOSS_HOME/server/all/deploy/jboss-web.deployer/server.xml</code> and specify <code class="literal">staticServerAddress</code> such as: </p><pre class="programlisting">&lt;Connector port="5080" 
     ipAddress = "${jboss.bind.address}"
     ...
staticServerAddress="122.122.122.122" staticServerPort="44" 
useStaticAddress="true"/&gt;
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Depending on your reliability requirements you can omit the configuration described in this section and let the servers use their own IP address in the SIP messages.</p></div></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="emom-Enterprise-Monitoring-Operations-Management"/>Chapter 6. Enterprise Monitoring and Management</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e6585">6.1. Mobicents SIP Servlets Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6592">6.1.1. Installation of the Enterprise Monitoring and Management Console</a></span></dt><dt><span class="section"><a href="#d0e6636">6.1.2. Usage Instructions</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6848">6.2. SIP Load Balancer Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6856">6.2.1. Installation of the Enterprise Monitoring and Management Console</a></span></dt><dt><span class="section"><a href="#d0e6888">6.2.2. Usage Instructions</a></span></dt></dl></dd></dl></div><p>Jopr is an enterprise management solution for JBoss middleware
  projects and other application technologies. This pluggable project provides
  administration, monitoring, alerting, operational control and configuration
  in an enterprise setting with fine-grained security and an advanced
  extension model.</p><p>It provides support for monitoring base operating system information
  on six operating systems as well as management of Apache, JBoss Application
  Server (JBoss AS) and other related projects. See the <a class="ulink" href="http://www.jboss.org/jopr">Jopr website</a> for more information or
  see the <a class="ulink" href="http://www.jboss.org/embjopr">Jopr embedded website</a></p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6585"/>6.1. Mobicents SIP Servlets Monitoring and Management</h2></div></div></div><p>This chapter provides information on how to enable the management of
    Mobicents SIP Servlets Servers through Jopr with our custom Jopr plug in.
    Two versions of Jopr are available: an  embedded version, which is 
    better suited to development environments; and a full version, which is better suited to
    production environments.</p><p>The Mobicents SIP Servlet Jopr plug in provides a facility to view
    metrics related to the deployed applications, metrics related to the SIP
    Servlets Server.  Additionally, the plugin provides the option to manage the various configuration settings of the
    SIP Servlets Server such as Congestion and Concurrency control.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6592"/>6.1.1. Installation of the Enterprise Monitoring and Management Console</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6595"/>6.1.1.1. Jopr for Development</h4></div></div></div><p>The Embedded Jopr (also known as the  JBoss Administration Console) is
         pre-installed as an application deployed in the Mobicents SIP
        Servlets Server.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6600"/>6.1.1.2. Jopr for Production</h4></div></div></div><div class="itemizedlist"><ul><li><p>Follow the <a class="ulink" href="http://jboss.org/community/docs/DOC-12828">Jopr installation instructions</a> to install the latest version of Jopr.</p></li><li><p>Stop the Jopr server and agent if they are running.</p></li><li><p>Get the Mobicents SIP Servlets Jopr Plug in from here :
            <a class="ulink" href="http://repository.jboss.com/maven2/org/mobicents/servlet/sip/jopr-mobicents-sip-servlets-plugin/1.3/jopr-mobicents-sip-servlets-plugin-1.3.jar">http://repository.jboss.com/maven2/org/mobicents/servlet/sip/jopr-mobicents-sip-servlets-plugin/1.3/jopr-mobicents-sip-servlets-plugin-1.3.jar</a></p></li><li><p>Copy the jopr-mobicents-sip-servlets-plugin-1.3.jar just
            downloaded to the
            <code class="filename">jopr-server/jbossas/server/default/deploy/rhq.ear/rhq-downloads/rhq-plugins/</code>
            directory</p></li><li><p>Start the Jopr server then the agent.</p></li><li><p>Start the  Mobicents SIP Servlets Server on JBoss, and ensure the binding address is specified </p><p>
            <strong class="userinput"><code>sh run.sh -b 192.168.0.10</code></strong> (the Server will
            not get recognized on localhost)</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6636"/>6.1.2. Usage Instructions</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="emom-Embedded-Jopr"/>6.1.2.1. Jopr for Development</h4></div></div></div><div class="itemizedlist"><ul><li><p>Log in to the Jopr console on <a class="ulink" href="http://localhost:8080/admin-console">http://localhost:8080/admin-console</a>
            and login as admin (user=admin, password=admin).</p></li><li><p>From the tree on the left side of the screen, under Services
            , click on <span class="guimenuitem"><strong>MobicentsSipServlets</strong></span> link, then click on the
            <span class="guimenuitem"><strong>jboss.web:type=SipApplicationDispatcher</strong></span> link to view the incoming metrics.</p><div class="figure"><a id="d0e6660"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-embjopr-home.png" alt="Mobicents SIP Servlets Server Metrics"/></div></div><p class="title"><b>Figure 6.1. Mobicents SIP Servlets Server Metrics</b></p></div><br class="figure-break"/></li><li><p>Click on the Configuration Tab to  tune the
            Congestion Controls parameters as defined in <a class="xref" href="#sscacc-MSS_Concurrency_and_Congestion_Control" title="7.2. Concurrency and Congestion Control">Section 7.2, “Concurrency and Congestion Control”</a></p><div class="figure"><a id="d0e6670"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-embjopr-config.png" alt="SIP Application Dispatcher Congestion Control Parameters Configuration"/></div></div><p class="title"><b>Figure 6.2. SIP Application Dispatcher Congestion Control Parameters Configuration</b></p></div><br class="figure-break"/></li><li><p>Click on the <span class="guilabel"><strong>Control Tab</strong></span> to  set the Concurrency
            Control Mode and Congestion Control Policy as defined in <a class="xref" href="#sscacc-MSS_Concurrency_and_Congestion_Control" title="7.2. Concurrency and Congestion Control">Section 7.2, “Concurrency and Congestion Control”</a></p><div class="figure"><a id="d0e6683"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-embjopr-control.png" alt="SIP Application Dispatcher Congestion Control Parameters Configuration"/></div></div><p class="title"><b>Figure 6.3. SIP Application Dispatcher Congestion Control Parameters Configuration</b></p></div><br class="figure-break"/></li><li><p>To begin metrics collection, and see them on the monitoring
            application, you must use an example application (such as
            location service) so that the SIP Servlets Server processes SIP
            Messages.</p><div class="figure"><a id="d0e6692"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-embjopr-metrics.png" alt="Selected Application Metrics"/></div></div><p class="title"><b>Figure 6.4. Selected Application Metrics</b></p></div><br class="figure-break"/></li><li><p>To see metrics for the  application, click on the 
            application under the Converged SIP/Web Application (SAR/WAR)
            link.</p><div class="figure"><a id="d0e6701"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-applications.png" alt="Specific Application Metrics"/></div></div><p class="title"><b>Figure 6.5. Specific Application Metrics</b></p></div><br class="figure-break"/></li><li><p>Select the <span class="guilabel"><strong>Metrics</strong></span> tab to actually see the metrics for the  application.</p><div class="figure"><a id="d0e6713"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-embjopr-session-metrics.png" alt="Specific Application Metrics Detail"/></div></div><p class="title"><b>Figure 6.6. Specific Application Metrics Detail</b></p></div><br class="figure-break"/></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="emom-Jopr4Production"/>6.1.2.2. Jopr For Production</h4></div></div></div><div class="itemizedlist"><ul><li><p>Log in to the Jopr console on <a class="ulink" href="http://localhost:7080/">http://localhost:7080</a> </p><p>From the <span class="guilabel"><strong>Dashboard</strong></span> tab, in the Auto Discovery portlet, import your
            server (for example, deruelle-laptop JBossAS 4.2.3.GA default
            (192.168.0.12:1099)) from under localhost.</p><div class="figure"><a id="d0e6735"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-auto-disc.png" alt="Server Import for Monitoring"/></div></div><p class="title"><b>Figure 6.7. Server Import for Monitoring</b></p></div><br class="figure-break"/></li><li><p>From the Dashboard, in the Recently Added Resources
            portlet, click on the server.</p><div class="figure"><a id="d0e6744"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-resources.png" alt="Selecting the Server for Monitoring"/></div></div><p class="title"><b>Figure 6.8. Selecting the Server for Monitoring</b></p></div><br class="figure-break"/></li><li><p>On the new Monitor view click on the JBossWeb Server
            link.</p><div class="figure"><a id="d0e6753"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-monitor.png" alt="Servlet Container Monitoring"/></div></div><p class="title"><b>Figure 6.9. Servlet Container Monitoring</b></p></div><br class="figure-break"/></li><li><p>Click on the <span class="guimenuitem"><strong>jboss.web:type=SipApplicationDispatcher</strong></span> link to view the incoming metrics.</p><div class="figure"><a id="d0e6765"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-jboss-web.png" alt="Mobicents SIP Servlets Server Metrics"/></div></div><p class="title"><b>Figure 6.10. Mobicents SIP Servlets Server Metrics</b></p></div><br class="figure-break"/></li><li><p>Click on the <span class="guilabel"><strong>Configuration</strong></span> tab to  tune the
            Container configuration parameters such as Concurrency and Congestion as defined in <a class="xref" href="#sscacc-MSS_Concurrency_and_Congestion_Control" title="7.2. Concurrency and Congestion Control">Section 7.2, “Concurrency and Congestion Control”</a></p><div class="figure"><a id="d0e6778"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-queue.png" alt="SIP Application Dispatcher Configuration"/></div></div><p class="title"><b>Figure 6.11. SIP Application Dispatcher Configuration</b></p></div><br class="figure-break"/></li><li><p>Click on the Control Tab to be able to set the Concurrency
            Control Mode and Congestion Control Policy as defined in <a class="xref" href="#sscacc-MSS_Concurrency_and_Congestion_Control" title="7.2. Concurrency and Congestion Control">Section 7.2, “Concurrency and Congestion Control”</a></p><div class="figure"><a id="d0e6788"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-concurrency.png" alt="SIP Application Dispatcher Congestion Control Parameters Configuration"/></div></div><p class="title"><b>Figure 6.12. SIP Application Dispatcher Congestion Control Parameters Configuration</b></p></div><br class="figure-break"/></li><li><p>To begin metrics collection, and see them on the monitoring
            application, you must use an example application (such as
            location service) so that the SIP Servlets Server processes SIP
            Messages.</p><div class="figure"><a id="d0e6797"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-metrics.png" alt="Selected Application Metrics"/></div></div><p class="title"><b>Figure 6.13. Selected Application Metrics</b></p></div><br class="figure-break"/></li><li><p>To see Metrics about your application, click on the
            Converged SIP/Web Application (SAR/WAR) link.</p><div class="figure"><a id="d0e6806"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-sip-apps.png" alt="Specific Application Metrics"/></div></div><p class="title"><b>Figure 6.14. Specific Application Metrics</b></p></div><br class="figure-break"/></li><li><p>Click on the application to actually see the metrics for the application.</p><div class="figure"><a id="d0e6815"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-applications.png" alt="Specific Application Metrics Detail"/></div></div><p class="title"><b>Figure 6.15. Specific Application Metrics Detail</b></p></div><br class="figure-break"/></li><li><p>Click on the <span class="guilabel"><strong>Configure</strong></span> link for the <span class="guilabel"><strong>Monitor</strong></span>
            tab to select the metric data to view.</p><div class="figure"><a id="d0e6830"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-configure-metrics.png" alt="Selecting Application Metrics"/></div></div><p class="title"><b>Figure 6.16. Selecting Application Metrics</b></p></div><br class="figure-break"/></li><li><p>Select the <span class="guilabel"><strong>MetaData</strong></span> tab to  see the metrics
            of your application.</p><div class="figure"><a id="d0e6842"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-session-metrics.png" alt="Selected Application Metrics Detail"/></div></div><p class="title"><b>Figure 6.17. Selected Application Metrics Detail</b></p></div><br class="figure-break"/></li></ul></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6848"/>6.2. SIP Load Balancer Monitoring and Management</h2></div></div></div><p>This documentation provides information on how to enable the
    management of Mobicents SIP Load Balancer through Jopr with our custom SIP
    Load Balancer Jopr plug in.</p><p>With the Mobicents SIP Load Balancer Jopr plug in, you can currently
    see metrics, configure and manage the Mobicents SIP Load Balancer.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6856"/>6.2.1. Installation of the Enterprise Monitoring and Management Console</h3></div></div></div><div class="itemizedlist"><ul><li><p>Follow the <a class="ulink" href="http://jboss.org/community/docs/DOC-12828">Jopr installation instructions</a> to install the latest version of Jopr.</p></li><li><p>Stop the Jopr server and agent if they are running.</p></li><li><p>Get the Mobicents SIP Load Balancer Jopr Plug in from JBoss
          maven repository at <a class="ulink" href="http://repository.jboss.org/maven2/org/mobicents/tools/sip-balancer-jopr-plugin/1.0/sip-balancer-jopr-plugin-1.0.jar">http://repository.jboss.org/maven2/org/mobicents/tools/sip-balancer-jopr-plugin/1.0/sip-balancer-jopr-plugin-1.0.jar</a></p></li><li><p>Copy the Mobicents SIP Load Balancer Jopr Plug in jar to the
          following directory:</p><p><code class="filename">jopr-server/jbossas/server/default/deploy/rhq.ear/rhq-downloads/rhq-plugins/</code></p></li><li><p>Start the Jopr server then the agent.</p></li><li><p>Start your Mobicents SIP Load Balancer as explained here (and
          one node that connect to it to see it appear in the list of
          nodes).</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6888"/>6.2.2. Usage Instructions</h3></div></div></div><div class="itemizedlist"><ul><li><p>Log in to the Jopr console from the <span class="guilabel"><strong>Dashboard</strong></span> tab, in
          the Auto Discovery portlet and import your Mobicents SIP Load Balancer
          (by example Mobicents SIP Load Balancer 1.0-SNAPSHOT) from under
          localhost.</p><div class="figure"><a id="d0e6899"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-dashboard.png"/></div></div><p class="title"><b>Figure 6.18. </b></p></div><br class="figure-break"/></li><li><p>From the Dashboard, in the Recently Added Resources
          portlet, click on the Mobicents SIP Load Balancer.</p><div class="figure"><a id="d0e6908"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-dash-added.png"/></div></div><p class="title"><b>Figure 6.19. </b></p></div><br class="figure-break"/></li><li><p>In the new Monitor view, click on the
          <span class="guimenuitem"><strong>mobicents:name=LoadBalancer,type=LoadBalancer</strong></span> link.</p><div class="figure"><a id="d0e6919"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-monitor.png"/></div></div><p class="title"><b>Figure 6.20. </b></p></div><br class="figure-break"/></li><li><p>You can now see the metrics coming in.</p><div class="figure"><a id="d0e6927"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-metrics.png"/></div></div><p class="title"><b>Figure 6.21. </b></p></div><br class="figure-break"/></li><li><p>To configure the Load Balancer and see the list of nodes in
          the cluster it is connected to, click on the <span class="guilabel"><strong>Configure</strong></span> tab.</p><div class="figure"><a id="d0e6938"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-config.png"/></div></div><p class="title"><b>Figure 6.22. </b></p></div><br class="figure-break"/></li><li><p>To start and stop the Load Balancer, click on the <span class="guilabel"><strong>Operations</strong></span>
          tab.</p><div class="figure"><a id="d0e6949"/><div class="figure-contents"><div class="mediaobject"><img src="images/mss-jopr-lb-ops.png"/></div></div><p class="title"><b>Figure 6.23. </b></p></div><br class="figure-break"/></li></ul></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="afotsss-Advanced_Features_of_the_SIP_Servlets_Server"/>Chapter 7. Advanced Features of the SIP Servlets Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#mipbx-Media_Support">7.1. Media Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6967">7.1.1. JSR 309 : Media Server Control API</a></span></dt></dl></dd><dt><span class="section"><a href="#sscacc-MSS_Concurrency_and_Congestion_Control">7.2. Concurrency and Congestion Control</a></span></dt><dt><span class="section"><a href="#sss-SIP_Servlet_Security">7.3. SIP Servlets Application Security</a></span></dt><dt><span class="section"><a href="#mssstun-MSS_STUN">7.4. STUN Support</a></span></dt><dt><span class="section"><a href="#stf-Seam_Telco_Framework">7.5. Seam Telco Framework</a></span></dt><dt><span class="section"><a href="#ssds-Diameter_Support">7.6. Diameter Support</a></span></dt><dt><span class="section"><a href="#saimse-SIP_and_IMS_Extensions">7.7. SIP and IMS Extensions</a></span></dt><dt><span class="section"><a href="#jruby-telco-integration">7.8. JRuby/Rails Integration with Torquebox Telco Framework</a></span></dt><dt><span class="section"><a href="#ss_jslee_interop">7.9. SIP Servlets - JAIN SLEE Interoperability</a></span></dt><dt><span class="section"><a href="#d0e8266">7.10. Eclipse IDE Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8276">7.10.1. Pre-Install requirements</a></span></dt><dt><span class="section"><a href="#d0e8281">7.10.2. Installation</a></span></dt><dt><span class="section"><a href="#d0e8292">7.10.3. SIP Servlets Core Plug-in</a></span></dt><dt><span class="section"><a href="#d0e8300">7.10.4. SIP Phone Plug-in</a></span></dt></dl></dd></dl></div><p>The advanced features of Mobicents SIP Servlets include Concurrency and 
Congestion Control, Load Balancing with the Mobicents Load Balancer, and, exclusively for MSS for JBoss, clustering and failover support.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mipbx-Media_Support"/>7.1. Media Support</h2></div></div></div><p>Mobicents SIP Servlets by implementing the SIP Servlets 1.1
  specification is providing natively support for applications to setup calls
  through SIP Support.</p><p>But since most Telco services have the need for managing and
  controlling media, by example to play announcements, mixing calls, recognize
  DTMF, ... Mobicents SIP Servlets allows applications to control media through JSR 309.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6967"/>7.1.1. JSR 309 : Media Server Control API</h3></div></div></div><p>This Specification is a protocol agnostic API for Media Server
    Control. It provides a portable interface to create media rich
    applications with IVR, Conferencing, Speech Recognition, and similar
    features.</p><p>Mobicents Media Server provides an implementation of the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=309">JSR 309 specification</a> using the MGCP protocol to
    allow controlling any Media Server (located in the same Virtual Machine or
    on a remote server) supporting MGCP.</p><p>The following examples demonstrate its usage :</p><div class="itemizedlist"><ul><li><p><a class="ulink" href="http://www.mobicents.org/mss-jsr309-demo.html">Media Example</a> : a SIP Servlet application showing how to use media
        capabilities (Media playback, Recording, Text to Speech with FreeTTS and DTMF detection).</p></li><li><p><a class="ulink" href="http://www.mobicents.org/conference-demo-jsr309.html">Conference Demo</a> : a Conference Media Server demo application built on GWT
        with server-push updates.</p></li><li><p><a class="ulink" href="http://www.mobicents.org/shopping-demo-jsr309.html">Shopping Example</a> : a Converged JEE Application showing SEAM
        integration, JEE, Media integration with TTS and DTMF support.</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sscacc-MSS_Concurrency_and_Congestion_Control"/>7.2. Concurrency and Congestion Control</h2></div></div></div><p>Concurrency and Congestion control refer to settings  that
  define the way in which messages are processed under heavy load.  The way Mobicents SIP Servlets Server processes messages in a production environment is crucial to ensure quality of service for customers. </p><p>Concurrency control mode tuning affects  the way in which
  the SIP Servlets Server processes messages, whereas Congestion Control tuning affects the point at which   the server
  begins rejecting new requests. Both of these parameters can be set using the following methods: </p><div class="itemizedlist"><ul><li><p>through the SIP Servlets Management Console.</p></li><li><p>editing
  the server's <code class="filename">server.xml</code> configuration file.</p></li><li><p>from the
  <code class="literal">dispatcher</code> MBean.</p></li><li><p>from the Embedded Jopr integrated
  management platform.</p></li></ul></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Concurrency Control</h5><p class="formalpara">The JSR 289 expert group does not specify how concurrency control should be implemented.  </p><p>Mobicents SIP Servlets for JBoss and Mobicents SIP Servlets for Tomcat have concurrency control implemented as
    a configurable mode, which defines the way in which the SIP Servlets Server processes messages.</p><p>It has to be noted that this concurrency control mechanism is not cluster aware and will work per node only, it is not a cluster wide lock.</p><p>The following modes are provided, and cater for the particular setup required in an implementation:</p><div class="variablelist"><dl><dt><span class="term">None</span></dt><dd><p>All SIP messages are processed as soon as possible in a thread
        from the global thread pool. </p><p>When two messages
        belong  to the same <code class="literal">SipSession</code>,  they can be concurrently processed.  Ensure that SIP Messages that access shared resources (such as the session attribute) concurrently  are synchronized in a
        thread-safe manner.</p></dd><dt><span class="term">Transaction</span></dt><dd><p>Bypass the SIP Servlets request/response executors, and utilize the JAIN SIP built-in Transaction serialization to manage race conditions on the same transaction.</p><p>By default, the SIP Servlets server uses a ThreadPoolExecutor linked to a LinkedBlockingQueue to dispatch the request/response threads. The container can thus handles two different response (for example a 180 Ringing and a 200 OK) concurrently, a race condition can occur where the second response overtakes the first one (200 OK dispatched to the application before the 180 Ringing).
        </p></dd><dt><span class="term">SipSession</span></dt><dd><p>SIP messages are processed as soon as possible except for messages originating from the same <code class="literal">SipSession</code>. These messages are  excluded from any simultaneous processing. </p><p>Messages from the same
        <code class="literal">SipSession</code> are processed sequentially, in the order they  originally arrived. </p><p>Two (or more) messages from different
        <code class="literal">SipSession</code> instances in the same
        <code class="literal">SipApplicationSession</code> may be processed
        simultaneously.  For this reason,  ensure that SIP Messages which  access shared resources (such as the session attribute) concurrently  are synchronized in a
        thread-safe manner. </p><p>Thread-safety is particularly important in  Back-to-Back User Agent (B2BUA) cases,  where each communication leg of the
        B2BUA consists of a different <code class="literal">SipSession</code> in the
        same <code class="literal">SipApplicationSession</code>.</p></dd><dt><span class="term">SipApplicationSession</span></dt><dd><p>SIP messages are processed as soon as possible, with the
        guarantee that no two messages from the same
        <code class="literal">SipSession</code> <span class="emphasis"><em>or</em></span> from the same
        <code class="literal">SipApplicationSession</code> will ever be processed
        simultaneously.  Of all the available methods, this mode is the best choice for guaranteed  thread-safety. </p><p>If applications  access shared resources in an unmanaged
        way (for example,  by accessing a <code class="literal">SipSession</code> attribute
        from an unmanaged thread, or from an Enterprise JavaBean) access will not be synchronized.</p></dd></dl></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Congestion Control</h5><p class="formalpara">Mobicents Sip Servlets currently provides the following  congestion
    control mechanisms :</p><div class="itemizedlist"><ul><li><p>All SIP messages which cannot be processed immediately are put
      into a queue, and  wait for either a free thread or for the lock
      on their session to be released. The  size of the  SIP message
      queue is a tunable parameter, which defaults to
      <code class="literal">1500</code>.</p></li><li><p>If the SIP Message queue becomes full, the
      container immediately begins rejecting  new SIP requests until the queue clears.  This is achieved by using one of the following methods:</p><div class="itemizedlist"><ul><li><p>Sending a <code class="literal">503</code> SIP error code  to the originating application.</p></li><li><p>Dropping  incoming
      messages (according to the specified  congestion control policy).</p></li></ul></div></li><li><p>If the container exceeds the  configurable memory threshold (90% by  default), new  SIP requests are rejected   until the
      memory usage falls below the specified memory threshold.  This is achieved by using one of the following methods:</p><div class="itemizedlist"><ul><li><p>Sending a <code class="literal">503</code> SIP error code  to the originating application.</p></li><li><p>Dropping  incoming
      messages (according to the specified  congestion control policy)  .</p></li></ul></div></li></ul></div><p>A background task gathers information about the current server congestion.  The data collection interval   can be adjusted, and congestion control deactivated,  by setting the interval to 0 or a
  negative value.</p><p>The congestion control policy defines how an  incoming
  message is handled when  the server is overloaded.  The following parameters are configurable:</p><div class="itemizedlist"><ul><li><p>DropMessage - drop any incoming message</p></li><li><p>ErrorResponse - send a 503 - Service Unavailable response to any
      incoming request (Default).</p></li></ul></div><p class="formalpara"><a id="sscacc-Configuring_the_Concurrency_and_Congestion_Control_Settings"/></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Configuring the Concurrency and Congestion Control Settings</h5><p class="formalpara">The concurrency and congestion control settings can be configured
    through the SIP Servlets Management Console, using the following methods: </p><div class="itemizedlist"><ul><li><p>through the SIP Servlets Management Console.</p></li><li><p>editing
  the server's <code class="filename">server.xml</code> configuration file.</p></li><li><p>from the
  <code class="literal">dispatcher</code> MBean.</p></li><li><p>from the Embedded Jopr integrated
  management platform.</p></li></ul></div><div class="variablelist"><dl><dt><span class="term">Tuning Parameters with the SIP Servlets Management Console</span></dt><dd><p>The easiest way to configure the <span class="guilabel"><strong>SIP Message Queue Size</strong></span> and <span class="guilabel"><strong>Concurrency Control Mode</strong></span>
        tunable parameters is to open the <code class="literal">SIP Servlets Management Console</code> in your browser (by going to <a class="ulink" href="http://localhost:8080/sip-servlets-management">http://localhost:8080/sip-servlets-management</a>), making
        your changes, and then <span class="guibutton"><strong>Apply</strong></span>ing them. </p><div class="figure"><a id="d0e7199"/><div class="figure-contents"><div class="mediaobject" align="center"><a id="sscacc-sas-MSSSManagementConsole-ss-ServerSettings-1"/><img src="images/mss-MSSSManagementConsole-ss-ServerSettings.png" align="middle" alt="SIP Servlets Management Console Concurrency and Congestion Control Tuning Parameters"/></div></div><p class="title"><b>Figure 7.1. SIP Servlets Management Console Concurrency and Congestion Control Tuning Parameters</b></p></div><br class="figure-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Persistent Settings</h2><p>Concurrency and congestion control settings altered through the SIP Servlets Management console are not saved to the <code class="filename">server.xml</code> configuration file.  </p><p>To make settings persistent, append the settings to  the <code class="filename">server.xml</code> file directly.  </p></div></dd><dt><span class="term">Tuning Parameters Permanently by Editing <code class="filename">server.xml</code></span></dt><dd><p>Alternatively, you can edit your server's
        <code class="filename">server.xml</code> configuration file, which has the
        benefit of making your chosen settings changes permanent. Instructions
        follow, grouped by the SIP Servlets Server you are running:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e7229"/><p class="title"><b>Procedure 7.1. Tuning Mobicents SIP Servlets for JBoss Server Settings for Concurrency and Congestion Control</b></p><ol class="1"><li><p class="title"><b>Open server.xml File</b></p><p>Open the
            <code class="filename"><code class="envar">$JBOSS_HOME</code>/server/default/deploy/jboss-web.deployer/server.xml</code>
            configuration file in a text editor.</p></li><li><p class="title"><b>Add Parameters to &lt;service&gt; Element</b></p><p>Locate the <span class="markup">&lt;service&gt;</span> element, and add the
            <code class="literal">concurrencyControlMode</code> and/or 
            <code class="literal">sipMessageQueueSize</code> attributes.</p><div class="example"><a id="sscacc-MSSJ-Permanently_Changing_Tunable_Parameters_by_Editing_server.xml"/><p class="title"><b>Example 7.1. server.xml Concurrency and Congestion Control Attributes</b></p><div class="example-contents"><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Service</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jboss.web&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">className</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.startup.SipStandardService&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipApplicationDispatcherClassName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">usePrettyEncoding</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipStackPropertiesFile</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/mss-sip-stack.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">darConfigurationFileLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;conf/dars/mobicents-dar.properties&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">concurrencyControlMode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;SipApplicationSession&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sipMessageQueueSize</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1600&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">backToNormalSipMessageQueueSize</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1300&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">congestionControlCheckingInterval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">congestionControlPolicy</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DropMessage&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">memoryThreshold</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;95&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">backToNormalMemoryThreshold</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;90&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Possible values for the
            <code class="literal">concurrencyControlMode</code> attribute include:
            <em class="replaceable"><code>None</code></em>,
            <em class="replaceable"><code>SipSession</code></em> or
            <em class="replaceable"><code>SipApplicationSession</code></em>.
            <em class="replaceable"><code>SipSession</code></em> is the value of this
            attribute when it is not present—and overridden—in
            <code class="filename">server.xml</code>.</p></li><li><p class="title"><b>Define the Correct Attribute Values</b></p><p>The following  default values for the concurrency and congestion control parameters are used regardless of whether the attributes are defined in the <code class="filename">server.xml</code> file:</p><div class="itemizedlist"><ul><li><p>sipMessageQueueSize="1500"</p></li><li><p>backToNormalSipMessageQueueSize="1300"</p></li><li><p>congestionControlCheckingInterval="30000" (30 seconds, in milliseconds)</p></li><li><p>memoryThreshold="95" (in percentage)</p></li><li><p>backToNormalMemoryThreshold="90" (in percentage)</p></li><li><p>congestionControlPolicy="ErrorResponse"</p></li></ul></div><p>Experimentation is required for these tuning parameters depending on the operating system and server.</p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e7310"/><p class="title"><b>Procedure 7.2. Tuning Mobicents SIP Servlets for Tomcat Server Settings for Concurrency and Congestion Control</b></p><ol class="1"><li><p class="title"><b>Open server.xml File</b></p><p>Open the
            <code class="filename"><code class="envar">$CATALINA_HOME</code>/conf/server.xml</code>
            configuration file in your text editor.</p></li><li><p class="title"><b>Add Parameters to &lt;service&gt; Element</b></p><p>Locate the <span class="markup">&lt;service&gt;</span> element, and add the
            <code class="literal">concurrencyControlMode</code> and/or 
            <code class="literal">sipMessageQueueSize</code> attributes.</p><p>Possible values for the
            <code class="literal">concurrencyControlMode</code> attribute include:
            <em class="replaceable"><code>None</code></em>,
            <em class="replaceable"><code>SipSession</code></em> or
            <em class="replaceable"><code>SipApplicationSession</code></em>.
            <em class="replaceable"><code>SipSession</code></em> is the value of this
            attribute when it is not present—and overridden—in
            <code class="filename">server.xml</code>.</p></li><li><p class="title"><b>Define the Correct Attribute Values</b></p><p>The following  default values for the concurrency and congestion control parameters are used regardless of whether the attributes are defined in the <code class="filename">server.xml</code> file:</p><div class="itemizedlist"><ul><li><p>sipMessageQueueSize="1500"</p></li><li><p>backToNormalSipMessageQueueSize="1300"</p></li><li><p>congestionControlCheckingInterval="30000" (30 seconds, in milliseconds)</p></li><li><p>memoryThreshold="95" (in percentage)</p></li><li><p>backToNormalMemoryThreshold="90" (in percentage)</p></li><li><p>congestionControlPolicy="ErrorResponse"</p></li></ul></div><p>Experimentation is required for these tuning parameters depending on the operating system and server.</p></li></ol></div></dd><dt><span class="term">Tuning Parameters from the dispatcher MBean</span></dt><dd><p>Navigate to the <code class="literal">dispatcher</code> MBean from
        Mobicents SIP Servlets for JBoss's JMX console. </p><p>All changes performed
        at run time are effective immediately, but do not persist across
        reboots.  As with JBoss and Tomcat, the   <code class="filename">server.xml</code> must be appended with the settings in order to make the configuration persistent.</p><p>When editing the <code class="literal">dispatcher</code> MBean from
        Mobicents SIP Servlets for JBoss's JMX console, values allowed for the
        concurrency control mode are <strong class="userinput"><code>None</code></strong>,
        <strong class="userinput"><code>SipSession</code></strong> or
        <strong class="userinput"><code>SipApplicationSession</code></strong>.</p></dd><dt><span class="term">Tuning Parameters from Enterprise Monitoring and Managent Console</span></dt><dd><p>If  the Enterprise Monitoring and Managenemt console is installed as described in <a class="xref" href="#emom-Enterprise-Monitoring-Operations-Management" title="Chapter 6. Enterprise Monitoring and Management">Chapter 6, <i>Enterprise Monitoring and Management</i></a>, the tunable parameters can be altered by  following the instructions  in <a class="xref" href="#emom-Embedded-Jopr" title="6.1.2.1. Jopr for Development">Section 6.1.2.1, “Jopr for Development”</a> or <a class="xref" href="#emom-Jopr4Production" title="6.1.2.2. Jopr For Production">Section 6.1.2.2, “Jopr For Production”</a></p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sss-SIP_Servlet_Security"/>7.3. SIP Servlets Application Security</h2></div></div></div><p>The information present in SIP requests often contains sensitive user information.  To protect user information, SIP Security can be enabled on the server, and within the SIP application to mitigate the risk of unauthorised access to the information.</p><p>Application security varies depending on the server type used.  The following procedures describe how to configure the JBoss Application Server, and the Tomcat server.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e7432"/><p class="title"><b>Procedure 7.3. Enable SIP Application Security in JBoss Application Server</b></p><ol class="1"><li><p class="title"><b>Add Security Policy to Server</b></p><div class="orderedlist"><ol><li><p>Open a terminal and navigate to the conf directory:</p><pre class="programlisting">home]$ cd server/default/conf/</pre></li><li><p>Open <code class="literal">login-config.xml</code> (using your preferred editor) and append the security policy to the file:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">application-policy</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;sip-servlets&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">authentication</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">login-module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">code</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.security.auth.spi.UsersRolesLoginModule&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">flag</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">=</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_value">&quot;required&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;usersProperties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">props/sip-servlets-</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;users.properties</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;rolesProperties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">props/sip-servlets-</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;roles.properties</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hashAlgorithm&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">MD5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hashEncoding&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">rfc2617</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hashUserPassword&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">false</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hashStorePassword&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;passwordIsA1Hash&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module-option</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;storeDigestCallback&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;org.jboss.security.auth.spi.RFC2617Digest</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module-option</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">login-module</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">authentication</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">application-policy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
</pre></li></ol></div></li><li><p class="title"><b>Update SIP Server User Properties File</b></p><div class="orderedlist"><ol><li><p>Open a terminal and navigate to the /props directory:</p><pre class="programlisting">home]$ cd server/default/props/</pre></li><li><p>Open <code class="literal">sip-servlets-users.properties</code> and append the user lines to the file:</p><pre class="programlisting"> 
  # A sample users.properties file, this line creates user "admin" with 
  # password "admin" for "sip-servlets-realm"
  admin=&lt;A1_cryptographic_string&gt;
  </pre></li><li><p>To create &lt;A1_cryptographic_string&gt;, execute the following command in a terminal:</p><pre class="programlisting">home]$ java -cp ../server/default/lib/jbosssx.jar</pre></li><li><p>Copy the A1 hash, and paste it into the admin parameter in the previous step.</p></li><li><p>Save and close <code class="literal">sip-servlets-users.properties</code>.</p></li></ol></div></li><li><p class="title"><b>Update SIP Server Roles File</b></p><div class="orderedlist"><ol><li><p>Open a terminal and navigate to the /props directory:</p><pre class="programlisting">home]$ cd server/default/props/</pre></li><li><p>Open <code class="literal">sip-servlets-roles.properties</code> (using your preferred editor) and append the following information to the file:</p><pre class="programlisting"> 
# A sample roles.properties file for use with some roles
# Each line in this file assigns roles to the users defined in 
# sip-servlets-users.properties
admin=caller,role1,role2,..
            </pre></li></ol></div></li><li><p class="title"><b>Add the Security Domain to the SIP Application</b></p><div class="orderedlist"><ol><li><p>Open the <code class="literal">jboss-web.xml</code> file for the SIP application to which security is required.</p></li><li><p>Add the  <span class="markup">&lt;security-domain&gt;</span> element as a child of the <span class="markup">&lt;jboss-web&gt;</span> element:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jboss-web</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--Uncomment&nbsp;the&nbsp;security-domain&nbsp;to&nbsp;enable&nbsp;security.&nbsp;You&nbsp;will&nbsp;need&nbsp;to&nbsp;edit&nbsp;the&nbsp;htmladaptor--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--login&nbsp;configuration&nbsp;to&nbsp;setup&nbsp;the&nbsp;login&nbsp;modules&nbsp;used&nbsp;to&nbsp;authentication&nbsp;users.--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security-domain</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">java:/jaas/sip-servlets</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">security-domain</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jboss-web</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></li></ol></div></li><li><p class="title"><b>Add Security Constraints to the SIP Application</b></p><div class="orderedlist"><ol><li><p>Open the <code class="literal">sip.xml</code> file for the SIP application.</p></li><li><p>Add  the <span class="markup">&lt;security-domain&gt;</span> element as a child of   the <span class="markup">&lt;jboss-web&gt;</span> element:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">REGISTER&nbsp;Method&nbsp;Security&nbsp;Constraint</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-collection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SimpleSipServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Require&nbsp;authenticated&nbsp;REGISTER&nbsp;requests</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SimpleSipServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sip-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">REGISTER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sip-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-collection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">auth-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">role-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">caller</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">role-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">auth-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">security-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">login-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">auth-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">DIGEST</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">auth-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">realm-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sip-servlets-realm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">realm-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">login-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li></ol></div></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e7542"/><p class="title"><b>Procedure 7.4. Enable SIP Application Security in Tomcat Server</b></p><ol class="1"><li><p class="title"><b>Activate the Memory Realm in Catalina:</b></p><div class="orderedlist"><ol><li><p>Open a terminal and navigate to the <code class="filename">/conf</code> directory:</p><pre class="programlisting">home]$ cd server/default/&lt;tomcat_home&gt;/conf/</pre></li><li><p>Open <code class="literal">server.xml</code> and uncomment the following line:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_comment">&lt;!--&lt;Realm&nbsp;className=&quot;org.apache.catalina.realm.MemoryRealm&quot;/&gt;--&gt;</span><span class="xml_plain"></span><br />
</pre></li></ol></div></li><li><p class="title"><b>Update SIP Server User Properties File</b></p><div class="orderedlist"><ol><li><p>In the <code class="filename">/conf</code> directory, open <code class="literal">tomcat-users.xml</code> (using your preferred editor) and append the following <span class="markup">&lt;user&gt;</span> child element:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">user</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;user&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">password</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">roles</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;caller&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></li></ol></div></li><li><p class="title"><b>Add Security Constraints to the SIP Application</b></p><div class="orderedlist"><ol><li><p>Open the <code class="literal">sip.xml</code> file for the SIP application to which security is required.</p></li><li><p>Add the <span class="markup">&lt;security-domain&gt;</span> child element  to the <span class="markup">&lt;jboss-web&gt;</span> element:</p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">REGISTER&nbsp;Method&nbsp;Security&nbsp;Constraint</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-collection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SimpleSipServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Require&nbsp;authenticated&nbsp;REGISTER&nbsp;requests</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SimpleSipServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sip-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">REGISTER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sip-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-collection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">auth-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">role-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">caller</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">role-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">auth-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">security-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">login-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">auth-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">DIGEST</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">auth-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">realm-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sip-servlets-realm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">realm-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">login-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></li></ol></div></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mssstun-MSS_STUN"/>7.4. STUN Support</h2></div></div></div><p>The Session Traversal Utilities for NAT (STUN) prococol is used in
  Network Address Translation (NAT) traversal for real-time voice, video,
  messaging, and related interactive IP application communications. This
  light-weight, client-server protocol allows applications passing through a
  NAT to obtain the public IP address for the UDP connections the application
  uses to connect to remote hosts.</p><p>STUN support is provided at the SIP connector level, using the <a class="ulink" href="https://stun4j.dev.java.net/">STUN for Java</a> project. The STUN
  for Java project provides a Java implementation of the STUN Protocol (RFC
  3489), which allows each SIP connector to select whether it should use STUN
  to discover a public IP address, and use this address in the SIP messages
  sent through the connector.</p><p>To make a SIP connector STUN-enabled, three attributes must be
  appended to the <span class="markup">&lt;connector&gt;</span> child element in the <code class="filename">server.xml</code>
  file. The properties are: </p><div class="itemizedlist"><ul><li><p>useStun="true"</p><p>Enables STUN support for this connector. Ensure that the
        <code class="literal">ipAddress</code> attribute is not set to
        <code class="literal">127.0.0.1</code></p></li><li><p>stunServerAddress="&lt;Public_STUN_Server&gt;"</p><p>STUN server address used to discover the public IP address of
        this SIP Connector. See <a class="xref" href="#tab-pss-Public_STUN_Servers" title="Table 7.1. Public STUN Servers">Table 7.1, “Public STUN Servers”</a>for a suggested list of public
        STUN servers.</p></li><li><p>stunServerPort="3478"</p><p>STUN server port of the STUN server used in the
        <code class="literal">stunServerAddress</code> attribute. Both TCP and UDP
        protocols communicate with STUN servers using this port only.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>A complete list of available SIP connector attributes and their
    descriptions is located in the <a class="xref" href="#bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors" title="2.3.1. Configuring SIP Connectors">Section 2.3.1, “Configuring SIP Connectors”</a>
    section of this guide.</p></div><p>A number of public STUN servers are available, and can be specified in
  the <code class="literal">stunServerAddress</code>. Depending on the router firmware used, the STUN reply
  packets' MAPPED_ADDRESS may be changed to the router's WAN port. To
  alleviate this problem, certain public STUN servers provide
  XOR_MAPPED_ADDRESS support. <a class="xref" href="#tab-pss-Public_STUN_Servers" title="Table 7.1. Public STUN Servers">Table 7.1, “Public STUN Servers”</a>
  provides a selection of public STUN servers.</p><div class="table"><a id="tab-pss-Public_STUN_Servers"/><p class="title"><b>Table 7.1. Public STUN Servers</b></p><div class="table-contents"><table summary="Public STUN Servers" border="1"><colgroup><col align="left"/><col align="left"/><col align="left"/></colgroup><thead><tr><th align="center">Server Address</th><th align="center">XOR Support</th><th align="center">DNS SRV Record</th></tr></thead><tbody><tr><td align="left">stun.ekiga.net</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">stun.fwdnet.net</td><td align="left">No</td><td align="left">Yes</td></tr><tr><td align="left">stun.ideasip.com</td><td align="left">No</td><td align="left">Yes</td></tr><tr><td align="left">stun01.sipphone.com</td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left">stun.softjoys.com</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.voipbuster.com</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.voxgratia.org</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.xten.com</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">stunserver.org</td><td align="left">Yes</td><td align="left">Yes</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For more information about NAT traversal best practices, refer to  <a class="xref" href="#bp-Best_Practices_NAT" title="8.2. NAT Traversal">Section 8.2, “NAT Traversal”</a></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="stf-Seam_Telco_Framework"/>7.5. Seam Telco Framework</h2></div></div></div><p>The Seam Telco Framework (STF) is a telecommunications application framework based on the JSR-289 specification, and JBoss Seam.  The framework plugs the SIP Servlets 1.1 stack into new or existing JBoss Seam applications. Media is achieved through JSR-309. This allows Seam components to implement both the Web and telecommunication logic of the applications.</p><p>The primary goals of the STF are to: </p><div class="itemizedlist"><ul><li><p>Unify Web, SIP, and media telecommunication applications.</p></li><li><p>Allow complex enterprise applications to be built using the same programming model.</p></li><li><p>Keep logical associations between SIP, Media and Web sessions.</p></li></ul></div><p>From an integration perspective, JBoss Seam provides access to different frameworks.  These frameworks are made available to the telecommunication-specific applications for a particular role using the same context.  The STF manages SipServletRequests and Media Server events while utilising existing JBoss Seam framework benefits, including:
      </p><div class="itemizedlist"><ul><li><p>Bijection</p></li><li><p>Inversion of Control (IoC)</p></li><li><p>Interceptors</p></li><li><p>Scoping</p></li><li><p>Transaction management</p></li></ul></div><p>
      </p><p>Other advantages associated with the STF include:
      </p><div class="itemizedlist"><ul><li><p>Enterprise Java Beans (EJB) and Plain Old Java Objects (POJO) support.</p></li><li><p>Loosely-coupled, asynchronous telecommunicaton component support.</p></li><li><p>Web-layer interaction support.</p></li><li><p>Synchronous and asynchronous light-weight message passing using @Observer-annotated methods.</p></li><li><p>Integration with existing Seam IDE tools and infrastructure syntax.</p></li></ul></div><p>
      </p><p>More information about the STF can be found on the <a class="ulink" href="http://groups.google.com/group/mobicents-public/web/seam-telco-framework-for-sip-servlets">STF homepage</a>.  For information about JBoss Seam, refer to the <a class="ulink" href="http://docs.jboss.com/seam/latest/reference/en-US/html/index.html">community documentation</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ssds-Diameter_Support"/>7.6. Diameter Support</h2></div></div></div><p>The Diameter Protocol (<a class="ulink" href="http://www.ietf.org/rfc/rfc3588.txt">RFC 3588</a>) is a computer networking protocol for Authentication, Authorization, and Accounting (AAA). the Diameter version included in Mobicents SIP Servlets currently support Base, Sh, Ro and Rf.</p><p>For more information regarding Diameter support, refer to the <a class="ulink" href="http://groups.google.com/group/mobicents-public/web/mobicents-diameter">Diameter Home Page</a>.  For a list of Diameter examples, refer to <a class="xref" href="#ssea-SIP_Servlet_Example_Applications" title="Chapter 4. SIP Servlet Example Applications">Chapter 4, <i>SIP Servlet Example Applications</i></a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="saimse-SIP_and_IMS_Extensions"/>7.7. SIP and IMS Extensions</h2></div></div></div><p>SIP Extensions in the SIP Servlets Server are based on Internet Engineering Task Force (IETF) Request for Comments (RFC) protocol recommendatons.  <a class="xref" href="#tab-sse-Supported_SIP_Extensions" title="Table 7.2. Supported SIP Extensions">Table 7.2, “Supported SIP Extensions”</a> lists the supported RFCs for the SIP Servlets Server.</p><div class="table"><a id="tab-sse-Supported_SIP_Extensions"/><p class="title"><b>Table 7.2. Supported SIP Extensions</b></p><div class="table-contents"><table summary="Supported SIP Extensions" border="1"><colgroup><col align="left"/><col align="left"/><col align="left"/></colgroup><thead><tr><th align="center">Extension</th><th align="center">RFC Number</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">DNS</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3263.txt">RFC 3263</a></td><td align="left">SIP: Locating SIP Servers</td></tr><tr><td align="left">INFO</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc2976.txt">RFC 2976</a></td><td align="left">The SIP INFO Method</td></tr><tr><td align="left">IPv6</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc2460.txt">RFC 2460</a></td><td align="left">Internet Protocol, Version 6 (IPv6) Specification</td></tr><tr><td align="left">JOIN</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3911.txt">RFC 3911</a></td><td align="left">The SIP "Join" Header</td></tr><tr><td align="left">MESSAGE</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3428.txt">RFC 3428</a></td><td align="left">SIP Extension for Instant Messaging</td></tr><tr><td align="left">PATH</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3327.txt">RFC 3327</a></td><td align="left">SIP Extension Header Field for Registering Non-adjacent Contacts</td></tr><tr><td align="left">PRACK</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3262.txt">RFC 3262</a></td><td align="left">Reliability of Provisional Responses in the SIP</td></tr><tr><td align="left">PUBLISH</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3903.txt">RFC 3903</a></td><td align="left">SIP Extension for Event State Publication</td></tr><tr><td align="left">REASON</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3326.txt">RFC 3515</a></td><td align="left">The Reason Header Field for the Session Initiation Protocol (SIP)</td></tr><tr><td align="left">REFER</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3515.txt">RFC 3515</a></td><td align="left">The SIP Refer Method</td></tr><tr><td align="left">REPLACES</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3891.txt">RFC 3891</a></td><td align="left">The SIP "Replaces" Header</td></tr><tr><td align="left">STUN</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3489.txt">RFC 3489</a></td><td align="left">STUN - Simple Traversal of User Datagram Protocol (UDP) through Network Address Translators (NATs)</td></tr><tr><td align="left">SUBSCRIBE/NOTIFY</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3265.txt">RFC 3265</a></td><td align="left">SIP-specific Event Notification</td></tr><tr><td align="left">Symmetric Response Routing</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3581.txt">RFC 3581</a></td><td align="left">An Extension to the Session Initiation Protocol (SIP) for Symmetric Response Routing</td></tr><tr><td align="left">Multipart type as mentionned in </td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc4662.txt">RFC 4662</a></td><td align="left">A Session Initiation Protocol (SIP) Event Notification</td></tr></tbody></table></div></div><br class="table-break"/><p>IMS Private Header (P-Header) Extensions are provided according to the recommendations of the <a class="ulink" href="http://www.3gpp.org/">3rd Generation Partnering Project (3GPP)</a>, and the IETF.  P-Header extensions are primarily used to store information about the networks a call traverses, including (but not limited to) security or call charging details.</p><p><a class="xref" href="#tab-sse-IMS_P-Header_Extensions" title="Table 7.3. IMS P-Header Extensions">Table 7.3, “IMS P-Header Extensions”</a> describes the list of supported P-Headers, including links to the relevant ITEF memorandum where available.</p><div class="table"><a id="tab-sse-IMS_P-Header_Extensions"/><p class="title"><b>Table 7.3. IMS P-Header Extensions</b></p><div class="table-contents"><table summary="IMS P-Header Extensions" border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr><th align="center">Extension</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">AuthorizationHeaderIMS</td><td align="left">Defines a new auth-param for the Authorization header used in REGISTER requests.</td></tr><tr><td align="left">PAccessNetworkInfoHeader</td><td align="left">Contains information regarding the access network the User Agent (UA) uses to connect to the SIP Proxy.  The information contained in this header may be sensitive, such as the cell ID, so it is important to secure all SIP application that interface with this header. </td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3324.txt">PAssertedIdentityHeader</a></td><td align="left">Contains an identity resulting from an authentication process, derived from a SIP network intermediary.  The identity may be based on SIP Digest authentication.</td></tr><tr><td align="left">PAssertedServiceHeader</td><td align="left">Contains information used by "trust domains", according to Spec(T) specifications detailed in <a class="ulink" href="http://www.ietf.org/rfc/rfc3324.txt">RFC 3324</a>.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3455.txt">PAssociatedURIHeader</a></td><td align="left">Contains a list of URIs that are allocated to the user.  The header is defined in the 200 OK response to a REGISTER request.  It allows the User Agent Client (UAC) to determine the URIs the service provider has associated to the user's address-of-record URI.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3327.txt">PathHeader</a></td><td align="left">SIP Extension header, with syntax similar to the RecordRoute header.  Used in conjunction with SIP REGISTER requests and 200 class messages in response to REGISTER responses.</td></tr><tr><td align="left">PCalledPartyIDHeader</td><td align="left">Typically inserted en-route into an INVITE request by the proxy, the header is populated with the Request_URI received by the proxy in the request.  The header allows the User Agent Server (UAS) to identify which address-of-record the invitation was sent to, and can be used to render distinctive audio-visual alert notes based on the URI.</td></tr><tr><td align="left">PChargingFunctionAddressesHeader</td><td align="left">Contains a list of one or more of the Charging Collection Function (CCF) and the Event Charging Function (ECF) addresses.  The CCF and ECF addresses may be passed during the establishment of a dialog, or in a standalone transaction.</td></tr><tr><td align="left">PChargingVectorHeader</td><td align="left">Contains a unique charging identifier and correlation information, which is used by network operators to correctly charge for routing events through their networks.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3313.txt">PMediaAuthorizationHeader</a></td><td align="left">Contains one or more session-specific media authorization tokens, which are used for QoS of the media streams.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3325.txt">PPreferredIdentityHeader</a></td><td align="left">Contains a SIP URI and an optional display-name.  For example, "James May" &lt;sip:james@domain.com&gt;.  This header is used by trusted proxy servers to identify the user to other trusted proxies, and can be used to select the correct SIP URI in the case of multiple user identities.  </td></tr><tr><td align="left">PPreferredServiceHeader</td><td align="left">Used by the PAssertedService Header to determine the preferred user service.  Multiple PPreferreedService headers may be present in a single request.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc5002.txt">PProfileKeyHeader</a></td><td align="left">Contains a key used by a proxy to query the user database for a given profile.  The key may contain wildcards that are used as part of the query into the database.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3323.txt">PrivacyHeader</a></td><td align="left">Contains values that determine whether particular header information is deemed as private by the UA for requests and responses.  </td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc5502.txt">PServedUserHeader</a></td><td align="left">Contains an identity of the user that represents the served user.  The header is added to the initial requests for a dialog or standalone request, which are then routed between nodes in a trusted domain.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc4457.txt">PUserDatabaseHeader</a></td><td align="left">Contains the address of the HSS handling the user that generated the request.  The header field is added to request routed from an Interrogating Call Session Control Function (I-CSCF) to a Serving Call Session Control Function (S-CSCF)</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3455.txt">PVisitedNetworkIDHeader</a></td><td align="left">Contains the identifier of a visited network.  The identifier is a text string or token than it known by both the registrar or the home proxy at the home network, and the proxies in the visited network.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3329.txt">SecurityClientHeader, SecurityServerHeader, SecurityVerifyHeader</a></td><td align="left">Contains information used to negotiate the security mechanisms between a UAC, and other SIP entities including UAS, proxy and registrar.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3608.txt">ServiceRouteHeader</a></td><td align="left">Contains a route vector that will direct requests through a specified sequence of proxies.  The header may be included by a registrar in response to a REGISTER request.</td></tr><tr><td align="left"><a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/gov/nist/javax/sip/header/ims/WWWAuthenticateHeaderIms.html">WWWAuthenticateHeaderIms</a></td><td align="left">Extends the WWWAuthenticateResponse header functionality by defining an additional authorization parameter (auth-param).</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="jruby-telco-integration"/>7.8. JRuby/Rails Integration with Torquebox Telco Framework</h2></div></div></div><p>Mobicents Sip Servlets is compatible with  the <a class="ulink" href="http://torquebox.org/">Torquebox</a> Telco Framework  JRuby on
  Rails integration.  The framework allows you to create powerful, pure or converged VoIP JRuby
  on Rails applications.</p><p>JRuby features a powerful and well
  deployed scripting language that allows  you to modify your application at
  runtime (this is true even for the SIP and Media part that Mobicents SIP
  Servlets offer) without restarting the server.  In addition, TorqueBox is a new kind of Ruby application
  platform that integrates popular technologies such as Ruby-on-Rails, while
  extending the footprint of Ruby applications to include support for Job
  Scheduling, Task Queues, SOAP Handling, and other capabilities.</p><p>To obtain more information about building pure JRuby-Rails applications that 
  leverage Mobicents SIP Servlets SIP and mediat capabilities, refer to the <a class="ulink" href="http://torquebox.org/documentation/browse/LATEST/telecom.html">Torquebox User Documentation</a>.</p><p>Check this <a class="ulink" href="http://jeanderuelle.blogspot.com/2009/03/my-jruby-rails-app-on-jboss-can-make.html">blog post</a> to help you create your first pure Torquebox JRuby Telco
  application and our <a class="ulink" href="http://www.mobicents.org/mss-pure-jruby-telco.html">pure JRuby on Rails TorqueBox Telco example</a> showcasing this integration.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ss_jslee_interop"/>7.9. SIP Servlets - JAIN SLEE Interoperability</h2></div></div></div><p>JAIN SLEE is a more complex specification than SIP Servlets, and it
  has been know as heavyweight and with a steep learning curve. However JAIN
  SLEE has standardized a high performing event driven application server, an
  execution environment with a good concurrency model and powerful protocol
  agnostic capabilities thus covering a variety of Telco protocols.</p><p>SIP Servlets on the other hand is much simpler and easier to get started
  with. Its focus is on extending the HTTP Servlets and Java EE hosting
  environments with SIP capabilities.  SIP Servlets is more of a SIP
  programming framework, while JSLEE is a complete, self sufficient application
  platform. The fact that SIP Servlets is focused on SIP and
  Java EE makes it a natural fit to build JEE converged applications.</p><div class="table"><a id="tab-ss_vs_jslee"/><p class="title"><b>Table 7.4. SIP Servlets / JAIN SLEE Comparison Table</b></p><div class="table-contents"><table summary="SIP Servlets / JAIN SLEE Comparison Table" border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr><th align="center">SIP Servlets</th><th align="center">JAIN SLEE</th></tr></thead><tbody><tr><td colspan="2" align="center">
              <span class="bold"><strong>Application Architecture</strong></span>
            </td></tr><tr><td align="center">Based on HTTP Servlets. Unit of logic is the SIP Servlets</td><td align="center">Component based, Object Orientated architecture. Unit of logic is the Service Building Block</td></tr><tr><td align="center">Composition through Application Router</td><td align="center">Composition through parent-child relationship</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Application State</strong></span>
            </td></tr><tr><td align="center">Servlets are stateless</td><td align="center">SBBs may be stateful.</td></tr><tr><td align="center">Shared state stored in a session and visible to all Servlets with access to the session</td><td align="center">SBB state is transacted and a property of the SBB itself. Shared state may be stored in a separate ActivityContext via a type safe interface</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Concurrency Control</strong></span>
            </td></tr><tr><td align="center">Application managed : use of Java monitors</td><td align="center">System Managed : isolation of concurrent transactions</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Facilities (Utilities for Applications)</strong></span>
            </td></tr><tr><td align="center">Timer, Listeners</td><td align="center">Timer, Trace, Alarm, Statistics, Profiles.</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Protocol Support</strong></span>
            </td></tr><tr><td align="center">SIP and HTTP</td><td align="center">Protocol agnostic. Consistent event model, regardless of protocol/resource</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Availability Mechanisms</strong></span>
            </td></tr><tr><td align="center">Container managed state (session object) that can be replicated</td><td align="center">Container managed state (SBB CMP, Facility, ActivityContext) that can be replicated</td></tr><tr><td align="center">No transaction context for SIP message processing</td><td align="center">Transaction context for event delivery</td></tr><tr><td align="center">Non transacted state operations</td><td align="center">Container managed state operations are transacted</td></tr><tr><td align="left">Facilities are non transacted</td><td align="left">Facilities, timers, are transacted</td></tr><tr><td align="center">No defined failure model</td><td align="center">Well defined and understood failure model via transactions</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Management</strong></span>
            </td></tr><tr><td align="center">No standard management mechanisms defined</td><td align="center">JMX Interface for managing applications, life cycle, upgrades, ...</td></tr></tbody></table></div></div><p><br class="table-break"/></p><p>JSLEE and SIP Servlets target different audiences with different needs
  but they can be complementary in a number of real world cases.</p><p>SIP Servlets focuses on SIP and its integration with Java EE. It is
  also more of a SIP framework within Java EE while JSLEE is an event driven
  application server with protocol agnostic architecture, spanning any legacy
  or potential future protocols. SIP Servlets applications are generally
  simpler to implement and accelerate time to market for Web and SIP
  deployment scenarios. JSLEE has a steeper learning curve and covers a wider
  set of target deployment environments.</p><p>As JBoss is the only vendor to implement both specifications through
  Mobicents, this makes it a natural fit to build converged and interoperable
  JSLEE/SIP Servlets applications that are able to comply with standards in a
  portable manner, we built an application that could leverage standards all
  the way without resorting to vendor proprietary extensions by making SIP
  Servlets and JSLEE work together. <a class="ulink" href="http://mobicents.googlecode.com/files/deruelle-JSleeSipServletsInteroperability-final.pdf">Our "JSLEE and SIP-Servlets Interoperability with Mobicents Communication Platform" paper</a> describes our approach and the possible different
  approaches we have identified to achieve the goal of interoperability
  between SIP Servlets and JSLEE.</p><p>You can also use our <a class="ulink" href="http://www.mobicents.org/jslee-sips-interop-demo.html">JSLEE/SIP Servlets interoperability example</a> showcasing our approach.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8266"/>7.10. Eclipse IDE Tools</h2></div></div></div><p>The Mobicents SIP Servlets Eclipse Tools assist developers in creating JSR 289 applications with Mobicents. You can use the Dynamic Web Project wizard for Converged Applications to get started with an empty project and then you can test your application with a real SIP Phone right from the IDE.</p><div class="mediaobject"><img src="images/mss-ide-screen.png"/><div class="caption">SIP Servlets Eclipse IDE Tools</div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8276"/>7.10.1. Pre-Install requirements</h3></div></div></div><p>Eclipse 3.4 is required.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8281"/>7.10.2. Installation</h3></div></div></div><p>The standard Eclipse Update Site installation mechanism is leveraged. The Mobicents Update Site is at the following location: <a class="ulink" href="http://mobicents.googlecode.com/svn/downloads/sip-servlets-eclipse-update-site">http://mobicents.googlecode.com/svn/downloads/sip-servlets-eclipse-update-site</a> After adding this update site to Eclipse you can proceed with regular Eclipse Plug-in Installation. If you need help the process is demonstrated in <a class="ulink" href="http://www.youtube.com/watch?v=LZOmLEC2IeQ">this video</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8292"/>7.10.3. SIP Servlets Core Plug-in</h3></div></div></div><p>This Plug-in allows you to create Dynamic Web Projects with  SIP Facet. There are a number of new Dynamic Web Project configurations for Converged applications. It's best to use the ones marked as "recommended". After you complete the wizards a complete converged project  skeleton will be generated. Working with this type of project is similar to working with normal Web projects. You can see a demo <a class="ulink" href="http://people.redhat.com/vralev/mss-eclipse-plugin-demo/mss-eclipse.htm">here</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8300"/>7.10.4. SIP Phone Plug-in</h3></div></div></div><p>The SIP Phone plug-in integrates a SIP phone inside your Eclipse IDE. You can use the phone to test your SIP or Media applications. The Phone uses the Microphone and the Speakers on your computer and allows to simulate real-world scenarios.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bp-Best_Practices"/>Chapter 8. Best Practices</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#bp-Best_Practices_Perf_Tips">8.1. Mobicents SIP Servlets Performance Tips</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8316">8.1.1. Tuning JBoss</a></span></dt><dt><span class="section"><a href="#d0e8331">8.1.2. Tuning Mobicents SIP Servlets</a></span></dt><dt><span class="section"><a href="#d0e8359">8.1.3. Tuning The JAIN SIP Stack</a></span></dt><dt><span class="section"><a href="#d0e8471">8.1.4. Tuning The JVM</a></span></dt><dt><span class="section"><a href="#d0e8522">8.1.5. Tuning The Operating System</a></span></dt></dl></dd><dt><span class="section"><a href="#bp-Best_Practices_NAT">8.2. NAT Traversal</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8601">8.2.1. STUN</a></span></dt><dt><span class="section"><a href="#d0e8610">8.2.2. TURN</a></span></dt><dt><span class="section"><a href="#d0e8621">8.2.3. ICE</a></span></dt><dt><span class="section"><a href="#d0e8636">8.2.4. Other Approaches</a></span></dt></dl></dd></dl></div><p>This chapter discusses Best Practices related to  Mobicents
  SIP Servlets usage in real world deployments.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bp-Best_Practices_Perf_Tips"/>8.1. Mobicents SIP Servlets Performance Tips</h2></div></div></div><p>Because the default profile of Mobicents SIP Servlets  is targeted at a
    development environment,  some tuning is required to make the server performance  suitable for a  production environment.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8316"/>8.1.1. Tuning JBoss</h3></div></div></div><p>To ensure the server is finely tuned for a production envirionment, certain configuration must be changed.  Visit the   <a class="ulink" href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JBossASTuningSliming">JBoss Application Server Tuning</a> wiki page to learn about optimization techniques.
       </p><p>While it is preferrable to have a fast Application Server,  most of the information doesn't apply to Mobicents.  In summary, the most important optimization technique is to remove logs, leaving only what is required.</p><p> Check the log configuration file in
      the following location and review the information.</p><p><code class="filename">$JBOSS_HOME/server/default/conf/jboss-log4j.xml</code></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8331"/>8.1.2. Tuning Mobicents SIP Servlets</h3></div></div></div><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>Congestion Control</em></span> : It is recommended that this feature is enabled to avoid overload of the server and that the <span class="emphasis"><em>sipMessageQueueSize</em></span> and <span class="emphasis"><em>memoryThreshold</em></span> parameters are tuned according to <a class="xref" href="#sscacc-MSS_Concurrency_and_Congestion_Control" title="7.2. Concurrency and Congestion Control">Section 7.2, “Concurrency and Congestion Control”</a></p></li><li><p><span class="emphasis"><em>Concurrency</em></span> :
          <span class="emphasis"><em>Default Value : None.</em></span>  For better performance, it is recommended to leave  this value set to <strong class="userinput"><code>None</code></strong>.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8359"/>8.1.3. Tuning The JAIN SIP Stack</h3></div></div></div><p>The stack can be fine-tuned by altering the SIP stack properties, defined in the external properties file specified by the <span class="emphasis"><em>sipStackPropertiesFile</em></span> attribute as described in <a class="xref" href="#bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors" title="2.3.1. Configuring SIP Connectors">Section 2.3.1, “Configuring SIP Connectors”</a>.</p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>gov.nist.javax.sip.THREAD_POOL_SIZE</em></span>
          </p><p><span class="emphasis"><em>Default value: 64</em></span> </p><p>This thread pool is
          responsible for parsing SIP messages received from socket messages into
          objects.  </p><p>A smaller value will make the stack less responsive, since
          new messages have to wait in a queue for free threads. In UDP, this
          can lead to more retransmissions. </p><p>Large thread pool sizes result in allocating resources
          that are otherwise not required.</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.REENTRANT_LISTENER</em></span>
          </p><p><span class="emphasis"><em>Default value: true</em></span> </p><p>This flag indicates whether the
          SIP stack listener is executed by a single thread, or concurrently
          by the threads that parse the messages. </p><p>Mobicents SIP
          Servlets expects this flag to be set to <strong class="userinput"><code>true</code></strong>, therefore do not change the value.</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.LOG_MESSAGE_CONTENT</em></span>
          </p><p><span class="emphasis"><em>Default value: true</em></span></p><p>Set the parameter to  <strong class="userinput"><code>false</code></strong> to disable message logging.</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.TRACE_LEVEL=0</em></span>
          </p><p><span class="emphasis"><em>Default value: 32</em></span>. </p><p>Set the parameter to <strong class="userinput"><code>0</code></strong> to disable JAIN SIP stack logging.</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.RECEIVE_UDP_BUFFER_SIZE=65536 and gov.nist.javax.sip.SEND_UDP_BUFFER_SIZE=65536</em></span>
          </p><p><span class="emphasis"><em>Default value: 65536</em></span>. </p><p>Those properties control the size of the UDP buffer used for SIP messages. Under load, if the buffer capacity is overflown the messages are dropped causing retransmissions, further increasing the load and causing even more retransmissions</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.MAX_MESSAGE_SIZE=65536</em></span>
          </p><p><span class="emphasis"><em>Default value: 65536</em></span>. </p><p>This property control the maximum size of content that can be read for a SIP Message on UDP.  Default is 65536. The average UDP message size is quite lower than this so reducing this property will benefit memory usage since a byte buffer of this size is created for every message received</p><p>It also defines the maximum size of content that a TCP connection can read. Must be at least 4K. Default is "infinity" -- ie. no limit. This is to prevent DOS attacks launched by writing to a TCP connection until the server chokes.</p></li><li><p><span class="emphasis"><em>gov.nist.javax.sip.TCP_POST_PARSING_THREAD_POOL_SIZE=30</em></span>
          </p><p><span class="emphasis"><em>Default value: 30</em></span>. </p><p>Use 0 or do not set this option to disable it. When using TCP your phones/clients usually connect independently creating their own TCP sockets. Sometimes however SIP devices are allowed to tunnel multiple calls over a single socket. This can also be simulated with SIPP by running "sipp -t t1". In the stack each TCP socket has it's own thread. When all calls are using the same socket they all use a single thread, which leads to severe performance penalty, especially on multi-core machines. This option instructs the SIP stack to use a thread pool and split the CPU load between many threads. The number of the threads is specified in this parameter. The processing is split immediately after the parsing of the message. It cannot be split before the parsing because in TCP the SIP message size is in the Content-Length header of the message and the access to the TCP network stream has to be synchronized. Additionally in TCP the message size can be larger. This causes most of the parsing for all calls to occur in a single thread, which may have impact on the performance in trivial applications using a single socket for all calls. In most applications it doesn't have performance impact. If the phones/clients use separate TCP sockets for each call this option doesn't have much impact, except the slightly increased memory footprint caused by the thread pool. It is recommended to disable this option in this case by setting it 0 or not setting it at all. You can simulate multi-socket mode with "sipp -t t0". With this option also we avoid closing the TCP socket when something fails, because we must keep processing other messages for other calls. Note: This option relies on accurate Content-Length headers in the SIP messages. It cannot recover once a malformed message is processed, because the stream iterator will not be aligned any more. Eventually the connection will be closed.</p></li></ul></div><p>The full list of JAIN SIP stack properties is available from
      <a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/javax/sip/SipStack.html">the SIP Stack Properties Home Page</a>
      and the full list of implementation specific properties are available
      from the <a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/gov/nist/javax/sip/SipStackImpl.html">SIP Stack Implementation Home Page</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8471"/>8.1.4. Tuning The JVM</h3></div></div></div><p>The following tuning information applies to Sun JDK 1.6, however  the information should also apply
      to Sun JDK 1.5.  </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For more information on performance, refer to  the <a class="ulink" href="http://java.sun.com/performance/reference/whitepapers/6_performance.html">Performance White Paper</a>.</p></div><p>To pass arguments to the JVM, change
      <code class="filename">$JBOSS_HOME/bin/run.conf</code> (Linux) or <code class="filename">$JBOSS_HOME/bin/run.bat</code> (Windows).</p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Garbage Collection</strong></span> </p><p>JVM
          ergonomics automatically attempt to select the best garbage collector. The
          default behaviour is to select the throughput collector, however a disadvantage of the throughput collector is that it can have long pauses times, which
          ultimately blocks  JVM processing. </p><p>For low-load implementations, consider using  the incremental, low-pause, garbage collector
          (activated by specifying <span class="emphasis"><em>
              <strong class="userinput"><code>-XX:+UseConcMarkSweepGC -XX:+CMSIncrementalMode</code></strong>
            </em></span>). Many SIP applications can benefit from this garbage collector type because  it reduces the retransmission amount. </p><p>For more
          information please read: <a class="ulink" href="http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html">Garbage Collector Tuning </a></p></li><li><p><span class="bold"><strong>Heap</strong></span> <span class="bold"><strong>Size</strong></span> </p><p>Heap size is an important consideration for
          garbage collection. Having an unnecessarily large heap can stop the JVM for
          seconds, to perform garbage collection. </p><p>Small heap sizes are not
          recommended either, because they put unnecessary pressure on the  garbage
          collection system.  </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8522"/>8.1.5. Tuning The Operating System</h3></div></div></div><p>The following tuning information is provided for Red Hat Enterprise Linux (RHEL) servers that are running high-load configurations.   The tuning information  should also apply to other Linux distributions.</p><p>After you have configured RHEL with the tuning information, you must restart the operating system.   You should see improvements in I/O response times. With SIP, the
      performance improvement can be as high as  20%. </p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Large Memory Pages</strong></span> </p><p>Setting large memory pages
          can reduce CPU utilization by up to  5%. </p><p>Ensure that  the option
          <span class="emphasis"><em>
              <strong class="userinput"><code>-XX:+UseLargePages</code></strong>
            </em></span> is passed and ensure that the following Java
          HotSpot(TM) Server VM warning does not occur:</p><p><code class="literal">Failed to reserve shared memory (errno = 22)" when starting JBoss.</code> It means that the number of pages at OS level is still not enough.</p><p>To learn
          more about large memory pages, and how to configure them, refer to 
          <a class="ulink" href="http://java.sun.com/javase/technologies/hotspot/largememory.jsp">Java Support for Large Memory Pages</a> and <a class="ulink" href="http://andrigoss.blogspot.com/2008/02/jvm-performance-tuning.html">Andrig's Miller blog post</a>.</p></li><li><p><span class="emphasis"><em>Network buffers</em></span> </p><p>You can
          increase the network buffers size by adding the following lines to
          your <code class="filename">/etc/sysctl.conf</code> file:</p><div class="itemizedlist"><ul><li><p><strong class="userinput"><code>net.core.rmem_max = 16777216</code></strong></p></li><li><p><strong class="userinput"><code>net.core.wmem_max = 16777216</code></strong></p></li><li><p><strong class="userinput"><code>net.ipv4.tcp_rmem = 4096 87380 16777216</code></strong></p></li><li><p><strong class="userinput"><code>net.ipv4.tcp_wmem = 4096 65536 16777216</code></strong></p></li><li><p><strong class="userinput"><code>net.core.netdev_max_backlog = 300000</code></strong></p></li></ul></div></li><li><p>Execute the following command to set the network interface address:</p><p><code class="command">sudo ifconfig [eth0] txqueuelen 1000 # </code></p><p>Replace [eth0] with the correct name of the
          actual network interface you are setting up.</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bp-Best_Practices_NAT"/>8.2. NAT Traversal</h2></div></div></div><p>In a production environment,  it is common to see SIP and Media
    data passing through different kinds of Network Address Translation (NAT)  to reach the
    required endpoints. Because NAT Traversal is a complex topic, refer to the following information to help determine the most effective method to handle NAT issues.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8601"/>8.2.1. STUN</h3></div></div></div><p>STUN (Session Traversal Utilities for NAT) is not generally
      considered a viable solution for enterprises because STUN cannot be used
      with symmetric NATs. </p><p>Most enterprise-grade
      firewalls are symmetric, therefore STUN support must be provided  in the SIP Clients themselves.  
      </p><p>Most of the proxy and media gateways installed by VoIP providers 
      recognize the public IP address the packets have originated from.   When both SIP end points are behind a NAT, they can act as
      gateways to clients behind NAT.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8610"/>8.2.2. TURN</h3></div></div></div><p>TURN (Traversal Using Relay NAT) is an IETF standard, which
      implements media relays for SIP end-points. The standard overcomes the problems of
      clients behind symmetric NATs which cannot rely on STUN to solve NAT
      traversal. </p><p>TURN connects clients behind a NAT to a single peer, providing the same protection offered by symmetric NATs and
      firewalls. The TURN server acts as a relay; any data received is
      forwarded. </p><p>This type of implementation is not ideal. It assumes the clients
      have a trust relationship with a TURN server,  and a request session
      allocation based on shared credentials. </p><p>This can result in scalability issues,
      and requires changes in the SIP clients.  It is also impossible to determine
      when a direct, or TURN, connection is appropriate.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8621"/>8.2.3. ICE</h3></div></div></div><p>ICE (Interactive Connection Establishment) leverages both
      STUN and TURN to solve the NAT traversal issues.</p><p>It allows devices to
      probe for multiple paths of communication, by attempting to use different
      port numbers and STUN techniques. If ICE support is present in both
      devices, it is quite possible that the devices can initiate and maintain communication
      end-to-end, without any intermediary media relay.</p><p>Additionally, ICE can
      detect cases where direct communication is impossible and automatically initiate  fall-back to a media relay. </p><p>ICE is not currently in  widespread  use in SIP devices, because ICE capability must be embedded within 
      the SIP devices. </p><p>Depending
      on the negotiated connection, a  reINVITE may be required during a session, which adds more
      load to the SIP network and more latency to the call. </p><p>If the
      initiating ICE client attempts to call a non-ICE client, then the call
      setup-process will revert to a conventional SIP call requiring NAT
      traversal to be solved by other means.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8636"/>8.2.4. Other Approaches</h3></div></div></div><p>Other approaches include using proxy and media that can act as
      gateways, Session Border Controllers, enhanced Firewall with Application
      Layer Gateway (ALG) and Tunnelling.</p></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8643"/>Appendix A. Revision History</h2></div></div></div><p>
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 3.0</td><td align="left">Thu Jun 11 2009</td><td align="left"><span class="author"><span class="firstname">Jared</span> <span class="surname">Morgan</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Second release of the "parameterized" documentation.</td></tr></table>
				</td></tr><tr><td align="left">Revision 2.0</td><td align="left">Fri Mar 06 2009</td><td align="left"><span class="author"><span class="firstname">Douglas</span> <span class="surname">Silas</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>First release of the "parameterized", and much-improved JBCP documentation.</td></tr></table>
				</td></tr></table></div>
	</p></div></div></body></html>